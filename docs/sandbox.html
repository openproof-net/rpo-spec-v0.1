<!DOCTYPE html>
<html lang="en" data-page="sandbox">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OpenProof — RPO v0.1 | Sandbox</title>
  <meta name="description" content="RPO v0.1 sandbox: paste 1–3 paragraphs, generate a deterministic draft bundle (signals, axes, thresholds + public sha256). No AI. No storage." />
  <meta name="robots" content="index, follow" />
  <link rel="canonical" href="https://rpo.openproof.net/sandbox.html" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Orbitron:wght@500;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      /* OpenProof charter (dark/ivory/gold) */
      --bg:#04040e;
      --bg2:#0b0f14;
      --ivory:#FBF8F1;
      --paper:#F7F3E8;
      --ink:#161616;
      --muted:#6b6b6b;

      --gold1:#F1E6A3;
      --gold2:#D4AF37;
      --gold3:#8F7633;

      --line: rgba(212,175,55,0.35);
      --chip: rgba(247,243,232,0.06);
      --chipLine: rgba(212,175,55,0.22);

      --shadow: 0 26px 90px rgba(0,0,0,0.55);
      --radius: 26px;
      --radius2: 18px;

      --ok:#46ff99;
      --warn:#ffb86b;
      --bad:#ff6b6b;
      --blue:#5aa7ff;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      color:rgba(255,255,255,0.92);
      background: radial-gradient(900px 520px at 18% 12%, rgba(212,175,55,0.18), transparent 60%),
                  radial-gradient(880px 520px at 78% 10%, rgba(90,167,255,0.10), transparent 65%),
                  radial-gradient(1100px 700px at 55% 60%, rgba(212,175,55,0.08), transparent 70%),
                  linear-gradient(180deg, #04040e 0%, #04040e 25%, #070a10 70%, #04040e 100%);
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      overflow-x:hidden;
    }

    /* Starfield */
    .stars{
      position:fixed; inset:0;
      pointer-events:none;
      opacity:0.55;
      mix-blend-mode:screen;
      filter: blur(0.2px);
      z-index:0;
    }
    .stars::before, .stars::after{
      content:"";
      position:absolute; inset:-20%;
      background-image:
        radial-gradient(2px 2px at 18% 22%, rgba(241,230,163,0.95) 40%, transparent 44%),
        radial-gradient(1.6px 1.6px at 35% 60%, rgba(241,230,163,0.85) 40%, transparent 44%),
        radial-gradient(1.4px 1.4px at 64% 34%, rgba(241,230,163,0.8) 40%, transparent 44%),
        radial-gradient(1.2px 1.2px at 72% 78%, rgba(241,230,163,0.7) 40%, transparent 44%),
        radial-gradient(1px 1px at 82% 18%, rgba(241,230,163,0.7) 40%, transparent 44%),
        radial-gradient(1px 1px at 12% 72%, rgba(241,230,163,0.7) 40%, transparent 44%),
        radial-gradient(1px 1px at 52% 86%, rgba(241,230,163,0.6) 40%, transparent 44%),
        radial-gradient(1px 1px at 92% 56%, rgba(241,230,163,0.6) 40%, transparent 44%);
      background-size: 820px 520px;
      transform: translate3d(0,0,0);
      animation: drift 26s linear infinite;
      opacity:0.9;
    }
    .stars::after{
      background-size: 1150px 680px;
      animation-duration: 36s;
      opacity:0.55;
    }
    @keyframes drift{
      from{transform: translate3d(-2%, -1%, 0)}
      to{transform: translate3d(2%, 1%, 0)}
    }

    /* Layout shell */
    .wrap{position:relative; z-index:1; min-height:100%;}
    .container{width:min(1200px, 92vw); margin:0 auto;}

    /* Header */
    header{
      position:sticky; top:0; z-index:20;
      backdrop-filter: blur(10px);
      background: linear-gradient(180deg, rgba(4,4,14,0.92), rgba(4,4,14,0.72));
      border-bottom:1px solid rgba(212,175,55,0.16);
    }
    .topbar{
      display:flex; align-items:center; justify-content:space-between;
      padding:14px 0;
      gap:16px;
    }
    .brand{
      display:flex; align-items:center; gap:12px; min-width:260px;
    }
    .logo{
      width:40px; height:40px; border-radius:50%;
      overflow:hidden;
      box-shadow: 0 0 0 1px rgba(212,175,55,0.22), 0 12px 30px rgba(0,0,0,0.55);
      background: radial-gradient(circle at 35% 30%, var(--gold1), var(--gold2) 55%, rgba(212,175,55,0.12) 80%);
      display:grid; place-items:center;
      flex:0 0 auto;
    }
    .logo img{
      width:100%; height:100%; object-fit:cover; display:block;
    }
    .brand-title{
      font-family: Orbitron, Inter, system-ui;
      letter-spacing: 0.12em;
      font-size: 14px;
      color: rgba(241,230,163,0.92);
    }
    .nav{
      display:flex; align-items:center; gap:10px;
      flex:1;
      justify-content:center;
    }
    .chip{
      font-size: 13px;
      color: rgba(255,255,255,0.86);
      text-decoration:none;
      padding:9px 12px;
      border-radius: 999px;
      border:1px solid var(--chipLine);
      background: linear-gradient(180deg, rgba(247,243,232,0.06), rgba(247,243,232,0.03));
      transition: transform .15s ease, border-color .15s ease, background .15s ease;
      white-space:nowrap;
    }
    .chip:hover{transform: translateY(-1px); border-color: rgba(212,175,55,0.35)}
    .chip.active{
      border-color: rgba(212,175,55,0.55);
      background: linear-gradient(180deg, rgba(212,175,55,0.18), rgba(247,243,232,0.04));
      color: rgba(241,230,163,0.98);
    }
    .cta{
      font-family: Orbitron, Inter;
      letter-spacing:0.08em;
      font-size: 12px;
      padding:10px 14px;
      border-radius: 999px;
      border:0;
      cursor:pointer;
      color:#111;
      background: linear-gradient(135deg, var(--gold1), var(--gold2));
      box-shadow: 0 14px 34px rgba(212,175,55,0.18);
      text-decoration:none;
      display:inline-flex; align-items:center; gap:8px;
      white-space:nowrap;
    }
    .cta:hover{filter: brightness(1.03)}
    .divider{
      height:1px;
      background: linear-gradient(90deg, transparent, rgba(212,175,55,0.26), transparent);
    }

    /* Hero */
    .hero{
      padding: 44px 0 26px;
    }
    .hero-grid{
      display:grid;
      grid-template-columns: 1.2fr 0.8fr;
      gap: 22px;
      align-items:start;
    }
    .badges{display:flex; gap:10px; flex-wrap:wrap; margin-bottom:14px;}
    .badge{
      font-family: Orbitron, Inter;
      font-size: 11px;
      letter-spacing:0.08em;
      padding:8px 10px;
      border-radius: 999px;
      border:1px solid rgba(212,175,55,0.28);
      background: rgba(247,243,232,0.05);
      color: rgba(241,230,163,0.9);
    }
    h1{
      font-family: Orbitron, Inter;
      font-size: clamp(34px, 4vw, 58px);
      line-height: 1.06;
      letter-spacing: 0.02em;
      margin: 0 0 12px;
      color: rgba(255,255,255,0.96);
    }
    h1 .gold{color: rgba(241,230,163,0.95)}
    .lead{
      font-size: 16px;
      line-height: 1.7;
      color: rgba(255,255,255,0.82);
      max-width: 64ch;
      margin: 0 0 18px;
    }
    .lead em{font-style:normal; color: rgba(241,230,163,0.92)}
    .note{
      margin-top: 10px;
      font-size: 13px;
      color: rgba(255,255,255,0.65);
    }
    .note strong{color: rgba(241,230,163,0.92)}
    .panel{
      border-radius: var(--radius);
      border: 1px solid rgba(212,175,55,0.22);
      background: linear-gradient(180deg, rgba(11,15,20,0.88), rgba(7,10,16,0.92));
      box-shadow: var(--shadow);
      padding: 18px 18px 16px;
      position:relative;
    }
    .panel::before{
      content:"";
      position:absolute; left:18px; right:18px; top:0;
      height:2px;
      background: linear-gradient(90deg, transparent, rgba(212,175,55,0.6), transparent);
      opacity:0.8;
    }
    .panel h3{
      font-family: Orbitron, Inter;
      font-size: 14px;
      letter-spacing:0.10em;
      margin: 8px 0 10px;
      color: rgba(241,230,163,0.92);
    }
    .panel ul{margin:10px 0 0; padding-left: 18px; color: rgba(255,255,255,0.78); line-height:1.6; font-size: 13.5px;}
    .panel li{margin: 6px 0;}
    .panel .tag{
      position:absolute; top:14px; right:14px;
      font-family: Orbitron, Inter;
      font-size: 11px;
      letter-spacing:0.10em;
      padding:8px 10px;
      border-radius: 999px;
      border:1px solid rgba(212,175,55,0.28);
      background: rgba(247,243,232,0.04);
      color: rgba(241,230,163,0.9);
    }

    /* Main two columns */
    .main{
      padding: 16px 0 36px;
    }
    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 18px;
    }

    .card{
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(251,248,241,0.98), rgba(247,243,232,0.95));
      border: 1px solid rgba(212,175,55,0.30);
      box-shadow: var(--shadow);
      color: var(--ink);
      overflow:hidden;
      position:relative;
    }
    .card::before{
      content:"";
      position:absolute; left:18px; right:18px; top:0;
      height:2px;
      background: linear-gradient(90deg, transparent, rgba(212,175,55,0.75), transparent);
    }
    .card-head{
      padding: 18px 18px 10px;
      display:flex; align-items:flex-end; justify-content:space-between; gap:12px;
    }
    .card-head h2{
      margin:0;
      font-family: Orbitron, Inter;
      font-size: 14px;
      letter-spacing:0.14em;
      color: #2b2b2b;
    }
    .card-head .sub{
      font-size: 13px;
      color: rgba(0,0,0,0.62);
      line-height:1.5;
    }
    .card-body{padding: 6px 18px 18px;}
    .field{margin: 12px 0;}
    label{
      display:block;
      font-family: Orbitron, Inter;
      font-size: 11px;
      letter-spacing:0.14em;
      color: rgba(0,0,0,0.55);
      margin-bottom: 6px;
    }
    input, select, textarea{
      width:100%;
      border-radius: 12px;
      border: 1px solid rgba(0,0,0,0.12);
      background: rgba(255,255,255,0.78);
      padding: 12px 12px;
      font-size: 14px;
      outline:none;
      color: var(--ink);
    }
    textarea{min-height: 150px; resize: vertical; line-height:1.6;}
    input:focus, select:focus, textarea:focus{
      border-color: rgba(212,175,55,0.65);
      box-shadow: 0 0 0 3px rgba(212,175,55,0.16);
    }

    .btn-row{display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-top:12px;}
    .btn{
      appearance:none; border:0; cursor:pointer;
      border-radius: 999px;
      padding: 12px 14px;
      font-family: Orbitron, Inter;
      letter-spacing:0.10em;
      font-size: 12px;
      text-transform: uppercase;
      transition: transform .12s ease, filter .12s ease, box-shadow .12s ease;
    }
    .btn.primary{
      background: linear-gradient(135deg, var(--gold1), var(--gold2));
      color:#171717;
      box-shadow: 0 16px 40px rgba(212,175,55,0.22);
    }
    .btn.ghost{
      background: rgba(255,255,255,0.0);
      border: 1px solid rgba(0,0,0,0.18);
      color: rgba(0,0,0,0.70);
    }
    .btn:hover{transform: translateY(-1px); filter: brightness(1.02)}
    .btn:active{transform: translateY(0px)}
    .tiny{
      font-size:12px;
      color: rgba(0,0,0,0.55);
      margin-top:10px;
    }
    .tiny strong{color:#111}

    /* Output widgets */
    .metrics{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-top: 10px;
    }
    .metric{
      border-radius: 14px;
      border: 1px solid rgba(0,0,0,0.12);
      background: rgba(255,255,255,0.72);
      padding: 10px 12px;
      display:flex; flex-direction:column; gap:4px;
      min-height: 62px;
    }
    .metric .k{
      font-family: Orbitron, Inter;
      font-size: 10px;
      letter-spacing:0.12em;
      color: rgba(0,0,0,0.55);
    }
    .metric .v{
      font-family: Orbitron, Inter;
      font-size: 18px;
      letter-spacing:0.04em;
      color: #111;
    }
    .hashbox{
      margin-top: 10px;
      border-radius: 14px;
      border: 1px dashed rgba(0,0,0,0.26);
      background: rgba(255,255,255,0.60);
      padding: 10px 12px;
      overflow:hidden;
    }
    .hashbox .k{
      font-family: Orbitron, Inter;
      font-size: 10px;
      letter-spacing:0.12em;
      color: rgba(0,0,0,0.55);
      margin-bottom: 6px;
    }
    .hashbox code{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size: 12px;
      color: rgba(0,0,0,0.75);
      word-break: break-all;
    }

    .section-title{
      margin-top: 14px;
      padding-top: 14px;
      border-top: 1px solid rgba(0,0,0,0.12);
      font-family: Orbitron, Inter;
      font-size: 12px;
      letter-spacing:0.14em;
      color: rgba(0,0,0,0.70);
    }
    .section-sub{
      margin: 6px 0 10px;
      font-size: 13px;
      color: rgba(0,0,0,0.62);
      line-height:1.55;
    }

    table{
      width:100%;
      border-collapse: collapse;
      border: 1px solid rgba(0,0,0,0.12);
      border-radius: 14px;
      overflow:hidden;
      background: rgba(255,255,255,0.70);
    }
    th, td{
      padding: 11px 10px;
      font-size: 13px;
      border-bottom: 1px solid rgba(0,0,0,0.08);
      vertical-align: top;
    }
    th{
      font-family: Orbitron, Inter;
      font-size: 10px;
      letter-spacing:0.12em;
      color: rgba(0,0,0,0.60);
      background: rgba(0,0,0,0.03);
      text-transform: uppercase;
    }
    tr:last-child td{border-bottom:0}
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      border-radius: 999px;
      padding: 6px 10px;
      border: 1px solid rgba(0,0,0,0.12);
      font-size: 12px;
      background: rgba(255,255,255,0.65);
      white-space:nowrap;
    }
    .pill.ok{border-color: rgba(70,255,153,0.45)}
    .pill.warn{border-color: rgba(255,184,107,0.55)}
    .pill.bad{border-color: rgba(255,107,107,0.55)}
    .why{
      color: rgba(0,0,0,0.65);
      font-size: 13px;
    }

    .hl{
      border-radius: 14px;
      border: 1px solid rgba(0,0,0,0.12);
      background: rgba(255,255,255,0.70);
      padding: 12px 12px;
      margin-top: 10px;
    }
    .hl .line{margin: 8px 0; line-height:1.6; color: rgba(0,0,0,0.72); font-size: 13px;}
    mark{
      background: rgba(241,230,163,0.75);
      padding: 0 3px;
      border-radius: 6px;
    }

    .jsonbox{
      margin-top: 10px;
      border-radius: 16px;
      border: 1px solid rgba(0,0,0,0.12);
      background: linear-gradient(180deg, rgba(11,15,20,0.98), rgba(4,4,14,0.98));
      color: rgba(255,255,255,0.92);
      padding: 12px;
      overflow:auto;
      max-height: 360px;
    }
    .jsonbox pre{
      margin:0;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size: 12px;
      line-height:1.5;
      white-space: pre;
    }
    .json-actions{
      display:flex; gap:10px; flex-wrap:wrap;
      margin-top: 10px;
    }
    .smallbtn{
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,0.14);
      background: rgba(255,255,255,0.60);
      color: rgba(0,0,0,0.70);
      font-family: Orbitron, Inter;
      letter-spacing:0.10em;
      font-size: 11px;
      padding: 10px 12px;
      cursor:pointer;
    }
    .smallbtn:hover{filter: brightness(1.02)}

    /* Footer CTA bar */
    .footer-cta{
      margin-top: 18px;
      border-radius: var(--radius);
      border: 1px solid rgba(212,175,55,0.22);
      background: linear-gradient(180deg, rgba(11,15,20,0.86), rgba(7,10,16,0.92));
      box-shadow: var(--shadow);
      padding: 18px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .footer-cta p{
      margin:0;
      color: rgba(255,255,255,0.80);
      line-height:1.6;
      font-size: 13.5px;
      max-width: 70ch;
    }
    .footer-cta a{
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding: 12px 16px;
      border-radius: 999px;
      font-family: Orbitron, Inter;
      font-size: 12px;
      letter-spacing:0.10em;
      color:#111;
      background: linear-gradient(135deg, var(--gold1), var(--gold2));
      white-space:nowrap;
    }

    .fineprint{
      margin: 14px 0 34px;
      color: rgba(255,255,255,0.55);
      font-size: 12.5px;
      line-height:1.6;
    }

    /* Responsive */
    @media (max-width: 980px){
      .hero-grid{grid-template-columns: 1fr; }
      .nav{display:none;} /* keep simple on small screens */
      .grid{grid-template-columns: 1fr;}
    }
  </style>
</head>

<body>
  <div class="stars" aria-hidden="true"></div>

  <div class="wrap">
    <header>
      <div class="container">
        <div class="topbar">
          <div class="brand">
            <div class="logo" aria-label="OpenProof logo">
              <!-- If this image fails, the gold orb background remains (no broken icon). -->
              <img
                src="assets/openproof-logo.png"
                alt=""
                onerror="this.remove();"
              />
            </div>
            <div class="brand-title">OPENPROOF.NET — RPO v0.1</div>
          </div>

          <nav class="nav" aria-label="primary">
            <a class="chip active" href="sandbox.html" target="_blank" rel="noopener noreferrer">Sandbox</a>
            <a class="chip" href="how-it-works.html" target="_blank" rel="noopener noreferrer">How it works</a>
            <a class="chip" href="tests.html" target="_blank" rel="noopener noreferrer">Tests</a>
            <a class="chip" href="examples.html" target="_blank" rel="noopener noreferrer">Examples</a>
          </nav>

          <a class="cta" href="#sandbox" title="Jump to the sandbox">
            TRY THE LIVE DEMO
          </a>
        </div>
      </div>
      <div class="divider"></div>
    </header>

    <main class="container">
      <section class="hero" id="top">
        <div class="hero-grid">
          <div>
            <div class="badges">
              <span class="badge">EXPERIMENTAL</span>
              <span class="badge">DETERMINISTIC</span>
              <span class="badge">NO AI MODEL</span>
              <span class="badge">RPO-COMPATIBLE</span>
            </div>

            <h1>
              SANDBOX — <span class="gold">FROM A SHORT STORY</span><br/>
              TO A DRAFT RPO BUNDLE
            </h1>

            <p class="lead">
              Paste a short narrative (1–3 paragraphs). This sandbox extracts a minimal, deterministic structure:
              <em>signals, axes, thresholds</em>, and generates a draft <em>rpo.json</em> plus a public <em>sha256</em> proof hash.
            </p>

            <p class="note">
              <strong>Important:</strong> the hash proves integrity, not truth. This demo is a format illustration, not legal advice.
            </p>
          </div>

          <aside class="panel">
            <div class="tag">DEMO MODE</div>
            <h3>WHAT THIS PAGE IS DESIGNED TO TRIGGER</h3>
            <ul>
              <li><strong>Relief:</strong> “I’m not crazy. My story has a structure.”</li>
              <li><strong>Clarity:</strong> “Here are the signals I can point to.”</li>
              <li><strong>Action:</strong> “I can hand a coherent bundle to a professional.”</li>
              <li><strong>Safety:</strong> no account, runs locally in your browser.</li>
            </ul>
          </aside>
        </div>
      </section>

      <section class="main" id="sandbox">
        <div class="grid">

          <!-- LEFT: INPUT -->
          <div class="card">
            <div class="card-head">
              <div>
                <h2>1. INPUT NARRATIVE</h2>
                <div class="sub">
                  Write 5–12 sentences. You may anonymize names and dates.<br/>
                  Tip: include at least one time anchor (date/time), one place, and 2–3 concrete actions.
                </div>
              </div>
            </div>

            <div class="card-body">
              <div class="field">
                <label for="context">CONTEXT</label>
                <select id="context">
                  <option value="work">Workplace</option>
                  <option value="family">Family / custody</option>
                  <option value="institution">Institutional</option>
                  <option value="cyber">Cyber / online</option>
                  <option value="other">Other</option>
                </select>
              </div>

              <div class="field">
                <label for="caseTitle">CASE TITLE</label>
                <input id="caseTitle" type="text" placeholder="Example: Incident in Paris office — March 2024" />
              </div>

              <div class="field">
                <label for="issuer">ISSUER (WHO FILES THE BUNDLE)</label>
                <input id="issuer" type="text" placeholder="Example: Internal audit team, Company X" />
              </div>

              <div class="field">
                <label for="subject">SUBJECT (WHO / WHAT IS CONCERNED)</label>
                <input id="subject" type="text" placeholder="Example: Employee — Sales department" />
              </div>

              <div class="field">
                <label for="narrative">NARRATIVE (FREE TEXT)</label>
                <textarea id="narrative" placeholder="Paste your short narrative here…"></textarea>
              </div>

              <div class="tiny">
                This sandbox does not store your text. Refreshing the page clears everything.
              </div>

              <div class="btn-row">
                <button class="btn primary" id="analyzeBtn">ANALYZE & GENERATE DRAFT BUNDLE</button>
                <button class="btn ghost" id="loadBtn">LOAD EXAMPLE</button>
                <button class="btn ghost" id="resetBtn">RESET</button>
              </div>

              <div class="tiny" style="margin-top:12px;">
                <strong>No AI.</strong> Conservative rules only. Same input → same output.
              </div>
            </div>
          </div>

          <!-- RIGHT: OUTPUT -->
          <div class="card">
            <div class="card-head">
              <div>
                <h2>2. DRAFT RPO BUNDLE</h2>
                <div class="sub">
                  Deterministic extraction: basic anchors, signals, axes, and thresholds.
                  The goal is to create a coherent handover (not a judgment).
                </div>
              </div>
            </div>

            <div class="card-body">

              <div class="metrics">
                <div class="metric">
                  <div class="k">PHRASES</div>
                  <div class="v" id="mPhrases">—</div>
                </div>
                <div class="metric">
                  <div class="k">SIGNALS</div>
                  <div class="v" id="mSignals">—</div>
                </div>
                <div class="metric">
                  <div class="k">COHERENCE SCORE</div>
                  <div class="v" id="mCoh">—</div>
                </div>

                <div class="metric">
                  <div class="k">DATES DETECTED</div>
                  <div class="v" id="mDates">—</div>
                </div>
                <div class="metric">
                  <div class="k">PLACES DETECTED</div>
                  <div class="v" id="mPlaces">—</div>
                </div>
                <div class="metric">
                  <div class="k">CHRONOLOGY CONFIDENCE</div>
                  <div class="v" id="mChrono">—</div>
                </div>
              </div>

              <div class="hashbox">
                <div class="k">PUBLIC_HASH (SHA256)</div>
                <code id="pubHash">—</code>
              </div>

              <div class="section-title">CANONICAL MAP (SIGNALS → AXES → THRESHOLDS)</div>
              <div class="section-sub">
                Draft table — conservative and approximate. It is meant to be readable and actionable.
              </div>

              <table aria-label="canonical map">
                <thead>
                  <tr>
                    <th style="width:34%;">AXIS</th>
                    <th style="width:22%;">LEVEL</th>
                    <th>WHY (SIGNALS)</th>
                  </tr>
                </thead>
                <tbody id="axisRows">
                  <tr>
                    <td><strong>Isolation / confinement</strong></td>
                    <td><span class="pill ok">None</span></td>
                    <td class="why">—</td>
                  </tr>
                  <tr>
                    <td><strong>Threats / coercion</strong></td>
                    <td><span class="pill ok">None</span></td>
                    <td class="why">—</td>
                  </tr>
                  <tr>
                    <td><strong>Control of communications</strong></td>
                    <td><span class="pill ok">None</span></td>
                    <td class="why">—</td>
                  </tr>
                  <tr>
                    <td><strong>Economic / resource control</strong></td>
                    <td><span class="pill ok">None</span></td>
                    <td class="why">—</td>
                  </tr>
                  <tr>
                    <td><strong>Harassment / humiliation</strong></td>
                    <td><span class="pill ok">None</span></td>
                    <td class="why">—</td>
                  </tr>
                  <tr>
                    <td><strong>Privacy / surveillance</strong></td>
                    <td><span class="pill ok">None</span></td>
                    <td class="why">—</td>
                  </tr>
                </tbody>
              </table>

              <div class="section-title" style="margin-top:16px;">HIGHLIGHTED SENSITIVE PASSAGES</div>
              <div class="section-sub">
                Passages are highlighted when they contain strong markers (threats, confinement, surveillance, economic pressure…).
              </div>

              <div class="hl" id="highlights">
                <div class="line">— Nothing yet. Click “Analyze”.</div>
              </div>

              <div class="section-title" style="margin-top:16px;">RPO.JSON (DRAFT)</div>
              <div class="json-actions">
                <button class="smallbtn" id="copyBtn">COPY JSON</button>
                <button class="smallbtn" id="dlBtn">DOWNLOAD RPO.JSON</button>
              </div>

              <div class="jsonbox" aria-label="rpo json box">
                <pre id="jsonOut">{}</pre>
              </div>

            </div>
          </div>
        </div>

        <div class="footer-cta" style="margin-top:18px;">
          <p>
            Want the full pilot (CNRS × TruthX): interpretive coherence, structured narrative layers, advanced signal fusion,
            and a human-readable probative report designed for professionals.
          </p>
          <a href="https://www.truthx.co/truthx-pilote-form" target="_blank" rel="noopener noreferrer">
            REQUEST PILOT ACCESS
          </a>
        </div>

        <div class="fineprint">
          This sandbox illustrates a public format. It does not host case data, and it does not decide truth. It reveals structure.
        </div>
      </section>
    </main>
  </div>

  <script>
    // ---------------------------
    // Deterministic helpers
    // ---------------------------
    const $ = (id) => document.getElementById(id);

    function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }

    function splitSentences(text){
      // conservative sentence split
      const raw = (text || "").trim();
      if(!raw) return [];
      return raw
        .replace(/\s+/g," ")
        .split(/(?<=[.!?])\s+/)
        .map(s => s.trim())
        .filter(Boolean);
    }

    function detectDates(text){
      const t = text || "";
      const patterns = [
        /\b\d{1,2}\s+(Jan|January|Feb|February|Mar|March|Apr|April|May|Jun|June|Jul|July|Aug|August|Sep|Sept|September|Oct|October|Nov|November|Dec|December)\b\.?\s*\d{2,4}\b/gi,
        /\b(0?[1-9]|[12]\d|3[01])[\/\-.](0?[1-9]|1[0-2])[\/\-.](\d{2}|\d{4})\b/g,
        /\b(19|20)\d{2}\b/g,
        /\b(today|yesterday|tomorrow)\b/gi,
        /\b(around|at)\s+\d{1,2}(:\d{2})?\s*(am|pm)?\b/gi
      ];
      const hits = new Set();
      patterns.forEach(rx=>{
        const m = t.match(rx);
        if(m) m.forEach(x=>hits.add(x.trim()));
      });
      return Array.from(hits);
    }

    function detectPlaces(text){
      // minimal heuristic: capitalized words that look like places + some keywords
      const t = (text || "");
      const placeKeywords = /\b(office|court|school|hospital|station|airport|home|apartment|police|paris|london|berlin|rome|sydney|rouen|caen)\b/gi;
      const caps = t.match(/\b[A-Z][a-z]{2,}\b/g) || [];
      const kw = t.match(placeKeywords) || [];
      const merged = new Set([...caps, ...kw.map(x=>x.charAt(0).toUpperCase()+x.slice(1).toLowerCase())]);
      // keep it conservative: limit and filter obvious non-places
      const blacklist = new Set(["March","Later","Several","Internal","Company","Employee","Subject","Issuer"]);
      return Array.from(merged).filter(x=>!blacklist.has(x)).slice(0,8);
    }

    // signal lexicon (simple & conservative)
    const SIGNALS = [
      { key:"threat", axis:"Threats / coercion", rx:/\b(threat|threaten|ultimatum|blackmail|coerc|intimidat|pressure|forced)\w*\b/i },
      { key:"isolate", axis:"Isolation / confinement", rx:/\b(isolat|forbid|prevent|kept\s+me\s+from|couldn[’']?t\s+leave|locked|confin)\w*\b/i },
      { key:"comms", axis:"Control of communications", rx:/\b(phone|email|messages?\s+monitored|blocked|password|access\s+revoked|no\s+contact)\b/i },
      { key:"economic", axis:"Economic / resource control", rx:/\b(account|salary|money|bank|expenses|resources?\s+cut|budget|withheld|keys?\s+removed)\b/i },
      { key:"harass", axis:"Harassment / humiliation", rx:/\b(humiliat|shout|yell|insult|mock|publicly|ridicule|harass)\w*\b/i },
      { key:"surveil", axis:"Privacy / surveillance", rx:/\b(track|surveil|spy|stalk|camera|record(ed)?|screenshots?|location)\w*\b/i },
    ];

    function extractSignals(text){
      const sentences = splitSentences(text);
      const found = [];
      const highlights = [];
      sentences.forEach(s=>{
        SIGNALS.forEach(sig=>{
          if(sig.rx.test(s)){
            found.push({key:sig.key, axis:sig.axis, cue: sig.key});
            // highlight key matched word(s) roughly by marking the first match
            const m = s.match(sig.rx);
            const marked = m ? s.replace(sig.rx, (w)=>`<mark>${w}</mark>`) : s;
            highlights.push(marked);
          }
        });
      });
      // unique signals by axis (keep count)
      const perAxis = {};
      found.forEach(f=>{
        perAxis[f.axis] = perAxis[f.axis] || new Set();
        perAxis[f.axis].add(f.cue);
      });
      return { found, perAxis, highlights: Array.from(new Set(highlights)).slice(0,5) };
    }

    function computeChronologyConfidence(dates, sentences){
      // very rough: more anchors + more sentences => higher, but conservative
      const d = dates.length;
      const s = sentences.length;
      const score = clamp(Math.round((d*18) + (s*4)), 10, 92);
      return score;
    }

    function computeCohScore(sentences, dates, places, signalsCount){
      // conservative: structure anchors and concrete signals give coherence
      const s = sentences.length;
      const d = dates.length;
      const p = places.length;
      const sig = signalsCount;

      let score = 35;
      score += clamp(s*4, 0, 22);
      score += clamp(d*10, 0, 20);
      score += clamp(p*6, 0, 18);
      score += clamp(sig*7, 0, 22);
      return clamp(Math.round(score), 25, 95);
    }

    async function sha256Hex(str){
      const enc = new TextEncoder();
      const data = enc.encode(str);
      const hash = await crypto.subtle.digest("SHA-256", data);
      const bytes = new Uint8Array(hash);
      return Array.from(bytes).map(b=>b.toString(16).padStart(2,"0")).join("");
    }

    function axisLevelPill(level, cuesCount){
      // levels: None / Present (1–2 cues) / Strong (>=3 cues)
      if(level === "none"){
        return `<span class="pill ok">None</span>`;
      }
      if(level === "present"){
        return `<span class="pill warn">Present — ${cuesCount} cue${cuesCount>1?"s":""}</span>`;
      }
      return `<span class="pill bad">Strong — ${cuesCount} cues</span>`;
    }

    function buildAxisTable(perAxis){
      const axes = [
        "Isolation / confinement",
        "Threats / coercion",
        "Control of communications",
        "Economic / resource control",
        "Harassment / humiliation",
        "Privacy / surveillance"
      ];

      const rows = axes.map(axis=>{
        const cues = perAxis[axis] ? Array.from(perAxis[axis]) : [];
        const n = cues.length;
        let level = "none";
        if(n >= 1 && n <= 2) level = "present";
        if(n >= 3) level = "strong";

        const why = n ? cues.join(", ") : "—";
        return `
          <tr>
            <td><strong>${axis}</strong></td>
            <td>${axisLevelPill(level, n)}</td>
            <td class="why">${escapeHtml(why)}</td>
          </tr>
        `;
      }).join("");

      $("axisRows").innerHTML = rows;
    }

    function escapeHtml(s){
      return String(s).replace(/[&<>"']/g, m => ({
        "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#039;"
      }[m]));
    }

    function setHighlights(lines){
      const box = $("highlights");
      if(!lines.length){
        box.innerHTML = `<div class="line">— Nothing yet. Click “Analyze”.</div>`;
        return;
      }
      box.innerHTML = lines.map(l=>`<div class="line">• ${l}</div>`).join("");
    }

    function download(filename, text){
      const blob = new Blob([text], {type:"application/json"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    }

    function resetAll(){
      $("context").value = "work";
      $("caseTitle").value = "";
      $("issuer").value = "";
      $("subject").value = "";
      $("narrative").value = "";

      ["mPhrases","mSignals","mCoh","mDates","mPlaces","mChrono"].forEach(id=>$(id).textContent="—");
      $("pubHash").textContent = "—";
      $("jsonOut").textContent = "{}";
      buildAxisTable({});
      setHighlights([]);
    }

    // ---------------------------
    // Example
    // ---------------------------
    const EXAMPLE = {
      context: "work",
      caseTitle: "Incident in Paris office — March 2024",
      issuer: "Internal audit team, Company X",
      subject: "Employee — Sales department",
      narrative:
`On 14 March 2024, around 10:30 am, an argument broke out in the Paris office between a line manager and a sales employee.
Several colleagues report that the manager raised his voice, threatened to remove key accounts from the employee, and asked him to leave the open space immediately.
Later that day, around 3 pm, the same manager sent an email copying HR, questioning the employee’s “loyalty” and suggesting he should be excluded from client meetings.
No formal warning or prior evaluation had been communicated before this incident.`
    };

    function loadExample(){
      $("context").value = EXAMPLE.context;
      $("caseTitle").value = EXAMPLE.caseTitle;
      $("issuer").value = EXAMPLE.issuer;
      $("subject").value = EXAMPLE.subject;
      $("narrative").value = EXAMPLE.narrative;
    }

    // ---------------------------
    // Analysis
    // ---------------------------
    async function analyze(){
      const context = $("context").value;
      const caseTitle = $("caseTitle").value.trim() || "Untitled case";
      const issuer = $("issuer").value.trim() || "Unknown issuer";
      const subject = $("subject").value.trim() || "Unknown subject";
      const narrative = $("narrative").value.trim();

      const sentences = splitSentences(narrative);
      const dates = detectDates(narrative);
      const places = detectPlaces(narrative);
      const { found, perAxis, highlights } = extractSignals(narrative);

      // conservative counts
      const phrases = sentences.length;
      const signalsCount = Object.keys(perAxis).reduce((acc,k)=>acc + (perAxis[k]?.size||0), 0);

      const chrono = computeChronologyConfidence(dates, sentences);
      const coh = computeCohScore(sentences, dates, places, signalsCount);

      // deterministic hash input (stable order)
      const hashInput = JSON.stringify({
        v:"0.1",
        context, caseTitle, issuer, subject,
        narrative: narrative.replace(/\s+/g," ").trim()
      });
      const pub = narrative ? await sha256Hex(hashInput) : "—";

      // minimal draft rpo.json
      const now = new Date().toISOString();
      const bundleId = pub !== "—" ? `rpo-${pub.slice(0,8)}-${pub.slice(-4)}` : "rpo-empty";
      const rpo = {
        rpo_version: "0.1",
        bundle_id: bundleId,
        created_at: now,
        issuer: { label: issuer },
        subject: { label: subject },
        case: {
          title: caseTitle,
          context: context,
          summary: sentences.slice(0,2).join(" "),
          anchors: {
            dates: dates.slice(0,8),
            places: places.slice(0,8)
          }
        },
        extraction: {
          deterministic: true,
          notes: "This is a conservative heuristic extraction. It proves structure, not truth.",
          metrics: {
            phrases,
            dates_detected: dates.length,
            places_detected: places.length,
            signals_detected: signalsCount,
            coherence_score: coh,
            chronology_confidence: chrono
          },
          signals: Object.entries(perAxis).map(([axis,set])=>({
            axis,
            cues: Array.from(set)
          })),
          highlights: highlights.map(h=>h.replace(/<[^>]+>/g,"")) // store clean text only
        },
        integrity: {
          public_hash_sha256: pub
        }
      };

      // Paint UI
      $("mPhrases").textContent = String(phrases || 0);
      $("mSignals").textContent = String(signalsCount || 0);
      $("mCoh").textContent = narrative ? String(coh) : "—";
      $("mDates").textContent = String(dates.length || 0);
      $("mPlaces").textContent = String(places.length || 0);
      $("mChrono").textContent = narrative ? String(chrono) : "—";
      $("pubHash").textContent = pub;

      buildAxisTable(perAxis);
      setHighlights(highlights);

      $("jsonOut").textContent = JSON.stringify(rpo, null, 2);

      // keep for actions
      window.__RPO_DRAFT__ = rpo;
    }

    // ---------------------------
    // Actions
    // ---------------------------
    $("analyzeBtn").addEventListener("click", analyze);
    $("loadBtn").addEventListener("click", () => { loadExample(); analyze(); });
    $("resetBtn").addEventListener("click", resetAll);

    $("copyBtn").addEventListener("click", async () => {
      const txt = $("jsonOut").textContent || "{}";
      try{
        await navigator.clipboard.writeText(txt);
        $("copyBtn").textContent = "COPIED";
        setTimeout(()=> $("copyBtn").textContent = "COPY JSON", 900);
      }catch(e){
        alert("Copy failed. Your browser blocked clipboard access.");
      }
    });

    $("dlBtn").addEventListener("click", () => {
      const rpo = window.__RPO_DRAFT__ || {};
      download("rpo.json", JSON.stringify(rpo, null, 2));
    });

    // Default state
    resetAll();
    // Optional: gentle autofill for first-time visitors (off by default)
    // loadExample();
  </script>
</body>
</html>


