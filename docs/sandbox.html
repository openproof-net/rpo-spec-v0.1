<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>OpenProof RPO v0.1 — Sandbox</title>

  <!-- Fonts (Orbitron + Inter) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg0:#04040e;
      --bg1:#0b0f14;
      --ink:#f4f1e8;
      --muted:rgba(244,241,232,.72);
      --muted2:rgba(244,241,232,.55);

      /* Accent GOLD (accentue ici) */
      --gold:#d4af37;
      --gold2:#f1e6a3;
      --goldGlow: rgba(241,230,163,.22);
      --goldLine: rgba(212,175,55,.38);
      --goldLine2: rgba(212,175,55,.22);

      --panel: rgba(9,12,18,.62);
      --panel2: rgba(9,12,18,.42);
      --stroke: rgba(241,230,163,.18);
      --shadow: 0 20px 70px rgba(0,0,0,.55);

      /* Largeur (respire +) */
      --container: 1360px; /* monte à 1480 si tu veux */
      --radius: 18px;
      --radius2: 26px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--ink);
      background:
        radial-gradient(1200px 700px at 25% 10%, rgba(241,230,163,.14), transparent 55%),
        radial-gradient(900px 600px at 70% 20%, rgba(212,175,55,.12), transparent 60%),
        radial-gradient(1200px 900px at 70% 80%, rgba(0,0,0,.55), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow-x:hidden;
    }

    /* subtle starfield */
    .stars{
      position:fixed; inset:0;
      background-image:
        radial-gradient(1px 1px at 12% 22%, rgba(241,230,163,.28) 0, transparent 60%),
        radial-gradient(1px 1px at 55% 18%, rgba(241,230,163,.22) 0, transparent 60%),
        radial-gradient(1px 1px at 78% 34%, rgba(241,230,163,.18) 0, transparent 60%),
        radial-gradient(1px 1px at 32% 64%, rgba(241,230,163,.22) 0, transparent 60%),
        radial-gradient(1px 1px at 88% 78%, rgba(241,230,163,.18) 0, transparent 60%),
        radial-gradient(1px 1px at 8% 85%, rgba(241,230,163,.16) 0, transparent 60%),
        radial-gradient(1px 1px at 48% 88%, rgba(241,230,163,.14) 0, transparent 60%);
      opacity:.65;
      pointer-events:none;
      filter: blur(.2px);
    }

    .wrap{position:relative; z-index:1}
    .container{max-width:var(--container); margin:0 auto; padding:0 24px}

    /* NAV */
    header{
      position:sticky; top:0; z-index:5;
      backdrop-filter: blur(10px);
      background: linear-gradient(180deg, rgba(4,4,14,.86), rgba(4,4,14,.58));
      border-bottom:1px solid rgba(241,230,163,.10);
    }
    .nav{
      display:flex; align-items:center; justify-content:space-between;
      padding:14px 0;
      gap:18px;
    }
    .brand{
      display:flex; align-items:center; gap:12px;
      letter-spacing:.12em;
      font-family: Orbitron, sans-serif;
      font-size:12px;
      text-transform:uppercase;
      color:rgba(241,230,163,.82);
    }
    .dot{
      width:12px; height:12px; border-radius:999px;
      background: radial-gradient(circle at 30% 30%, var(--gold2), var(--gold));
      box-shadow: 0 0 0 6px rgba(241,230,163,.08), 0 0 28px rgba(241,230,163,.20);
    }
    nav a{
      color:rgba(244,241,232,.68);
      text-decoration:none;
      font-size:13px;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid transparent;
    }
    nav a:hover{color:rgba(244,241,232,.9); border-color:rgba(241,230,163,.14); background:rgba(9,12,18,.35)}
    nav a.active{
      color:rgba(241,230,163,.95);
      border-color:rgba(241,230,163,.24);
      background:rgba(9,12,18,.42)
    }
    .ctaTop{
      display:flex; gap:10px; align-items:center;
    }
    .btn{
      appearance:none; border:1px solid rgba(241,230,163,.18);
      background:rgba(9,12,18,.35);
      color:rgba(244,241,232,.86);
      border-radius:999px;
      padding:10px 14px;
      font-size:12px;
      letter-spacing:.12em;
      text-transform:uppercase;
      cursor:pointer;
      transition: transform .15s ease, border-color .15s ease, background .15s ease;
    }
    .btn:hover{transform: translateY(-1px); border-color:rgba(241,230,163,.28); background:rgba(9,12,18,.50)}
    .btnGold{
      background: linear-gradient(180deg, rgba(241,230,163,.95), rgba(212,175,55,.95));
      color:#10121a;
      border-color: rgba(241,230,163,.55);
      box-shadow: 0 18px 50px rgba(212,175,55,.18);
    }
    .btnGold:hover{transform: translateY(-1px); filter:saturate(1.08)}
    .btnSmall{padding:8px 12px; font-size:11px}

    /* HERO */
    .hero{padding:46px 0 22px}
    .kicker{
      font-family: Orbitron, sans-serif;
      font-size:11px;
      letter-spacing:.18em;
      text-transform:uppercase;
      color:rgba(241,230,163,.72);
      margin:0 0 14px;
    }
    .hgrid{
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap:22px;
      align-items:start;
    }
    h1{
      margin:0;
      font-family: Orbitron, sans-serif;
      font-weight:700;
      letter-spacing:.02em;
      line-height:1.02;
      font-size: clamp(34px, 4.2vw, 64px);
      text-transform: none;
    }
    .accent{color:rgba(241,230,163,.96)}
    .lead{
      margin:16px 0 14px;
      color:rgba(244,241,232,.74);
      max-width: 72ch;
      line-height:1.55;
      font-size:14px;
    }
    .chips{display:flex; flex-wrap:wrap; gap:8px; margin:14px 0 16px}
    .chip{
      font-size:11px;
      color:rgba(241,230,163,.86);
      border:1px solid rgba(241,230,163,.16);
      background: rgba(9,12,18,.40);
      padding:7px 10px;
      border-radius:999px;
      letter-spacing:.04em;
      white-space:nowrap;
    }
    .heroActions{display:flex; gap:12px; align-items:center; flex-wrap:wrap; margin-top:12px}
    .fineprint{
      margin-top:10px;
      font-size:12px;
      color:rgba(244,241,232,.55);
      line-height:1.45;
    }

    /* GLASS CARD */
    .card{
      border-radius: var(--radius2);
      background: linear-gradient(180deg, rgba(9,12,18,.55), rgba(9,12,18,.38));
      border:1px solid rgba(241,230,163,.18);
      box-shadow: var(--shadow);
      position:relative;
      overflow:hidden;
    }
    .card::before{
      content:"";
      position:absolute; inset:-2px;
      background: radial-gradient(900px 380px at 30% 10%, rgba(241,230,163,.12), transparent 60%);
      pointer-events:none;
      opacity:.9;
    }
    .cardInner{position:relative; padding:18px 18px 16px}
    .cardTitle{
      display:flex; justify-content:space-between; align-items:center; gap:10px;
      margin-bottom:10px;
      font-family: Orbitron, sans-serif;
      letter-spacing:.14em;
      text-transform:uppercase;
      font-size:11px;
      color:rgba(241,230,163,.78);
    }
    .pills{display:flex; gap:8px; flex-wrap:wrap}
    .pill{
      font-size:10px;
      letter-spacing:.10em;
      text-transform:uppercase;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(241,230,163,.18);
      background: rgba(9,12,18,.38);
      color:rgba(244,241,232,.70);
    }
    .kv{
      margin-top:12px;
      width:100%;
      border-collapse: collapse;
      font-size:12px;
      color:rgba(244,241,232,.78);
    }
    .kv td{
      padding:10px 0;
      border-top:1px solid rgba(241,230,163,.12);
      vertical-align:top;
    }
    .kv td:first-child{color:rgba(244,241,232,.55); width:34%}
    .kv td:last-child{color:rgba(241,230,163,.88); text-align:right}
    .bar{
      margin-top:14px;
      border-top:1px solid rgba(241,230,163,.12);
      padding-top:12px;
      display:flex; justify-content:space-between; align-items:center; gap:10px;
      font-size:11px;
      color:rgba(244,241,232,.55);
    }
    .progress{
      flex:1;
      height:8px;
      border-radius:999px;
      background: rgba(241,230,163,.10);
      border:1px solid rgba(241,230,163,.10);
      overflow:hidden;
    }
    .progress > i{
      display:block; height:100%;
      width: 42%;
      background: linear-gradient(90deg, rgba(241,230,163,.95), rgba(212,175,55,.95));
      filter:saturate(1.15);
    }

    /* MAIN GRID (Sandbox) */
    .main{padding:18px 0 56px}
    .grid2{
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap:18px;
      align-items:start;
    }
    .panel{
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(9,12,18,.56), rgba(9,12,18,.36));
      border:1px solid rgba(241,230,163,.16);
      box-shadow: 0 18px 60px rgba(0,0,0,.45);
      overflow:hidden;
    }
    .panelHeader{
      display:flex; justify-content:space-between; align-items:center; gap:12px;
      padding:14px 14px 12px;
      border-bottom:1px solid rgba(241,230,163,.12);
      background: rgba(9,12,18,.34);
    }
    .panelHeader h2{
      margin:0;
      font-size:11px;
      letter-spacing:.16em;
      text-transform:uppercase;
      font-family: Orbitron, sans-serif;
      color:rgba(241,230,163,.78);
      font-weight:600;
    }
    .panelBody{padding:14px}
    .row2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    label{
      display:block;
      font-size:11px;
      letter-spacing:.10em;
      text-transform:uppercase;
      color:rgba(244,241,232,.55);
      margin:0 0 8px;
      font-family: Orbitron, sans-serif;
    }
    input, select, textarea{
      width:100%;
      border-radius: 12px;
      border:1px solid rgba(241,230,163,.14);
      background: rgba(4,4,14,.36);
      color:rgba(244,241,232,.88);
      padding:11px 12px;
      outline:none;
      font-size:13px;
    }
    textarea{min-height:86px; resize:vertical; line-height:1.45}
    input:focus, select:focus, textarea:focus{
      border-color: rgba(241,230,163,.32);
      box-shadow: 0 0 0 4px rgba(241,230,163,.08);
    }

    .checkGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin-top:10px;
    }
    .check{
      display:flex; gap:10px; align-items:flex-start;
      padding:10px 10px;
      border-radius: 14px;
      border:1px solid rgba(241,230,163,.12);
      background: rgba(9,12,18,.28);
    }
    .check input{width:auto; margin-top:2px}
    .check b{
      display:block;
      font-size:12px;
      color:rgba(244,241,232,.86);
      margin-bottom:3px;
    }
    .check span{
      display:block;
      font-size:11px;
      color:rgba(244,241,232,.55);
      line-height:1.35;
    }

    .subCards{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
      margin-top:12px;
    }
    .mini{
      border-radius: 14px;
      border:1px solid rgba(241,230,163,.12);
      background: rgba(9,12,18,.26);
      padding:12px;
      min-height:86px;
    }
    .mini h3{
      margin:0 0 8px;
      font-size:10px;
      letter-spacing:.16em;
      text-transform:uppercase;
      font-family: Orbitron, sans-serif;
      color:rgba(241,230,163,.72);
      font-weight:600;
    }
    .mini p{
      margin:0;
      font-size:12px;
      color:rgba(244,241,232,.62);
      line-height:1.45;
    }

    .actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      margin-top:14px;
      padding-top:12px;
      border-top:1px solid rgba(241,230,163,.10);
    }
    .hint{
      margin-top:8px;
      font-size:11px;
      color:rgba(244,241,232,.50);
      line-height:1.4;
    }

    /* OUTPUT PANEL */
    .badges{
      display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end;
    }
    .badge{
      font-size:10px;
      letter-spacing:.12em;
      text-transform:uppercase;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(241,230,163,.16);
      background: rgba(9,12,18,.35);
      color:rgba(244,241,232,.70);
    }
    .badge strong{color:rgba(241,230,163,.92); font-weight:600}
    .scoreLine{
      display:flex; justify-content:space-between; gap:10px;
      padding:10px 0;
      border-top:1px solid rgba(241,230,163,.10);
      font-size:12px;
      color:rgba(244,241,232,.70);
    }
    .scoreLine b{color:rgba(241,230,163,.88)}
    .tabs{
      display:flex; gap:8px; flex-wrap:wrap;
      margin:12px 0 10px;
    }
    .tab{
      padding:8px 10px;
      border-radius:999px;
      border:1px solid rgba(241,230,163,.14);
      background: rgba(9,12,18,.32);
      color:rgba(244,241,232,.70);
      font-size:11px;
      letter-spacing:.12em;
      text-transform:uppercase;
      cursor:pointer;
    }
    .tab.active{
      color:#12131b;
      border-color: rgba(241,230,163,.52);
      background: linear-gradient(180deg, rgba(241,230,163,.92), rgba(212,175,55,.92));
    }
    pre{
      margin:0;
      padding:12px;
      border-radius: 14px;
      border:1px solid rgba(241,230,163,.12);
      background: rgba(4,4,14,.38);
      color: rgba(244,241,232,.78);
      font-size:12px;
      line-height:1.4;
      overflow:auto;
      max-height: 300px;
      white-space: pre-wrap;
      word-break: break-word;
    }

    .footerNote{
      margin-top:10px;
      font-size:11px;
      color:rgba(244,241,232,.52);
      line-height:1.45;
    }

    /* Responsive */
    @media (max-width: 980px){
      .hgrid, .grid2{grid-template-columns: 1fr}
    }
    @media (max-width: 560px){
      .row2, .checkGrid, .subCards{grid-template-columns: 1fr}
      nav{display:none}
    }

    /* Print view for "PDF" */
    .printSheet{
      display:none;
    }
    @media print{
      body{background:#fff; color:#000}
      header,.hero,.main,.stars{display:none !important}
      .printSheet{display:block}
      .printSheet h1{font-family: Inter, sans-serif; font-size:18px; margin:0 0 10px}
      .printSheet pre{background:#f7f7f7; border:1px solid #ddd; color:#111}
    }
  </style>
</head>

<body>
  <div class="stars"></div>

  <div class="wrap">
    <header>
      <div class="container">
        <div class="nav">
          <div class="brand">
            <span class="dot"></span>
            <span>OPENPROOF.NET — RPO v0.1</span>
          </div>

          <nav>
            <a href="#" title="Home">Home</a>
            <a class="active" href="#" title="Sandbox">Bac à sable</a>
            <a href="#" title="How it works">Comment ça marche</a>
            <a href="#" title="Spec">Spéc.</a>
            <a href="#" title="Tests">Tests</a>
            <a href="#" title="Examples">Exemples</a>
          </nav>

          <div class="ctaTop">
            <button class="btn btnSmall" id="btnExamples">Voir un exemple</button>
            <button class="btn btnGold btnSmall" id="btnLive">Essayez la démo en direct</button>
          </div>
        </div>
      </div>
    </header>

    <section class="hero">
      <div class="container">
        <div class="hgrid">
          <div>
            <p class="kicker">Démonstration déterministe — décision RH opposable</p>
            <h1>Sandbox,<br><span class="accent">des données RH à la décision justifiée.</span></h1>
            <p class="lead">
              Ici, on ne “choisit” pas. On produit un artefact de gouvernance : périmètre, sources, règles, hypothèses,
              et un hash public pour prouver l’intégrité. Pas d’IA. Pas de stockage. Même entrée → même bundle.
            </p>

            <div class="chips">
              <span class="chip">Pas d’IA</span>
              <span class="chip">Pas de stockage</span>
              <span class="chip">Déterministe</span>
              <span class="chip">Audit-ready</span>
              <span class="chip">Hash SHA-256 public</span>
            </div>

            <div class="heroActions">
              <button class="btn btnGold" id="btnScroll">Générer un bundle</button>
              <button class="btn" id="btnSpec">Lire la spécification</button>
            </div>

            <div class="fineprint">
              RPO = JSON signé (logique), rendu “lisible humain” (print), + hash public. Le hash prouve l’intégrité, pas le “vrai”.
              Vérification publique. Responsabilité humaine.
            </div>
          </div>

          <!-- Preview Bundle (interactive like Home) -->
          <div class="card" id="previewCard" role="button" tabindex="0" aria-label="Preview bundle">
            <div class="cardInner">
              <div class="cardTitle">
                <span>Preview bundle (30 seconds)</span>
                <div class="pills">
                  <span class="pill">Integrity • hash public</span>
                  <span class="pill">Readability • print</span>
                  <span class="pill">Verifiability • reproductible</span>
                </div>
              </div>

              <table class="kv" aria-label="Key-value preview">
                <tr><td>Input</td><td id="pvInput">contexte décisionnel + sources déclarées</td></tr>
                <tr><td>Output</td><td id="pvOutput">decision_bundle.json + hash sha256</td></tr>
                <tr><td>Usage</td><td id="pvUsage">audit • litige • gouvernance</td></tr>
                <tr><td>Hash</td><td id="pvHash">—</td></tr>
              </table>

              <div class="bar">
                <span id="pvLeft">• bundle</span>
                <div class="progress" aria-hidden="true"><i id="pvBar"></i></div>
                <span id="pvRight">rules</span>
              </div>
            </div>
          </div>

        </div>
      </div>
    </section>

    <section class="main" id="sandbox">
      <div class="container">
        <div class="grid2">

          <!-- INPUT -->
          <div class="panel">
            <div class="panelHeader">
              <h2>Ensemble d’entrée</h2>
              <div class="badge">Scope • sources • responsabilité</div>
            </div>

            <div class="panelBody">
              <div class="row2">
                <div>
                  <label for="decisionType">Type de décision</label>
                  <select id="decisionType">
                    <option value="Nomination / mobilité sensible (rôle critique)">Nomination / mobilité sensible (rôle critique)</option>
                    <option value="Promotion (multi-critères)">Promotion (multi-critères)</option>
                    <option value="Discipline / conformité">Discipline / conformité</option>
                    <option value="Rémunération / équité interne">Rémunération / équité interne</option>
                    <option value="Accès à un périmètre restreint">Accès à un périmètre restreint</option>
                  </select>
                </div>
                <div>
                  <label for="decisionDate">Date de décision (moment T)</label>
                  <input id="decisionDate" type="date" value="2026-01-28" />
                </div>
              </div>

              <div class="row2" style="margin-top:12px">
                <div>
                  <label for="orgScope">Organisation / périmètre</label>
                  <input id="orgScope" type="text" value="Company X — France scope (multi-sites, multi-entités)" />
                </div>
                <div>
                  <label for="decisionOwner">Responsable de la décision</label>
                  <input id="decisionOwner" type="text" value="CEO / Executive committee" />
                </div>
              </div>

              <div style="margin-top:12px">
                <label for="context">Contexte court (1–3 paragraphes)</label>
                <textarea id="context">Décision sensible en environnement réglementé. Exigence de traçabilité des sources et de stabilité des définitions. La décision peut être contestée et doit rester vérifiable dans le temps.</textarea>
              </div>

              <div style="margin-top:14px">
                <label>Sources déclarées (ce qui était réellement disponible)</label>
                <div class="checkGrid">
                  <div class="check">
                    <input type="checkbox" id="srcLms" checked />
                    <div>
                      <b>LMS / Dossiers formation</b>
                      <span>Formations, habilitations, attestations documentées.</span>
                    </div>
                  </div>

                  <div class="check">
                    <input type="checkbox" id="srcHris" checked />
                    <div>
                      <b>SIRH / Historique professionnel</b>
                      <span>Rôles, ancienneté, mobilité, changements de grade.</span>
                    </div>
                  </div>

                  <div class="check">
                    <input type="checkbox" id="srcPerf" checked />
                    <div>
                      <b>Évaluations de performance</b>
                      <span>Objectifs, revues annuelles, événements formels.</span>
                    </div>
                  </div>

                  <div class="check">
                    <input type="checkbox" id="srcOps" checked />
                    <div>
                      <b>Résultats opérationnels</b>
                      <span>KPI attestés, éléments traçables.</span>
                    </div>
                  </div>

                  <div class="check">
                    <input type="checkbox" id="src360" />
                    <div>
                      <b>360 / retours d’information</b>
                      <span>Uniquement si documenté et attribuable.</span>
                    </div>
                  </div>

                  <div class="check">
                    <input type="checkbox" id="srcLegal" checked />
                    <div>
                      <b>Juridique / conformité</b>
                      <span>Contraintes, contentieux, éléments opposables.</span>
                    </div>
                  </div>
                </div>
              </div>

              <div class="subCards">
                <div class="mini">
                  <h3>Données manquantes connues</h3>
                  <p id="missingKnown">Exemple : feedback 360 non attribuable ; KPI non attestés à périmètre égal ; historique d’incident non scellé.</p>
                </div>
                <div class="mini">
                  <h3>Contraintes (facultatif)</h3>
                  <p id="constraints">Exemple : urgence, calendrier réglementaire, sensibilité sociale, audit à venir.</p>
                </div>
              </div>

              <div class="actions">
                <button class="btn btnGold" id="btnGenerate">Générer le bundle</button>
                <button class="btn" id="btnLoad">Example (neutre)</button>
                <button class="btn" id="btnReset">Réinitialiser</button>
              </div>

              <div class="hint">
                Rappel : aucune donnée n’est envoyée. Le bundle est calculé localement dans ton navigateur.
              </div>
            </div>
          </div>

          <!-- OUTPUT -->
          <div class="panel">
            <div class="panelHeader">
              <h2>Rapport de préparation à la décision</h2>
              <div class="badges">
                <span class="badge">Defensibility: <strong id="defensibility">—</strong></span>
                <span class="badge">Coverage: <strong id="coverage">—</strong></span>
                <span class="badge">Missing: <strong id="missingCount">—</strong></span>
              </div>
            </div>

            <div class="panelBody">
              <div class="scoreLine">
                <span>Capture (moment T)</span>
                <b id="capDate">—</b>
              </div>
              <div class="scoreLine">
                <span>Évaluation (déterministe)</span>
                <b id="scoreLine">—</b>
              </div>
              <div class="scoreLine">
                <span>Scellement</span>
                <b id="sealLine">—</b>
              </div>

              <div class="tabs">
                <button class="tab active" data-tab="summary">Synthèse</button>
                <button class="tab" data-tab="json">JSON</button>
                <button class="tab" data-tab="print">PDF (print)</button>
              </div>

              <div id="tab_summary">
                <pre id="summaryText">Clique “Générer le bundle”.</pre>

                <div class="actions" style="margin-top:12px">
                  <button class="btn" id="btnCopyHash">Copier le hachage</button>
                  <button class="btn" id="btnCopyJson">Copier le JSON</button>
                  <button class="btn btnGold" id="btnDownloadJson">Télécharger decision_bundle.json</button>
                </div>

                <div class="footerNote">
                  Ce rapport porte sur la justification (périmètre/sources/règles), pas sur “le vrai”.
                  L’intégrité est vérifiable via le hash public.
                </div>
              </div>

              <div id="tab_json" style="display:none">
                <pre id="jsonOut">{}</pre>
              </div>

              <div id="tab_print" style="display:none">
                <pre>Utilise “Imprimer” (Ctrl/Cmd+P) pour obtenir un PDF propre, lisible, partageable.</pre>
                <div class="actions" style="margin-top:12px">
                  <button class="btn btnGold" id="btnPrint">Imprimer / Export PDF</button>
                </div>
              </div>

              <div style="margin-top:12px">
                <label>Hash (SHA-256)</label>
                <pre id="hashOut">—</pre>
              </div>
            </div>
          </div>

        </div>
      </div>
    </section>

    <!-- Hidden print sheet -->
    <section class="printSheet">
      <h1>RPO v0.1 — Decision Preparation Report</h1>
      <p><b>Date (moment T):</b> <span id="printDate">—</span></p>
      <p><b>Decision type:</b> <span id="printType">—</span></p>
      <p><b>Scope:</b> <span id="printScope">—</span></p>
      <p><b>Owner:</b> <span id="printOwner">—</span></p>
      <p><b>Coverage:</b> <span id="printCoverage">—</span> • <b>Defensibility:</b> <span id="printDef">—</span></p>
      <p><b>Hash:</b></p>
      <pre id="printHash">—</pre>
      <p><b>Bundle (JSON):</b></p>
      <pre id="printJson">{}</pre>
    </section>
  </div>

  <script>
    // --------- Helpers ----------
    const $ = (id)=>document.getElementById(id);

    function stableStringify(obj){
      // deterministic stringify with sorted keys
      const seen = new WeakSet();
      const sorter = (value)=>{
        if(value && typeof value === 'object'){
          if(seen.has(value)) return value;
          seen.add(value);

          if(Array.isArray(value)) return value.map(sorter);

          const out = {};
          Object.keys(value).sort().forEach(k=>{
            out[k] = sorter(value[k]);
          });
          return out;
        }
        return value;
      };
      return JSON.stringify(sorter(obj), null, 2);
    }

    async function sha256Hex(text){
      const enc = new TextEncoder();
      const data = enc.encode(text);
      const digest = await crypto.subtle.digest('SHA-256', data);
      const bytes = Array.from(new Uint8Array(digest));
      return bytes.map(b=>b.toString(16).padStart(2,'0')).join('');
    }

    function computeCoverage(flags){
      // simple deterministic scoring: % = (checked / total)*100
      const total = Object.keys(flags).length;
      const checked = Object.values(flags).filter(Boolean).length;
      return Math.round((checked/total)*100);
    }

    function defensibilityFrom(coverage, missing){
      // deterministic mapping (simple & explainable)
      if(coverage >= 90 && missing <= 2) return "HIGH";
      if(coverage >= 75 && missing <= 4) return "MEDIUM";
      return "LOW";
    }

    function missingFrom(flags){
      // missing = unchecked sources count (simple proxy)
      return Object.values(flags).filter(v=>!v).length;
    }

    function setPreview(hash, pct){
      $("pvHash").textContent = hash ? hash.slice(0, 10) + "…" + hash.slice(-10) : "—";
      $("pvBar").style.width = Math.max(18, Math.min(92, pct)) + "%";
    }

    function setTab(name){
      const tabs = document.querySelectorAll(".tab");
      tabs.forEach(t=>t.classList.toggle("active", t.dataset.tab === name));
      $("tab_summary").style.display = (name==="summary") ? "block" : "none";
      $("tab_json").style.display = (name==="json") ? "block" : "none";
      $("tab_print").style.display = (name==="print") ? "block" : "none";
    }

    // --------- Main generation ----------
    async function generateBundle(fromExample=false){
      const flags = {
        lms: $("srcLms").checked,
        hris: $("srcHris").checked,
        perf: $("srcPerf").checked,
        ops: $("srcOps").checked,
        s360: $("src360").checked,
        legal: $("srcLegal").checked
      };

      const coverage = computeCoverage(flags);
      const missing = missingFrom(flags);
      const defensibility = defensibilityFrom(coverage, missing);

      const context = $("context").value.trim();
      const decisionType = $("decisionType").value;
      const date = $("decisionDate").value || new Date().toISOString().slice(0,10);
      const orgScope = $("orgScope").value.trim();
      const owner = $("decisionOwner").value.trim();

      const bundle = {
        standard: "OpenProof RPO v0.1",
        artifact_type: "HR_DECISION_DEFENSIBILITY",
        moment_t: date,
        decision: {
          type: decisionType,
          scope: orgScope,
          owner: owner,
          context: context
        },
        declared_sources: flags,
        deterministic_assessment: {
          coverage_pct: coverage,
          missing_sources: missing,
          defensibility: defensibility,
          note: "Deterministic mapping from declared sources → defensibility. No AI."
        },
        outputs: {
          json: "decision_bundle.json",
          print: "browser_print_to_pdf",
          hash: "sha256"
        }
      };

      // deterministic JSON
      const json = stableStringify(bundle);
      const hash = await sha256Hex(json);

      // Update UI
      $("capDate").textContent = date;
      $("coverage").textContent = coverage + "%";
      $("missingCount").textContent = String(missing);
      $("defensibility").textContent = defensibility;

      const score = Math.round((coverage*10) - (missing*7)); // deterministic, simple
      $("scoreLine").textContent = `Score ${Math.max(0, score)}/100 • Risk ${defensibility}`;
      $("sealLine").textContent = `SHA-256 sealed`;

      $("jsonOut").textContent = json;
      $("hashOut").textContent = hash;

      const summary =
`Décision : ${decisionType}
Périmètre : ${orgScope}
Moment T : ${date}
Sources déclarées : ${Object.entries(flags).filter(([k,v])=>v).map(([k])=>k).join(", ") || "—"}
Coverage : ${coverage}% • Missing : ${missing} • Defensibility : ${defensibility}

Lecture probatoire : périmètre + sources + règles implicites → audit & contestation possibles, sans reconstruction a posteriori.
Hash (SHA-256) : ${hash}`;
      $("summaryText").textContent = summary;

      // Preview card (interactive like Home)
      $("pvInput").textContent = "contexte décisionnel + sources déclarées";
      $("pvOutput").textContent = "decision_bundle.json + hash sha256";
      $("pvUsage").textContent = "audit • litige • gouvernance";
      setPreview(hash, coverage);

      // Print sheet
      $("printDate").textContent = date;
      $("printType").textContent = decisionType;
      $("printScope").textContent = orgScope;
      $("printOwner").textContent = owner;
      $("printCoverage").textContent = coverage + "%";
      $("printDef").textContent = defensibility;
      $("printHash").textContent = hash;
      $("printJson").textContent = json;

      // Store for copy/download
      window.__bundle_json = json;
      window.__bundle_hash = hash;
    }

    function loadExample(){
      $("decisionType").value = "Nomination / mobilité sensible (rôle critique)";
      $("decisionDate").value = "2026-01-28";
      $("orgScope").value = "Company X — France scope (multi-sites, multi-entités)";
      $("decisionOwner").value = "CEO / Executive committee";
      $("context").value =
"Décision sensible en environnement réglementé. Exigence de traçabilité des sources et stabilité des définitions.\nLa décision peut être contestée et doit rester vérifiable dans le temps.";
      $("srcLms").checked = true;
      $("srcHris").checked = true;
      $("srcPerf").checked = true;
      $("srcOps").checked = true;
      $("src360").checked = false;
      $("srcLegal").checked = true;

      generateBundle(true);
    }

    function resetAll(){
      $("context").value = "";
      $("srcLms").checked = true;
      $("srcHris").checked = true;
      $("srcPerf").checked = true;
      $("srcOps").checked = true;
      $("src360").checked = false;
      $("srcLegal").checked = true;

      $("capDate").textContent = "—";
      $("coverage").textContent = "—";
      $("missingCount").textContent = "—";
      $("defensibility").textContent = "—";
      $("scoreLine").textContent = "—";
      $("sealLine").textContent = "—";
      $("summaryText").textContent = "Clique “Générer le bundle”.";
      $("jsonOut").textContent = "{}";
      $("hashOut").textContent = "—";
      setPreview("", 42);
      window.__bundle_json = null;
      window.__bundle_hash = null;
    }

    // --------- Events ----------
    document.querySelectorAll(".tab").forEach(t=>{
      t.addEventListener("click", ()=>setTab(t.dataset.tab));
    });

    $("btnGenerate").addEventListener("click", ()=>generateBundle(false));
    $("btnLoad").addEventListener("click", loadExample);
    $("btnReset").addEventListener("click", resetAll);

    $("btnCopyHash").addEventListener("click", async ()=>{
      if(!window.__bundle_hash) return;
      await navigator.clipboard.writeText(window.__bundle_hash);
      $("btnCopyHash").textContent = "Copié";
      setTimeout(()=>$("btnCopyHash").textContent="Copier le hachage", 900);
    });

    $("btnCopyJson").addEventListener("click", async ()=>{
      if(!window.__bundle_json) return;
      await navigator.clipboard.writeText(window.__bundle_json);
      $("btnCopyJson").textContent = "Copié";
      setTimeout(()=>$("btnCopyJson").textContent="Copier le JSON", 900);
    });

    $("btnDownloadJson").addEventListener("click", ()=>{
      if(!window.__bundle_json) return;
      const blob = new Blob([window.__bundle_json], {type:"application/json"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "decision_bundle.json";
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    });

    $("btnPrint").addEventListener("click", ()=>window.print());

    // Preview card interaction (mini delight, like Home)
    const preview = $("previewCard");
    preview.addEventListener("mouseenter", ()=>{ $("pvLeft").textContent="• seal"; $("pvRight").textContent="hash"; });
    preview.addEventListener("mouseleave", ()=>{ $("pvLeft").textContent="• bundle"; $("pvRight").textContent="rules"; });
    preview.addEventListener("click", ()=>setTab("summary"));
    preview.addEventListener("keydown", (e)=>{ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); setTab("summary"); }});

    $("btnScroll").addEventListener("click", ()=>{
      document.getElementById("sandbox").scrollIntoView({behavior:"smooth", block:"start"});
    });

    // top buttons placeholders
    $("btnSpec").addEventListener("click", ()=>alert("Spec: connecte ce bouton à ta page /spec"));
    $("btnExamples").addEventListener("click", loadExample);
    $("btnLive").addEventListener("click", ()=>alert("Démo live: connecte ce bouton à ton endpoint /sandbox"));

    // init
    setPreview("", 42);
    // Option: auto-load an example on first visit
    loadExample();
  </script>
</body>
</html>


