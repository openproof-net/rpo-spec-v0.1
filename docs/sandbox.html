<!DOCTYPE html>
<html lang="en" data-page="sandbox">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OpenProof — RPO v0.1 | Sandbox</title>
  <meta name="description" content="Deterministic proof bundle simulator: scope + declared sources + deterministic rules → signed JSON + print view + SHA-256 hash. Local-only." />

  <style>
    :root{
      --bg0:#04040E;
      --bg1:#0b0f14;
      --panel: rgba(255,255,255,.045);
      --panel2: rgba(255,255,255,.03);
      --stroke: rgba(212,175,55,.24);
      --stroke2: rgba(212,175,55,.42);
      --gold:#d4af37;
      --gold2:#f1e6a3;
      --text: rgba(245,241,230,.88);
      --muted: rgba(245,241,230,.62);
      --dim: rgba(245,241,230,.42);
      --shadow: 0 18px 60px rgba(0,0,0,.55);
      --radius: 22px;
      --radius2: 18px;
      --gap: 18px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      --orbit: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      color:var(--text);
      font-family: var(--sans);
      background:
        radial-gradient(1200px 800px at 15% 10%, rgba(212,175,55,.12), transparent 60%),
        radial-gradient(900px 700px at 80% 20%, rgba(241,230,163,.08), transparent 55%),
        radial-gradient(1200px 900px at 50% 85%, rgba(212,175,55,.08), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow-x:hidden;
    }

    /* subtle stars */
    body:before{
      content:"";
      position:fixed;
      inset:0;
      pointer-events:none;
      background-image:
        radial-gradient(1px 1px at 18% 22%, rgba(255,255,255,.10) 0, transparent 60%),
        radial-gradient(1px 1px at 42% 68%, rgba(255,255,255,.08) 0, transparent 60%),
        radial-gradient(1px 1px at 76% 34%, rgba(255,255,255,.10) 0, transparent 60%),
        radial-gradient(1px 1px at 88% 72%, rgba(255,255,255,.07) 0, transparent 60%),
        radial-gradient(1px 1px at 10% 78%, rgba(255,255,255,.06) 0, transparent 60%);
      opacity:.75;
      mix-blend-mode:screen;
    }

    a{ color:inherit; text-decoration:none; }
    .wrap{ max-width:1200px; margin:0 auto; padding:20px 18px 60px; }

    /* Top Nav */
    .topbar{
      position:sticky; top:0; z-index:50;
      backdrop-filter: blur(10px);
      background: linear-gradient(180deg, rgba(4,4,14,.72), rgba(4,4,14,.35));
      border-bottom: 1px solid rgba(212,175,55,.10);
    }
    .topbar .inner{ max-width:1200px; margin:0 auto; padding:12px 18px; display:flex; align-items:center; gap:14px; }
    .brand{
      display:flex; align-items:center; gap:10px;
      font-family: var(--orbit);
      letter-spacing:.08em;
      font-size:12px;
      color: rgba(245,241,230,.80);
      white-space:nowrap;
    }
    .dot{
      width:12px; height:12px; border-radius:999px;
      background: radial-gradient(circle at 30% 30%, var(--gold2), var(--gold));
      box-shadow: 0 0 18px rgba(212,175,55,.35);
      border:1px solid rgba(212,175,55,.35);
    }
    .nav{
      display:flex; gap:10px; flex:1; justify-content:center; flex-wrap:wrap;
    }
    .chiplink{
      padding:7px 11px;
      border-radius:999px;
      border:1px solid rgba(212,175,55,.20);
      background: rgba(255,255,255,.02);
      color: rgba(245,241,230,.70);
      font-size:12px;
    }
    .chiplink:hover{ border-color:rgba(212,175,55,.45); color: rgba(245,241,230,.86); }
    .chiplink.is-active{
      background: rgba(212,175,55,.12);
      border-color: rgba(212,175,55,.65);
      color: rgba(255,245,210,.92);
    }
    .ctaTop{
      margin-left:auto;
      padding:8px 14px;
      border-radius:999px;
      border:1px solid rgba(241,230,163,.45);
      background: linear-gradient(180deg, rgba(241,230,163,.16), rgba(212,175,55,.10));
      color: rgba(255,245,210,.92);
      font-size:12px;
      letter-spacing:.03em;
      white-space:nowrap;
    }
    .ctaTop:hover{ border-color: rgba(241,230,163,.75); }

    /* Hero */
    .hero{
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap: 22px;
      align-items:start;
      margin-top: 22px;
      margin-bottom: 18px;
    }
    .kicker{
      font-size:11px;
      letter-spacing:.22em;
      color: rgba(245,241,230,.52);
      margin: 0 0 10px;
      text-transform: uppercase;
    }
    .h1{
      margin:0;
      font-family: var(--orbit);
      font-weight:700;
      letter-spacing:.02em;
      font-size: 56px;
      line-height: 1.02;
    }
    .h1 .gold{ color: rgba(241,230,163,.92); }
    .lead{
      margin:14px 0 14px;
      color: rgba(245,241,230,.70);
      font-size: 14px;
      line-height: 1.55;
      max-width: 62ch;
    }
    .chips{
      display:flex; gap:8px; flex-wrap:wrap;
      margin: 12px 0 16px;
    }
    .chip{
      font-size:11px;
      padding:6px 10px;
      border-radius: 999px;
      border:1px solid rgba(212,175,55,.20);
      background: rgba(255,255,255,.02);
      color: rgba(245,241,230,.68);
    }
    .heroActions{
      display:flex; gap:10px; flex-wrap:wrap;
      margin-top: 10px;
    }
    .btn{
      border:1px solid rgba(212,175,55,.28);
      background: rgba(255,255,255,.03);
      color: rgba(245,241,230,.85);
      padding: 12px 16px;
      border-radius: 999px;
      font-size: 12px;
      letter-spacing:.06em;
      cursor:pointer;
      transition: transform .06s ease, border-color .2s ease, background .2s ease;
      user-select:none;
    }
    .btn:hover{ border-color: rgba(212,175,55,.55); }
    .btn:active{ transform: translateY(1px); }
    .btn.primary{
      background: linear-gradient(180deg, rgba(241,230,163,.18), rgba(212,175,55,.12));
      border-color: rgba(241,230,163,.55);
      color: rgba(255,245,210,.92);
      padding: 12px 22px;
    }
    .fineprint{
      margin-top: 10px;
      font-size: 11px;
      color: rgba(245,241,230,.52);
      line-height: 1.45;
    }

    /* Panels */
    .panel{
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      border:1px solid rgba(212,175,55,.20);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      position:relative;
      overflow:hidden;
    }
    .panel:before{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(600px 200px at 20% 0%, rgba(212,175,55,.12), transparent 60%),
        radial-gradient(700px 240px at 85% 0%, rgba(241,230,163,.08), transparent 58%);
      opacity:.55;
      pointer-events:none;
    }
    .panelInner{ position:relative; padding: 16px; }

    .titleRow{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      margin-bottom: 12px;
    }
    .panelTitle{
      margin:0;
      font-family: var(--orbit);
      font-size: 12px;
      letter-spacing:.18em;
      text-transform: uppercase;
      color: rgba(245,241,230,.70);
    }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      font-size: 11px;
      padding: 7px 10px;
      border-radius:999px;
      border:1px solid rgba(212,175,55,.26);
      color: rgba(255,245,210,.88);
      background: rgba(255,255,255,.02);
      white-space:nowrap;
    }
    .pill .led{
      width:8px; height:8px; border-radius:999px;
      background: rgba(241,230,163,.9);
      box-shadow: 0 0 12px rgba(241,230,163,.35);
    }

    /* Main 50/50 grid */
    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      align-items:start;
      margin-top: 18px;
    }

    /* form */
    .formGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-bottom: 12px;
    }
    label{
      display:block;
      font-size: 10.5px;
      letter-spacing:.18em;
      text-transform: uppercase;
      color: rgba(245,241,230,.48);
      margin: 0 0 6px;
    }
    select, input, textarea{
      width:100%;
      background: rgba(4,4,14,.35);
      color: rgba(245,241,230,.86);
      border: 1px solid rgba(212,175,55,.18);
      border-radius: 14px;
      padding: 11px 12px;
      outline:none;
      font-size: 13px;
    }
    textarea{ min-height: 98px; resize: vertical; line-height:1.45; }
    select:focus, input:focus, textarea:focus{ border-color: rgba(241,230,163,.55); box-shadow: 0 0 0 3px rgba(212,175,55,.12); }

    .hint{
      font-size: 12px;
      color: rgba(245,241,230,.55);
      margin-top: 4px;
      line-height:1.4;
    }

    .sourcesGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top: 10px;
    }
    .sourceCard{
      background: rgba(255,255,255,.02);
      border:1px solid rgba(212,175,55,.18);
      border-radius: 16px;
      padding: 12px;
      display:flex;
      gap: 10px;
      align-items:flex-start;
    }
    .sourceCard:hover{ border-color: rgba(212,175,55,.38); }
    .sourceCard input{ width:auto; margin-top:3px; }
    .sourceTitle{
      font-weight:600;
      color: rgba(255,245,210,.92);
      font-size: 13px;
      margin-bottom: 4px;
    }
    .sourceDesc{
      font-size: 12px;
      color: rgba(245,241,230,.62);
      line-height: 1.35;
    }

    /* CTA row (clean) */
    .ctaRow{
      display:flex;
      gap: 10px;
      justify-content: space-between;
      align-items:center;
      margin-top: 14px;
    }
    .ctaRow .btn{ flex: 1; }
    .ctaRow .btn.primary{ flex: 1.2; }
    .localNote{
      margin-top: 10px;
      font-size: 11px;
      color: rgba(245,241,230,.52);
    }

    /* Output */
    .metricRow{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-bottom: 10px;
    }
    .metric{
      background: rgba(255,255,255,.02);
      border:1px solid rgba(212,175,55,.18);
      border-radius: 16px;
      padding: 12px;
    }
    .metric .k{
      font-size: 10.5px;
      letter-spacing:.18em;
      text-transform: uppercase;
      color: rgba(245,241,230,.48);
      margin-bottom: 8px;
    }
    .metric .v{
      font-family: var(--mono);
      font-size: 14px;
      color: rgba(255,245,210,.92);
    }

    .tabs{
      display:flex;
      gap: 8px;
      margin: 10px 0 10px;
      flex-wrap:wrap;
    }
    .tab{
      border:1px solid rgba(212,175,55,.22);
      background: rgba(255,255,255,.02);
      color: rgba(245,241,230,.78);
      padding: 8px 12px;
      border-radius: 999px;
      font-size: 12px;
      cursor:pointer;
      user-select:none;
    }
    .tab.active{
      background: rgba(212,175,55,.12);
      border-color: rgba(212,175,55,.58);
      color: rgba(255,245,210,.92);
    }

    .outBox{
      background: rgba(4,4,14,.35);
      border:1px solid rgba(212,175,55,.18);
      border-radius: 16px;
      padding: 12px;
      min-height: 210px;
      font-family: var(--mono);
      font-size: 12.5px;
      color: rgba(245,241,230,.80);
      white-space: pre-wrap;
      line-height: 1.42;
    }

    .outActions{
      display:flex;
      gap: 10px;
      margin-top: 10px;
    }
    .outActions .btn{ flex: 1; }
    .outActions .btn.primary{ flex: 1.2; }

    .hashLine{
      margin-top: 10px;
      font-family: var(--mono);
      font-size: 12px;
      color: rgba(245,241,230,.72);
      border-top: 1px solid rgba(212,175,55,.12);
      padding-top: 10px;
      overflow-wrap:anywhere;
    }

    /* Cockpit panel (top right) */
    .cockpit{
      border-radius: 26px;
    }
    .cockpitTable{
      width:100%;
      border-collapse: collapse;
      margin-top: 10px;
      font-size: 13px;
      color: rgba(245,241,230,.72);
    }
    .cockpitTable td{
      padding: 10px 0;
      border-top: 1px dashed rgba(212,175,55,.14);
      vertical-align: top;
    }
    .cockpitTable td:last-child{
      text-align:right;
      color: rgba(255,245,210,.90);
      padding-left: 14px;
    }
    .verifyRow{
      display:flex; align-items:center; gap:12px;
      margin-top: 12px;
      padding-top: 10px;
      border-top: 1px solid rgba(212,175,55,.14);
      color: rgba(245,241,230,.62);
      font-family: var(--mono);
      font-size: 12px;
    }
    .bar{
      flex:1;
      height: 8px;
      border-radius:999px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(212,175,55,.14);
      overflow:hidden;
    }
    .bar > i{
      display:block; height:100%;
      width: 0%;
      background: linear-gradient(90deg, rgba(212,175,55,.18), rgba(241,230,163,.55));
      border-right: 1px solid rgba(241,230,163,.35);
    }
    .cockpitHash{
      margin-top: 10px;
      font-family: var(--mono);
      font-size: 12px;
      color: rgba(245,241,230,.65);
      overflow-wrap:anywhere;
    }

    /* Accordion bottom */
    details.accordion{
      margin-top: 18px;
      border:1px solid rgba(212,175,55,.16);
      border-radius: 18px;
      background: rgba(255,255,255,.02);
      overflow:hidden;
    }
    details.accordion summary{
      list-style:none;
      cursor:pointer;
      padding: 12px 14px;
      display:flex; align-items:center; justify-content:space-between;
      color: rgba(245,241,230,.78);
      font-family: var(--orbit);
      letter-spacing:.12em;
      text-transform: uppercase;
      font-size: 12px;
    }
    details.accordion summary::-webkit-details-marker{ display:none; }
    .accNote{
      font-family: var(--sans);
      text-transform:none;
      letter-spacing:0;
      color: rgba(245,241,230,.55);
      font-size: 12px;
      margin-top: 4px;
    }
    .accBody{
      padding: 14px;
      border-top: 1px solid rgba(212,175,55,.12);
    }
    .accGrid{
      display:grid;
      grid-template-columns: 1.15fr 1fr 1fr;
      gap: 12px;
    }
    .mini{
      border:1px solid rgba(212,175,55,.16);
      background: rgba(4,4,14,.30);
      border-radius: 16px;
      padding: 12px;
    }
    .mini h4{
      margin:0 0 8px;
      font-family: var(--orbit);
      font-size: 12px;
      letter-spacing:.14em;
      text-transform: uppercase;
      color: rgba(245,241,230,.70);
    }
    .mini p{
      margin:0;
      font-size: 12px;
      line-height: 1.5;
      color: rgba(245,241,230,.60);
    }

    /* Footer */
    .footer{
      margin-top: 18px;
      display:flex;
      justify-content:space-between;
      gap: 12px;
      font-size: 12px;
      color: rgba(245,241,230,.45);
      padding-top: 14px;
      border-top: 1px solid rgba(212,175,55,.10);
    }
    .footer a{ color: rgba(245,241,230,.58); border-bottom: 1px dotted rgba(212,175,55,.24); }
    .footer a:hover{ color: rgba(245,241,230,.78); border-bottom-color: rgba(212,175,55,.45); }

    /* Responsive */
    @media (max-width: 980px){
      .hero{ grid-template-columns: 1fr; }
      .h1{ font-size: 44px; }
      .grid{ grid-template-columns: 1fr; }
      .accGrid{ grid-template-columns: 1fr; }
      .nav{ justify-content:flex-start; }
      .ctaTop{ display:none; }
    }
  </style>
</head>

<body>
  <div class="topbar">
    <div class="inner">
      <a class="brand" href="https://openproof.net" target="_blank" rel="noopener noreferrer">
        <span class="dot" aria-hidden="true"></span>
        OPENPROOF.NET — RPO v0.1
      </a>

      <div class="nav" role="navigation" aria-label="Primary">
        <a class="chiplink" href="https://openproof.net" target="_blank" rel="noopener noreferrer">Home</a>
        <a class="chiplink is-active" href="https://rpo.openproof.net/sandbox" target="_blank" rel="noopener noreferrer">Sandbox</a>
        <a class="chiplink" href="https://rpo.openproof.net/how-it-works" target="_blank" rel="noopener noreferrer">How it works</a>
        <a class="chiplink" href="https://rpo.openproof.net/spec" target="_blank" rel="noopener noreferrer">Spec</a>
        <a class="chiplink" href="https://rpo.openproof.net/tests" target="_blank" rel="noopener noreferrer">Tests</a>
        <a class="chiplink" href="https://rpo.openproof.net/examples" target="_blank" rel="noopener noreferrer">Examples</a>
      </div>

      <a class="ctaTop" href="https://rpo.openproof.net/live" target="_blank" rel="noopener noreferrer">TRY THE LIVE DEMO</a>
    </div>
  </div>

  <div class="wrap">
    <section class="hero">
      <div>
        <p class="kicker">Deterministic proof bundle simulator</p>
        <h1 class="h1">FREEZE THE CONTEXT.<br><span class="gold">GENERATE AN AUDITABLE DECISION BUNDLE.</span></h1>
        <p class="lead">
          This sandbox does not “choose” a candidate. It captures decision scope, declared sources and constraints,
          then generates deterministic outputs: <span style="color:rgba(255,245,210,.92)">signed JSON</span> + <span style="color:rgba(255,245,210,.92)">print view</span> + <span style="color:rgba(255,245,210,.92)">public hash (SHA-256)</span>.
          No AI. No storage. Same input → same output.
        </p>

        <div class="chips" aria-label="Key properties">
          <span class="chip">Decision scope (Moment T)</span>
          <span class="chip">Declared sources</span>
          <span class="chip">Deterministic rules</span>
          <span class="chip">Audit-ready</span>
          <span class="chip">Public hash</span>
        </div>

        <div class="heroActions">
          <button class="btn primary" id="heroGenerate">GENERATE BUNDLE</button>
          <button class="btn" id="heroLoad">LOAD EXAMPLE</button>
        </div>

        <div class="fineprint">
          RPO = signed JSON (logic) + human-readable print view + public hash.
          The hash proves integrity, not “truth”. Verification is public. Accountability remains human.
        </div>
      </div>

      <!-- Cockpit live -->
      <aside class="panel cockpit" aria-label="Simulator cockpit (live)">
        <div class="panelInner">
          <div class="titleRow">
            <h3 class="panelTitle">Simulator cockpit (live)</h3>
            <span class="pill"><span class="led"></span>INTEGRITY • READABILITY • VERIFIABILITY</span>
          </div>

          <table class="cockpitTable" role="table" aria-label="Live metrics">
            <tr><td>Scope</td><td id="cScope">—</td></tr>
            <tr><td>Moment T</td><td id="cMoment">—</td></tr>
            <tr><td>Coverage</td><td id="cCoverage">—</td></tr>
            <tr><td>Defensibility</td><td id="cDef">—</td></tr>
          </table>

          <div class="verifyRow">
            <span style="opacity:.9;">● VERIFY</span>
            <span class="bar" aria-hidden="true"><i id="cBar"></i></span>
            <span id="cOk" style="opacity:.9;">—</span>
          </div>

          <div class="cockpitHash">
            hash: <span id="cHash">—</span>
          </div>
        </div>
      </aside>
    </section>

    <section class="grid" aria-label="Sandbox simulator">
      <!-- INPUT -->
      <div class="panel">
        <div class="panelInner">
          <div class="titleRow">
            <h3 class="panelTitle">Input — decision perimeter</h3>
            <span class="pill"><span class="led"></span>SCOPE • SOURCES • ACCOUNTABILITY</span>
          </div>

          <div class="formGrid">
            <div>
              <label for="decisionType">Decision type</label>
              <select id="decisionType">
                <option>Nomination / sensitive role</option>
                <option>Promotion (multi-criteria)</option>
                <option>Mobility (critical role)</option>
                <option>Termination (contested risk)</option>
                <option>Bonus allocation (audit exposure)</option>
              </select>
            </div>

            <div>
              <label for="momentT">Decision date (Moment T)</label>
              <input id="momentT" placeholder="YYYY-MM-DD" />
            </div>

            <div>
              <label for="scope">Organization / scope</label>
              <input id="scope" placeholder="Company X — multi-sites, multi-entities" />
            </div>

            <div>
              <label for="owner">Decision owner</label>
              <input id="owner" placeholder="CEO / Executive committee" />
            </div>
          </div>

          <div>
            <label for="context">Decision context (1–3 paragraphs)</label>
            <textarea id="context" placeholder="Regulated environment. Audit exposure. Decision may be challenged..."></textarea>
            <div class="hint">Declare what was known at Moment T. This is the perimeter you want to keep reconstructible over time.</div>
          </div>

          <div style="margin-top:14px;">
            <label>Declared sources (what was actually available)</label>

            <div class="sourcesGrid" role="group" aria-label="Declared sources">
              <label class="sourceCard">
                <input type="checkbox" id="srcLms" checked />
                <div>
                  <div class="sourceTitle">LMS / training files</div>
                  <div class="sourceDesc">Certifications, training attestations, documented evidence.</div>
                </div>
              </label>

              <label class="sourceCard">
                <input type="checkbox" id="srcHris" checked />
                <div>
                  <div class="sourceTitle">HRIS / career history</div>
                  <div class="sourceDesc">Roles, tenure, mobility, grade changes, official trace.</div>
                </div>
              </label>

              <label class="sourceCard">
                <input type="checkbox" id="srcPerf" checked />
                <div>
                  <div class="sourceTitle">Performance reviews</div>
                  <div class="sourceDesc">Objectives, annual reviews, formal evaluation trail.</div>
                </div>
              </label>

              <label class="sourceCard">
                <input type="checkbox" id="srcOps" checked />
                <div>
                  <div class="sourceTitle">Operational results</div>
                  <div class="sourceDesc">Attested KPIs, certified deliverables, traceable metrics.</div>
                </div>
              </label>

              <label class="sourceCard">
                <input type="checkbox" id="src360" />
                <div>
                  <div class="sourceTitle">360 feedback</div>
                  <div class="sourceDesc">Only if documented and attributable (otherwise excluded).</div>
                </div>
              </label>

              <label class="sourceCard">
                <input type="checkbox" id="srcLegal" checked />
                <div>
                  <div class="sourceTitle">Legal / compliance</div>
                  <div class="sourceDesc">Constraints, disputes, regulatory considerations, opposable items.</div>
                </div>
              </label>
            </div>
          </div>

          <!-- CLEAN CTA ROW (no ugly blocks above) -->
          <div class="ctaRow" aria-label="Simulator actions">
            <button class="btn primary" id="btnGenerate">GENERATE</button>
            <button class="btn" id="btnLoad">LOAD EXAMPLE</button>
            <button class="btn" id="btnReset">RESET</button>
          </div>
          <div class="localNote">
            <strong>Local-only:</strong> no data is sent. The bundle is generated in your browser. Deterministic rules only.
          </div>
        </div>
      </div>

      <!-- OUTPUT -->
      <div class="panel">
        <div class="panelInner">
          <div class="titleRow">
            <h3 class="panelTitle">Output — decision preparation report</h3>
            <span class="pill"><span class="led"></span>SEALED (LOCAL-ONLY)</span>
          </div>

          <div class="metricRow" aria-label="Output metrics">
            <div class="metric">
              <div class="k">Coverage</div>
              <div class="v" id="mCoverage">—</div>
            </div>
            <div class="metric">
              <div class="k">Missing</div>
              <div class="v" id="mMissing">—</div>
            </div>
            <div class="metric">
              <div class="k">Defensibility</div>
              <div class="v" id="mDef">—</div>
            </div>
            <div class="metric">
              <div class="k">Seal</div>
              <div class="v" id="mSeal">—</div>
            </div>
          </div>

          <div class="tabs" role="tablist" aria-label="Output views">
            <button class="tab active" id="tabSummary" role="tab" aria-selected="true">SUMMARY</button>
            <button class="tab" id="tabJson" role="tab" aria-selected="false">JSON</button>
            <button class="tab" id="tabPdf" role="tab" aria-selected="false">PDF (PRINT)</button>
          </div>

          <div class="outBox" id="outBox">Click “LOAD EXAMPLE” or fill inputs, then “GENERATE”.</div>

          <div class="outActions" aria-label="Output actions">
            <button class="btn" id="btnCopyHash">COPY HASH</button>
            <button class="btn" id="btnCopyJson">COPY JSON</button>
            <button class="btn primary" id="btnDownload">DOWNLOAD JSON</button>
          </div>

          <div class="hashLine">
            This artifact documents <span style="color:rgba(255,245,210,.92)">scope + declared sources + deterministic rules</span>. It does not “decide truth”.
            Accountability remains human.<br><br>
            hash: <span id="hashLine">—</span>
          </div>
        </div>
      </div>
    </section>

    <!-- UGLY BLOCKS → moved into a discreet accordion at the bottom -->
    <details class="accordion">
      <summary>
        Technical notes & assumptions
        <span style="color:rgba(245,241,230,.55); font-family:var(--sans); letter-spacing:0; text-transform:none; font-size:12px;">
          Useful for audit — not for first reading.
        </span>
      </summary>
      <div class="accBody">
        <div class="accGrid">
          <div class="mini">
            <h4>Known missing data</h4>
            <p>
              Comparable KPIs not attested for all candidates; some evidence exists but is not attributable;
              missing documented crisis leadership trace.
            </p>
          </div>
          <div class="mini">
            <h4>Constraints (optional)</h4>
            <p>
              Urgency, business continuity, social sensitivity, upcoming audit window.
              Decision must remain reconstructible over time.
            </p>
          </div>
          <div class="mini">
            <h4>Local-only</h4>
            <p>
              No data is sent. The bundle is generated in your browser.
              Deterministic rules only (same input → same output).
            </p>
          </div>
        </div>
      </div>
    </details>

    <div class="footer" role="contentinfo">
      <div>© OpenProof — RPO v0.1. Sandbox deterministic (local-only).</div>
      <div>
        <a href="https://rpo.openproof.net/spec" target="_blank" rel="noopener noreferrer">Spec</a> ·
        <a href="https://openproof.net" target="_blank" rel="noopener noreferrer">Home</a> ·
        <a href="https://rpo.openproof.net/examples" target="_blank" rel="noopener noreferrer">Examples</a>
      </div>
    </div>
  </div>

  <script>
    // ---------- Utilities ----------
    const $ = (id) => document.getElementById(id);

    function todayISO(){
      const d = new Date();
      const yyyy = d.getFullYear();
      const mm = String(d.getMonth()+1).padStart(2,'0');
      const dd = String(d.getDate()).padStart(2,'0');
      return `${yyyy}-${mm}-${dd}`;
    }

    function stableStringify(obj){
      // deterministic JSON stringify (sorted keys)
      if (obj === null || typeof obj !== "object") return JSON.stringify(obj);
      if (Array.isArray(obj)) return "[" + obj.map(stableStringify).join(",") + "]";
      const keys = Object.keys(obj).sort();
      return "{" + keys.map(k => JSON.stringify(k) + ":" + stableStringify(obj[k])).join(",") + "}";
    }

    async function sha256Hex(str){
      const enc = new TextEncoder();
      const data = enc.encode(str);
      const hashBuf = await crypto.subtle.digest("SHA-256", data);
      const bytes = new Uint8Array(hashBuf);
      return Array.from(bytes).map(b => b.toString(16).padStart(2, "0")).join("");
    }

    function setActiveTab(name){
      const tabs = { summary: $("tabSummary"), json: $("tabJson"), pdf: $("tabPdf") };
      Object.keys(tabs).forEach(k => {
        tabs[k].classList.toggle("active", k === name);
        tabs[k].setAttribute("aria-selected", k === name ? "true" : "false");
      });
      state.view = name;
      renderOutput();
    }

    function getDeclaredSources(){
      const map = [
        ["lms",  $("srcLms").checked],
        ["hris", $("srcHris").checked],
        ["performance", $("srcPerf").checked],
        ["ops", $("srcOps").checked],
        ["feedback360", $("src360").checked],
        ["legal", $("srcLegal").checked],
      ];
      return map.filter(([,v]) => v).map(([k]) => k);
    }

    function computeCoveragePct(declared){
      // Baseline sources that matter most for audit defensibility
      const baseline = ["lms","hris","performance","ops","legal"];
      const present = baseline.filter(k => declared.includes(k)).length;
      return Math.round((present / baseline.length) * 100);
    }

    function computeMissing(covPct, context, declared){
      // Deterministic heuristic: missing increases if coverage low or context too short, and if 360 ticked without being attributable (here we treat 360 as "risky")
      let missing = 0;
      if (covPct < 80) missing += 2;
      else if (covPct < 90) missing += 1;

      const ctxLen = (context || "").trim().length;
      if (ctxLen < 80) missing += 1;

      // 360 isn't “missing”, but can create an audit hole if it's the only "soft" source
      if (declared.includes("feedback360") && !declared.includes("legal")) missing += 1;

      // Clamp 0..6
      return Math.max(0, Math.min(6, missing));
    }

    function computeDefensibility(covPct, missing){
      // Deterministic mapping
      const score = Math.max(0, Math.min(100, Math.round(covPct - missing*10)));
      let label = "LOW";
      if (score >= 85) label = "HIGH";
      else if (score >= 70) label = "MEDIUM";
      return { score, label };
    }

    function cockpitBar(defScore){
      // 0..100 to %
      return `${Math.max(0, Math.min(100, defScore))}%`;
    }

    function escapeHtml(s){
      return String(s)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    // ---------- State ----------
    const state = {
      view: "summary",
      lastBundle: null,
      lastJson: "",
      lastHash: "",
    };

    // ---------- Rendering ----------
    function updateCockpitLive(snapshot){
      $("cScope").textContent   = snapshot.scope || "—";
      $("cMoment").textContent  = snapshot.momentT || "—";
      $("cCoverage").textContent= (snapshot.coveragePct != null) ? (snapshot.coveragePct + "%") : "—";
      $("cDef").textContent     = snapshot.defLabel || "—";
      $("cBar").style.width     = (snapshot.defScore != null) ? cockpitBar(snapshot.defScore) : "0%";
      $("cOk").textContent      = snapshot.okText || "—";
      $("cHash").textContent    = snapshot.hash || "—";
    }

    function setMetricsUI(bundle){
      $("mCoverage").textContent = bundle ? (bundle.metrics.coveragePct + "%") : "—";
      $("mMissing").textContent  = bundle ? String(bundle.metrics.missing) : "—";
      $("mDef").textContent      = bundle ? bundle.metrics.defensibility : "—";
      $("mSeal").textContent     = bundle ? "SHA-256 sealed" : "—";
      $("hashLine").textContent  = bundle ? bundle.hash.sha256 : "—";
    }

    function renderOutput(){
      if (!state.lastBundle){
        $("outBox").textContent = 'Click “LOAD EXAMPLE” or fill inputs, then “GENERATE”.';
        setMetricsUI(null);
        return;
      }

      const b = state.lastBundle;

      if (state.view === "summary"){
        const summary =
`Decision: ${b.decision.type}
Scope: ${b.decision.scope}
Owner: ${b.decision.owner}
Moment T: ${b.decision.momentT}

Declared sources: ${b.sources.declared.join(", ") || "none"}
Rules: deterministic (local-only)

Interpretation:
- This bundle documents scope + declared sources + deterministic rules.
- It enables audit / dispute reconstruction without retroactive improvisation.
- Hash proves integrity over time (not “truth”).

hash (SHA-256): ${b.hash.sha256}`;
        $("outBox").textContent = summary;
      } else if (state.view === "json"){
        $("outBox").textContent = state.lastJson;
      } else if (state.view === "pdf"){
        const html = buildPrintHtml(b);
        const w = window.open("", "_blank", "noopener,noreferrer");
        w.document.open();
        w.document.write(html);
        w.document.close();
        w.focus();
        // let user print
        w.setTimeout(() => w.print(), 250);
        $("outBox").textContent =
`PDF (PRINT)
Clicking this tab opens the print view in a new window and triggers your browser print dialog.

Tip:
- Keep the JSON + hash for verifiability.
- The print view is the human-readable companion.`;
      }

      setMetricsUI(b);

      // update cockpit with the bundle result
      updateCockpitLive({
        scope: b.decision.scope,
        momentT: b.decision.momentT,
        coveragePct: b.metrics.coveragePct,
        defLabel: b.metrics.defensibility,
        defScore: b.metrics.defScore,
        okText: "OK",
        hash: b.hash.sha256
      });
    }

    function buildPrintHtml(b){
      const safe = (x) => escapeHtml(x);
      const src = safe(b.sources.declared.join(", ") || "none");
      return `<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>RPO Print View — ${safe(b.decision.type)} (${safe(b.decision.momentT)})</title>
  <style>
    body{ font-family: Inter, Arial, sans-serif; margin: 42px; color:#111; }
    h1{ margin:0 0 8px; font-size: 22px; }
    .k{ color:#444; font-size: 12px; text-transform: uppercase; letter-spacing:.12em; }
    .box{ border:1px solid #ddd; border-radius: 12px; padding: 14px; margin-top: 14px; }
    .row{ display:flex; gap:16px; flex-wrap:wrap; }
    .col{ flex: 1; min-width: 260px; }
    .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size: 12px; }
    hr{ border:none; border-top:1px solid #eee; margin: 16px 0; }
  </style>
</head>
<body>
  <div class="k">OpenProof — RPO v0.1 · Human-readable print view</div>
  <h1>Decision Preparation Report</h1>

  <div class="box">
    <div class="row">
      <div class="col"><div class="k">Decision</div><div>${safe(b.decision.type)}</div></div>
      <div class="col"><div class="k">Moment T</div><div>${safe(b.decision.momentT)}</div></div>
      <div class="col"><div class="k">Owner</div><div>${safe(b.decision.owner)}</div></div>
    </div>
    <hr/>
    <div class="k">Scope</div>
    <div>${safe(b.decision.scope)}</div>
    <hr/>
    <div class="k">Declared sources</div>
    <div>${src}</div>
  </div>

  <div class="box">
    <div class="row">
      <div class="col"><div class="k">Coverage</div><div>${b.metrics.coveragePct}%</div></div>
      <div class="col"><div class="k">Missing</div><div>${b.metrics.missing}</div></div>
      <div class="col"><div class="k">Defensibility</div><div>${safe(b.metrics.defensibility)}</div></div>
    </div>
    <hr/>
    <div class="k">Integrity seal (SHA-256)</div>
    <div class="mono">${safe(b.hash.sha256)}</div>
  </div>

  <div class="box">
    <div class="k">Context (declared at Moment T)</div>
    <div>${safe(b.decision.context || "")}</div>
  </div>

  <div style="margin-top:18px; color:#666; font-size:12px;">
    This report documents perimeter + declared sources + deterministic rules. It does not establish “truth”.
    Accountability remains human. Verification relies on the public hash.
  </div>
</body>
</html>`;
    }

    // ---------- Build bundle ----------
    async function buildBundleFromInputs(){
      const decision = {
        type: $("decisionType").value.trim() || "—",
        momentT: ($("momentT").value.trim() || "—"),
        scope: ($("scope").value.trim() || "—"),
        owner: ($("owner").value.trim() || "—"),
        context: ($("context").value.trim() || "")
      };

      const declared = getDeclaredSources();
      const coveragePct = computeCoveragePct(declared);
      const missing = computeMissing(coveragePct, decision.context, declared);
      const def = computeDefensibility(coveragePct, missing);

      const bundle = {
        spec: { name: "OpenProof RPO", version: "v0.1", mode: "local-only" },
        decision,
        sources: { declared },
        rules: { deterministic: true, note: "Same input → same output. Hash proves integrity (not truth)." },
        metrics: {
          coveragePct,
          missing,
          defensibility: def.label,
          defScore: def.score
        },
        timestamps: {
          generatedAt: new Date().toISOString()
        }
      };

      const jsonStable = stableStringify(bundle);
      const hash = await sha256Hex(jsonStable);

      const finalBundle = {
        ...bundle,
        hash: { algorithm: "SHA-256", sha256: hash }
      };

      state.lastBundle = finalBundle;
      state.lastJson = JSON.stringify(finalBundle, null, 2);
      state.lastHash = hash;

      return finalBundle;
    }

    // ---------- Live cockpit snapshot (before generate) ----------
    function liveSnapshot(){
      const decision = {
        momentT: ($("momentT").value.trim() || "—"),
        scope: ($("scope").value.trim() || "—"),
        context: ($("context").value.trim() || "")
      };
      const declared = getDeclaredSources();
      const coveragePct = computeCoveragePct(declared);
      const missing = computeMissing(coveragePct, decision.context, declared);
      const def = computeDefensibility(coveragePct, missing);

      updateCockpitLive({
        scope: decision.scope,
        momentT: decision.momentT,
        coveragePct,
        defLabel: def.label,
        defScore: def.score,
        okText: "—",
        hash: (state.lastHash || "—")
      });

      // Also reflect the "missing" detail in cockpit display if you want (kept minimal by design)
      // (We intentionally keep cockpit compact and top-level.)
    }

    // ---------- Events ----------
    function hookLive(){
      ["decisionType","momentT","scope","owner","context","srcLms","srcHris","srcPerf","srcOps","src360","srcLegal"]
        .forEach(id => $(id).addEventListener("input", liveSnapshot));
      ["srcLms","srcHris","srcPerf","srcOps","src360","srcLegal"]
        .forEach(id => $(id).addEventListener("change", liveSnapshot));
    }

    async function onGenerate(){
      await buildBundleFromInputs();
      renderOutput();
    }

    function loadExample(){
      $("decisionType").value = "Nomination / sensitive role";
      $("momentT").value = "2026-01-28";
      $("scope").value = "Company X — France scope (multi-sites, multi-entities)";
      $("owner").value = "CEO / Executive committee";
      $("context").value = "Sensitive decision in a regulated environment. Traceability of declared sources and stability of definitions are required. Decision may be challenged and must remain reconstructible over time.";

      $("srcLms").checked = true;
      $("srcHris").checked = true;
      $("srcPerf").checked = true;
      $("srcOps").checked = true;
      $("src360").checked = false;
      $("srcLegal").checked = true;

      // Clear previous generated bundle until user generates again (keeps logic clean)
      state.lastBundle = null;
      state.lastJson = "";
      state.lastHash = "";

      liveSnapshot();
      renderOutput();
      $("outBox").textContent = "Example loaded. Click “GENERATE” to seal the bundle and compute the SHA-256 hash.";
    }

    function resetAll(){
      $("decisionType").value = "Nomination / sensitive role";
      $("momentT").value = todayISO();
      $("scope").value = "";
      $("owner").value = "";
      $("context").value = "";

      $("srcLms").checked = true;
      $("srcHris").checked = true;
      $("srcPerf").checked = true;
      $("srcOps").checked = true;
      $("src360").checked = false;
      $("srcLegal").checked = true;

      state.lastBundle = null;
      state.lastJson = "";
      state.lastHash = "";
      setActiveTab("summary");
      liveSnapshot();
      renderOutput();
    }

    async function copyToClipboard(text){
      try{
        await navigator.clipboard.writeText(text);
        return true;
      }catch(e){
        // fallback
        const ta = document.createElement("textarea");
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        try{ document.execCommand("copy"); } catch(_){}
        ta.remove();
        return false;
      }
    }

    // Output actions
    $("btnCopyHash").addEventListener("click", async () => {
      if (!state.lastHash) return;
      await copyToClipboard(state.lastHash);
      $("btnCopyHash").textContent = "HASH COPIED";
      setTimeout(() => $("btnCopyHash").textContent = "COPY HASH", 1200);
    });

    $("btnCopyJson").addEventListener("click", async () => {
      if (!state.lastJson) return;
      await copyToClipboard(state.lastJson);
      $("btnCopyJson").textContent = "JSON COPIED";
      setTimeout(() => $("btnCopyJson").textContent = "COPY JSON", 1200);
    });

    $("btnDownload").addEventListener("click", () => {
      if (!state.lastJson) return;
      const blob = new Blob([state.lastJson], { type: "application/json;charset=utf-8" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "decision_bundle.json";
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    });

    // Tabs
    $("tabSummary").addEventListener("click", () => setActiveTab("summary"));
    $("tabJson").addEventListener("click", () => setActiveTab("json"));
    $("tabPdf").addEventListener("click", () => setActiveTab("pdf"));

    // Main buttons
    $("btnGenerate").addEventListener("click", onGenerate);
    $("btnLoad").addEventListener("click", loadExample);
    $("btnReset").addEventListener("click", resetAll);
    $("heroGenerate").addEventListener("click", onGenerate);
    $("heroLoad").addEventListener("click", loadExample);

    // Init
    (function init(){
      $("momentT").value = todayISO();
      setActiveTab("summary");
      hookLive();
      liveSnapshot();
      renderOutput();
    })();
  </script>
</body>
</html>




