<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OpenProof.net — RPO v0.1 | Sandbox</title>
  <meta name="description" content="Sandbox déterministe : fige le contexte, déclare les sources, applique des règles, génère un bundle JSON scellé + aperçu imprimable + hash public SHA-256." />

  <!-- Fonts (safe fallback if blocked) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg0:#04040E;
      --bg1:#0b0f14;
      --panel: rgba(255,255,255,.04);
      --panel2: rgba(255,255,255,.06);
      --line: rgba(212,175,55,.22);
      --line2: rgba(212,175,55,.14);
      --gold:#d4af37;
      --gold2:#f1e6a3;
      --text: rgba(245,245,245,.86);
      --muted: rgba(245,245,245,.62);
      --muted2: rgba(245,245,245,.48);
      --shadow: 0 30px 80px rgba(0,0,0,.55);
      --r: 20px;
      --r2: 16px;
      --pad: 18px;
      --pad2: 14px;
      --max: 1180px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      color:var(--text);
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:
        radial-gradient(1200px 800px at 20% 20%, rgba(212,175,55,.10), transparent 55%),
        radial-gradient(900px 650px at 75% 30%, rgba(241,230,163,.07), transparent 60%),
        radial-gradient(1000px 800px at 70% 80%, rgba(212,175,55,.06), transparent 55%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow-x:hidden;
    }

    /* Subtle stars */
    .stars{
      position:fixed; inset:0; pointer-events:none; opacity:.25;
      background-image:
        radial-gradient(1px 1px at 12% 18%, rgba(241,230,163,.55) 30%, transparent 31%),
        radial-gradient(1px 1px at 32% 62%, rgba(241,230,163,.45) 30%, transparent 31%),
        radial-gradient(1px 1px at 71% 22%, rgba(241,230,163,.40) 30%, transparent 31%),
        radial-gradient(1px 1px at 83% 72%, rgba(241,230,163,.35) 30%, transparent 31%),
        radial-gradient(1px 1px at 55% 84%, rgba(241,230,163,.35) 30%, transparent 31%),
        radial-gradient(1px 1px at 18% 78%, rgba(241,230,163,.30) 30%, transparent 31%);
      background-size: 100% 100%;
      filter: blur(.2px);
    }

    a{ color:inherit; text-decoration:none; }
    .wrap{ max-width:var(--max); margin:0 auto; padding: 18px 18px 46px; }

    /* Topbar */
    .topbar{
      display:flex; align-items:center; justify-content:space-between;
      padding: 14px 18px;
      border-bottom: 1px solid rgba(255,255,255,.06);
      background: linear-gradient(180deg, rgba(0,0,0,.35), rgba(0,0,0,.05));
      position:sticky; top:0; z-index:10; backdrop-filter: blur(10px);
    }
    .brand{
      display:flex; gap:10px; align-items:center;
      font-family: Orbitron, Inter, system-ui;
      letter-spacing:.04em;
      font-size: 12px;
      color: rgba(245,245,245,.78);
      text-transform: uppercase;
      user-select:none;
    }
    .dot{
      width:12px; height:12px; border-radius:99px;
      background: radial-gradient(circle at 30% 30%, var(--gold2), var(--gold));
      box-shadow: 0 0 0 4px rgba(212,175,55,.12), 0 0 26px rgba(212,175,55,.25);
    }
    .nav{
      display:flex; gap:14px; align-items:center; flex-wrap:wrap;
      font-size: 12px;
      color: rgba(245,245,245,.68);
    }
    .nav a{
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.06);
      background: rgba(255,255,255,.03);
    }
    .nav a.active{
      border-color: rgba(212,175,55,.35);
      color: rgba(245,245,245,.86);
      box-shadow: 0 0 0 4px rgba(212,175,55,.08);
    }
    .ctaTop{
      display:flex; gap:10px; align-items:center;
    }
    .btnTop{
      padding: 9px 12px;
      border-radius: 999px;
      border: 1px solid rgba(212,175,55,.35);
      background: linear-gradient(180deg, rgba(212,175,55,.18), rgba(212,175,55,.08));
      color: rgba(245,245,245,.92);
      font-size: 12px;
      letter-spacing:.02em;
      box-shadow: 0 12px 26px rgba(0,0,0,.35);
    }
    .btnTop.primary{
      border: 1px solid rgba(212,175,55,.55);
      background: linear-gradient(180deg, rgba(241,230,163,.32), rgba(212,175,55,.16));
      color: rgba(0,0,0,.82);
      font-weight: 600;
    }

    /* Hero */
    .hero{
      display:grid;
      grid-template-columns: 1.25fr .85fr;
      gap: 18px;
      padding: 28px 0 18px;
      align-items:start;
    }
    .kicker{
      font-size: 12px;
      color: rgba(245,245,245,.60);
      letter-spacing: .14em;
      text-transform: uppercase;
      margin-bottom: 10px;
    }
    h1{
      font-family: Orbitron, Inter, system-ui;
      margin: 0 0 14px;
      font-size: clamp(28px, 4vw, 48px);
      line-height: 1.05;
      letter-spacing: .02em;
    }
    h1 .gold{ color: var(--gold2); text-shadow: 0 0 24px rgba(212,175,55,.25); }
    .lede{
      max-width: 58ch;
      color: rgba(245,245,245,.72);
      font-size: 14px;
      line-height: 1.55;
    }
    .chips{ display:flex; gap:8px; flex-wrap:wrap; margin-top: 16px; }
    .chip{
      border-radius: 999px;
      padding: 7px 10px;
      border: 1px solid rgba(212,175,55,.22);
      background: rgba(255,255,255,.03);
      color: rgba(245,245,245,.70);
      font-size: 12px;
      letter-spacing: .01em;
    }

    /* Glass panels */
    .panel{
      border-radius: var(--r);
      border: 1px solid var(--line2);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      box-shadow: var(--shadow);
      backdrop-filter: blur(14px);
    }
    .panelHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 14px 16px 10px;
      border-bottom: 1px solid rgba(255,255,255,.06);
    }
    .panelTitle{
      font-family: Orbitron, Inter, system-ui;
      font-size: 12px;
      letter-spacing: .10em;
      text-transform: uppercase;
      color: rgba(245,245,245,.76);
    }
    .badge{
      font-size: 11px;
      color: rgba(245,245,245,.74);
      border-radius: 999px;
      padding: 6px 10px;
      border: 1px solid rgba(212,175,55,.26);
      background: rgba(212,175,55,.08);
    }
    .panelBody{ padding: 14px 16px 16px; }

    /* Cockpit */
    .cockpitGrid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 10px;
      font-size: 12px;
      color: rgba(245,245,245,.70);
    }
    .row{
      display:flex; justify-content:space-between; gap:12px;
      padding: 8px 10px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.05);
      background: rgba(0,0,0,.16);
    }
    .row .k{ color: rgba(245,245,245,.58); }
    .row .v{ color: rgba(245,245,245,.86); max-width: 60%; text-align:right; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
    .meter{
      margin-top: 8px;
      height: 10px; border-radius: 999px;
      border: 1px solid rgba(212,175,55,.20);
      background: rgba(0,0,0,.18);
      overflow:hidden;
    }
    .meter > div{
      height:100%;
      width: 0%;
      background: linear-gradient(90deg, rgba(241,230,163,.55), rgba(212,175,55,.65));
      box-shadow: 0 0 18px rgba(212,175,55,.25);
    }
    .hashLine{
      margin-top: 10px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size: 11px;
      color: rgba(245,245,245,.62);
      opacity:.9;
      word-break: break-all;
      padding: 10px 10px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.06);
      background: rgba(0,0,0,.18);
    }

    /* Simulator layout (STRICT 50/50) */
    .sim{
      margin-top: 10px;
      display:grid;
      grid-template-columns: 1fr 1fr; /* 50/50 */
      gap: 18px;
      align-items:start;
    }

    /* Forms */
    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    label{
      display:block;
      font-size: 11px;
      letter-spacing: .10em;
      text-transform: uppercase;
      color: rgba(245,245,245,.58);
      margin: 0 0 6px;
      font-family: Orbitron, Inter, system-ui;
    }
    input, select, textarea{
      width:100%;
      border-radius: 14px;
      border: 1px solid rgba(212,175,55,.18);
      background: rgba(0,0,0,.22);
      color: rgba(245,245,245,.86);
      padding: 11px 12px;
      outline:none;
      font-size: 13px;
    }
    textarea{ min-height: 84px; resize: vertical; line-height:1.45; }
    input:focus, select:focus, textarea:focus{
      border-color: rgba(212,175,55,.45);
      box-shadow: 0 0 0 4px rgba(212,175,55,.10);
    }

    .sectionTitle{
      display:flex; align-items:center; justify-content:space-between;
      margin: 10px 0 10px;
    }
    .sectionTitle .left{
      font-family: Orbitron, Inter, system-ui;
      font-size: 12px;
      letter-spacing: .10em;
      text-transform: uppercase;
      color: rgba(245,245,245,.70);
    }
    .hint{
      font-size: 12px;
      color: rgba(245,245,245,.52);
    }

    .sourceCards{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 10px;
    }
    .source{
      border-radius: var(--r2);
      border: 1px solid rgba(212,175,55,.16);
      background: rgba(255,255,255,.03);
      padding: 12px 12px;
      display:flex; gap:10px;
      align-items:flex-start;
      min-height: 72px;
    }
    .source input{
      width:auto; margin-top: 2px;
      accent-color: var(--gold);
    }
    .source h4{
      margin: 0;
      font-size: 13px;
      color: rgba(245,245,245,.84);
      font-weight: 600;
    }
    .source p{
      margin: 5px 0 0;
      font-size: 12px;
      color: rgba(245,245,245,.58);
      line-height: 1.35;
    }

    /* Output */
    .metrics{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-bottom: 10px;
    }
    .metric{
      border-radius: var(--r2);
      border: 1px solid rgba(212,175,55,.16);
      background: rgba(0,0,0,.18);
      padding: 12px;
      min-height: 62px;
    }
    .metric .k{
      font-family: Orbitron, Inter, system-ui;
      font-size: 11px;
      letter-spacing: .10em;
      text-transform: uppercase;
      color: rgba(245,245,245,.58);
      margin-bottom: 8px;
    }
    .metric .v{
      font-size: 14px;
      color: rgba(245,245,245,.88);
      font-weight: 600;
    }
    .tabs{
      display:flex; gap:8px; flex-wrap:wrap;
      margin: 10px 0 10px;
    }
    .tab{
      border-radius: 999px;
      border: 1px solid rgba(212,175,55,.22);
      background: rgba(255,255,255,.03);
      padding: 8px 10px;
      font-size: 12px;
      color: rgba(245,245,245,.72);
      cursor:pointer;
      user-select:none;
    }
    .tab.active{
      border-color: rgba(212,175,55,.45);
      background: rgba(212,175,55,.10);
      color: rgba(245,245,245,.88);
      box-shadow: 0 0 0 4px rgba(212,175,55,.08);
    }
    .outBox{
      border-radius: var(--r2);
      border: 1px solid rgba(255,255,255,.06);
      background: rgba(0,0,0,.18);
      padding: 12px 12px;
      min-height: 200px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size: 12px;
      line-height: 1.45;
      color: rgba(245,245,245,.78);
      white-space: pre-wrap;
      word-break: break-word;
    }

    .btnRow{
      display:flex; gap:10px; flex-wrap:wrap;
      margin-top: 12px;
      align-items:center;
      justify-content:space-between;
    }
    .btnRow .left, .btnRow .right{
      display:flex; gap:10px; flex-wrap:wrap;
      align-items:center;
    }

    .btn{
      border-radius: 999px;
      border: 1px solid rgba(212,175,55,.22);
      background: rgba(255,255,255,.03);
      color: rgba(245,245,245,.78);
      padding: 10px 12px;
      font-size: 12px;
      cursor:pointer;
      user-select:none;
      transition: transform .04s ease, box-shadow .2s ease, border-color .2s ease;
    }
    .btn:hover{ border-color: rgba(212,175,55,.36); }
    .btn:active{ transform: translateY(1px); }
    .btn.primary{
      border-color: rgba(212,175,55,.55);
      background: linear-gradient(180deg, rgba(241,230,163,.35), rgba(212,175,55,.18));
      color: rgba(0,0,0,.82);
      font-weight: 700;
      padding: 10px 14px;
      box-shadow: 0 14px 34px rgba(0,0,0,.40);
    }
    .btn.danger{
      border-color: rgba(255,255,255,.10);
      color: rgba(245,245,245,.70);
    }
    .btnWide{
      min-width: 172px;
      text-align:center;
    }

    .footnote{
      margin-top: 10px;
      color: rgba(245,245,245,.56);
      font-size: 12px;
      line-height: 1.45;
    }
    .hashFooter{
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.06);
      background: rgba(0,0,0,.16);
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size: 11px;
      color: rgba(245,245,245,.65);
      word-break: break-all;
    }

    /* CTA bar (no “parasite blocks” above) */
    .ctaBar{
      margin-top: 16px;
      display:flex; gap:10px; flex-wrap:wrap;
      justify-content:center;
      align-items:center;
    }
    .ctaBar .btn{ padding: 11px 14px; }
    .ctaBar .btn.primary{ min-width: 220px; }

    /* Accordion bottom */
    details{
      margin-top: 18px;
      border-radius: var(--r);
      border: 1px solid rgba(212,175,55,.14);
      background: rgba(255,255,255,.02);
      overflow:hidden;
    }
    summary{
      list-style:none;
      cursor:pointer;
      padding: 14px 16px;
      display:flex; align-items:center; justify-content:space-between;
      gap: 12px;
      user-select:none;
    }
    summary::-webkit-details-marker{ display:none; }
    .accTitle{
      display:flex; flex-direction:column; gap:4px;
    }
    .accTitle .t{
      font-family: Orbitron, Inter, system-ui;
      font-size: 12px;
      letter-spacing: .10em;
      text-transform: uppercase;
      color: rgba(245,245,245,.78);
    }
    .accTitle .s{
      font-size: 12px;
      color: rgba(245,245,245,.52);
    }
    .chev{
      width: 34px; height: 34px; border-radius: 12px;
      border: 1px solid rgba(212,175,55,.18);
      background: rgba(0,0,0,.18);
      display:grid; place-items:center;
      color: rgba(245,245,245,.72);
      transition: transform .18s ease;
      flex: 0 0 auto;
    }
    details[open] .chev{ transform: rotate(180deg); }
    .accBody{
      padding: 0 16px 16px;
      border-top: 1px solid rgba(255,255,255,.06);
    }
    .accCards{
      margin-top: 14px;
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }
    .accCard{
      border-radius: var(--r2);
      border: 1px solid rgba(212,175,55,.14);
      background: rgba(0,0,0,.16);
      padding: 12px;
    }
    .accCard h3{
      margin: 0 0 8px;
      font-family: Orbitron, Inter, system-ui;
      font-size: 12px;
      letter-spacing: .10em;
      text-transform: uppercase;
      color: rgba(245,245,245,.72);
    }
    .accCard p{
      margin:0;
      color: rgba(245,245,245,.56);
      font-size: 12px;
      line-height: 1.45;
    }

    /* Footer */
    .footer{
      margin-top: 18px;
      display:flex; justify-content:space-between; gap: 10px;
      font-size: 12px;
      color: rgba(245,245,245,.50);
      padding: 10px 0 0;
      border-top: 1px solid rgba(255,255,255,.06);
    }
    .footer a{ color: rgba(245,245,245,.62); text-decoration: underline; text-underline-offset: 3px; }

    /* Responsive */
    @media (max-width: 980px){
      .hero{ grid-template-columns: 1fr; }
      .sim{ grid-template-columns: 1fr; } /* stacks on small screens */
      .accCards{ grid-template-columns: 1fr; }
      .nav{ display:none; }
    }
  </style>
</head>
<body>
  <div class="stars"></div>

  <header class="topbar">
    <div class="brand">
      <span class="dot"></span>
      <span>OPENPROOF.NET — RPO v0.1</span>
    </div>

    <nav class="nav" aria-label="Navigation">
      <a href="#" class="active">Bac à sable</a>
      <a href="#">Comment ça marche</a>
      <a href="#">Spéc.</a>
      <a href="#">Tests</a>
      <a href="#">Exemples</a>
    </nav>

    <div class="ctaTop">
      <a class="btnTop" href="#">Voir un exemple</a>
      <a class="btnTop primary" href="#">Essayez la démo en direct</a>
    </div>
  </header>

  <main class="wrap">
    <section class="hero">
      <div>
        <div class="kicker">Simulateur de faisceaux de preuves déterministes</div>
        <h1>Figez le contexte. <span class="gold">Générez un dossier de décision</span> auditable.</h1>
        <p class="lede">
          Ce bac à sable ne « choisit » pas. Il capture le périmètre décisionnel (moment T), les sources déclarées et les règles déterministes,
          puis génère un bundle local : JSON + aperçu imprimable + hachage public (SHA-256). Pas d’IA. Pas de stockage. Même entrée → même sortie.
        </p>

        <div class="chips" aria-label="Caractéristiques">
          <span class="chip">Portée (moment T)</span>
          <span class="chip">Sources déclarées</span>
          <span class="chip">Règles déterministes</span>
          <span class="chip">Prêt pour l’audit</span>
          <span class="chip">Hachage public</span>
        </div>
      </div>

      <aside class="panel" aria-label="Cockpit">
        <div class="panelHeader">
          <div class="panelTitle">Cockpit en direct</div>
          <div class="badge">Intégrité • Lisibilité • Vérifiabilité</div>
        </div>
        <div class="panelBody">
          <div class="cockpitGrid">
            <div class="row"><span class="k">Portée</span><span class="v" id="ckScope">—</span></div>
            <div class="row"><span class="k">Moment T</span><span class="v" id="ckMoment">—</span></div>
            <div class="row"><span class="k">Couverture</span><span class="v" id="ckCoverage">—</span></div>
            <div class="row"><span class="k">Défendabilité</span><span class="v" id="ckDef">—</span></div>
          </div>
          <div class="meter" aria-label="Barre de vérification">
            <div id="ckMeter"></div>
          </div>
          <div class="hashLine" id="ckHash">hash : —</div>
        </div>
      </aside>
    </section>

    <!-- SIMULATOR: STRICT 50/50 -->
    <section class="sim" aria-label="Simulator">
      <!-- LEFT: INPUT -->
      <div class="panel">
        <div class="panelHeader">
          <div class="panelTitle">Entrée — périmètre de décision</div>
          <div class="badge">Portée • Sources • Responsabilité</div>
        </div>
        <div class="panelBody">
          <div class="grid2">
            <div>
              <label for="decisionType">Type de décision</label>
              <select id="decisionType">
                <option value="Nomination / rôle sensible">Nomination / rôle sensible</option>
                <option value="Mobilité interne / poste critique">Mobilité interne / poste critique</option>
                <option value="Habilitation / accès réglementé">Habilitation / accès réglementé</option>
                <option value="Mesure disciplinaire / contestable">Mesure disciplinaire / contestable</option>
                <option value="Rupture / litige probable">Rupture / litige probable</option>
              </select>
            </div>

            <div>
              <label for="momentT">Date de décision (moment T)</label>
              <input id="momentT" placeholder="jj/mm/aaaa" inputmode="numeric" />
            </div>

            <div>
              <label for="scope">Organisation / étendue</label>
              <input id="scope" placeholder="Company X — France scope (multi-sites, multi-entités)" />
            </div>

            <div>
              <label for="owner">Responsable de la décision</label>
              <input id="owner" placeholder="CEO / Executive committee" />
            </div>
          </div>

          <div style="margin-top:10px;">
            <label for="context">Contexte de la décision (1 à 3 paragraphes)</label>
            <textarea id="context" placeholder="Environnement régulé. Exposition audit. Décision potentiellement contestable. Traçabilité des sources déclarées et stabilité des définitions requises."></textarea>
          </div>

          <div class="sectionTitle">
            <div class="left">Sources déclarées (ce qui était réellement disponible)</div>
            <div class="hint">Coche uniquement ce qui existe, est attribuable et vérifiable.</div>
          </div>

          <div class="sourceCards">
            <div class="source">
              <input type="checkbox" id="srcLms" checked />
              <div>
                <h4>LMS / fichiers de formation</h4>
                <p>Certifications, habilitations, attestations de formation, preuves documentées.</p>
              </div>
            </div>

            <div class="source">
              <input type="checkbox" id="srcHris" checked />
              <div>
                <h4>SIRH / parcours professionnel</h4>
                <p>Rôles, titularisation, changements de grade, traces officielles.</p>
              </div>
            </div>

            <div class="source">
              <input type="checkbox" id="srcPerf" checked />
              <div>
                <h4>Évaluations de performance</h4>
                <p>Objectifs, revues annuelles, procédure d’évaluation formelle.</p>
              </div>
            </div>

            <div class="source">
              <input type="checkbox" id="srcOps" checked />
              <div>
                <h4>Résultats opérationnels</h4>
                <p>Indicateurs clés (KPI) attestés, livrables certifiés, mesures traçables.</p>
              </div>
            </div>

            <div class="source">
              <input type="checkbox" id="src360" />
              <div>
                <h4>Commentaires à 360 degrés</h4>
                <p>Uniquement si documenté et attribuable (sinon exclu).</p>
              </div>
            </div>

            <div class="source">
              <input type="checkbox" id="srcLegal" checked />
              <div>
                <h4>Juridique / conformité</h4>
                <p>Contraintes, litiges, considérations réglementaires, éléments opposables.</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- RIGHT: OUTPUT -->
      <div class="panel">
        <div class="panelHeader">
          <div class="panelTitle">Résultat — rapport de préparation à la décision</div>
          <div class="badge" id="sealedBadge">Bundle sealed (local-only)</div>
        </div>
        <div class="panelBody">
          <div class="metrics" aria-label="Indicateurs">
            <div class="metric">
              <div class="k">Couverture</div>
              <div class="v" id="mCoverage">—</div>
            </div>
            <div class="metric">
              <div class="k">Manquant</div>
              <div class="v" id="mMissing">—</div>
            </div>
            <div class="metric">
              <div class="k">Défendabilité</div>
              <div class="v" id="mDef">—</div>
            </div>
            <div class="metric">
              <div class="k">Joint</div>
              <div class="v" id="mSeal">—</div>
            </div>
          </div>

          <div class="tabs" aria-label="Onglets de sortie">
            <div class="tab active" data-view="summary">Résumé</div>
            <div class="tab" data-view="json">JSON</div>
            <div class="tab" data-view="pdf">PDF (impression)</div>
          </div>

          <div class="outBox" id="outBox">Clique sur “GÉNÉRER”.
Tu peux aussi “EXEMPLE DE CHARGEMENT” pour une démo instantanée.</div>

          <div class="btnRow" aria-label="Actions de sortie">
            <div class="left">
              <button class="btn btnWide" id="copyHash">Copier le hachage</button>
              <button class="btn btnWide" id="copyJson">Copier le JSON</button>
            </div>
            <div class="right">
              <button class="btn primary btnWide" id="downloadJson">Télécharger JSON</button>
            </div>
          </div>

          <div class="footnote">
            RPO = JSON signé (logique) + vue prête à imprimer + hachage public.
            Le hachage garantit l’intégrité (pas la « vérité »). Vérification publique. Responsabilité humaine.
          </div>

          <div class="hashFooter" id="hashFooter">hash : —</div>
        </div>
      </div>
    </section>

    <!-- CTA BAR: clean (no parasite blocks above) -->
    <div class="ctaBar" aria-label="CTA">
      <button class="btn primary" id="generateBtn">GÉNÉRER</button>
      <button class="btn" id="loadExampleBtn">EXEMPLE DE CHARGEMENT</button>
      <button class="btn danger" id="resetBtn">RÉINITIALISER</button>
    </div>

    <!-- ACCORDION: the “3 ugly columns” live here, discreetly -->
    <details>
      <summary>
        <div class="accTitle">
          <div class="t">Informations techniques & hypothèses</div>
          <div class="s">Utile pour l’audit — inutile à la première lecture.</div>
        </div>
        <div class="chev">⌄</div>
      </summary>

      <div class="accBody">
        <div class="accCards">
          <div class="accCard">
            <h3>Données manquantes connues</h3>
            <p>
              Indicateurs comparables non attestés pour tous ; preuves existantes mais non attribuables ;
              absence de documentation sur gestion de crise / leadership en incident.
            </p>
          </div>

          <div class="accCard">
            <h3>Contraintes (facultatives)</h3>
            <p>
              Urgence, continuité d’activité, sensibilité sociale, fenêtre d’audit à venir.
              La décision doit rester reconstructible et défendable dans le temps.
            </p>
          </div>

          <div class="accCard">
            <h3>Local uniquement</h3>
            <p>
              Aucune donnée n’est envoyée. Le bundle est généré dans le navigateur.
              Règles déterministes uniquement (même entrée → même sortie).
            </p>
          </div>
        </div>
      </div>
    </details>

    <footer class="footer">
      <div>© OpenProof — RPO v0.1. Bac à sable déterministe (local seulement).</div>
      <div>
        <a href="#">Spécifications</a> · <a href="#">Accueil</a> · <a href="#">Exemples</a>
      </div>
    </footer>
  </main>

  <script>
    // ---------------------------
    // State
    // ---------------------------
    const state = {
      view: "summary",           // summary | json | pdf
      lastBundle: null,          // object
      lastJson: "",              // string
      lastHash: "",              // string
      lastCoveragePct: 0,        // number
      lastDefendability: "—",    // string
      lastMissing: 0             // number
    };

    // ---------------------------
    // Helpers
    // ---------------------------
    const els = {
      decisionType: document.getElementById("decisionType"),
      momentT: document.getElementById("momentT"),
      scope: document.getElementById("scope"),
      owner: document.getElementById("owner"),
      context: document.getElementById("context"),

      srcLms: document.getElementById("srcLms"),
      srcHris: document.getElementById("srcHris"),
      srcPerf: document.getElementById("srcPerf"),
      srcOps: document.getElementById("srcOps"),
      src360: document.getElementById("src360"),
      srcLegal: document.getElementById("srcLegal"),

      // cockpit
      ckScope: document.getElementById("ckScope"),
      ckMoment: document.getElementById("ckMoment"),
      ckCoverage: document.getElementById("ckCoverage"),
      ckDef: document.getElementById("ckDef"),
      ckMeter: document.getElementById("ckMeter"),
      ckHash: document.getElementById("ckHash"),

      // metrics
      mCoverage: document.getElementById("mCoverage"),
      mMissing: document.getElementById("mMissing"),
      mDef: document.getElementById("mDef"),
      mSeal: document.getElementById("mSeal"),
      sealedBadge: document.getElementById("sealedBadge"),

      // output box
      outBox: document.getElementById("outBox"),
      hashFooter: document.getElementById("hashFooter"),

      // buttons
      generateBtn: document.getElementById("generateBtn"),
      loadExampleBtn: document.getElementById("loadExampleBtn"),
      resetBtn: document.getElementById("resetBtn"),
      copyHash: document.getElementById("copyHash"),
      copyJson: document.getElementById("copyJson"),
      downloadJson: document.getElementById("downloadJson")
    };

    function normalizeDateFR(input){
      // Accepts jj/mm/aaaa or yyyy-mm-dd; returns yyyy-mm-dd or "" if unknown
      const s = String(input || "").trim();
      if(!s) return "";
      const iso = /^(\d{4})-(\d{2})-(\d{2})$/;
      const fr  = /^(\d{2})\/(\d{2})\/(\d{4})$/;
      if(iso.test(s)) return s;
      const m = s.match(fr);
      if(m) return `${m[3]}-${m[2]}-${m[1]}`;
      return "";
    }

    function todayISO(){
      const d = new Date();
      const y = d.getFullYear();
      const m = String(d.getMonth()+1).padStart(2,"0");
      const da = String(d.getDate()).padStart(2,"0");
      return `${y}-${m}-${da}`;
    }

    function stableStringify(obj){
      // Stable JSON: sort keys recursively
      if (obj === null || typeof obj !== "object") return JSON.stringify(obj);
      if (Array.isArray(obj)) return `[${obj.map(stableStringify).join(",")}]`;
      const keys = Object.keys(obj).sort();
      return `{${keys.map(k => JSON.stringify(k)+":"+stableStringify(obj[k])).join(",")}}`;
    }

    async function sha256Hex(str){
      const enc = new TextEncoder();
      const buf = await crypto.subtle.digest("SHA-256", enc.encode(str));
      const bytes = Array.from(new Uint8Array(buf));
      return bytes.map(b => b.toString(16).padStart(2,"0")).join("");
    }

    function getDeclaredSources(){
      const sources = [];
      if (els.srcLms.checked) sources.push("lms");
      if (els.srcHris.checked) sources.push("hris");
      if (els.srcPerf.checked) sources.push("performance");
      if (els.srcOps.checked) sources.push("ops");
      if (els.src360.checked) sources.push("feedback360");
      if (els.srcLegal.checked) sources.push("legal");
      return sources;
    }

    function computeCoveragePct(nSources){
      // simple deterministic coverage scale: 0..6 -> %
      const map = [0, 50, 63, 72, 80, 87, 93];
      return map[Math.max(0, Math.min(6, nSources))];
    }

    function computeMissing(covPct, contextText){
      // deterministic heuristic: missing = 0 if cov>=87 and context >= 120 chars
      // else missing 1..3 depending on coverage and context length
      const len = (contextText || "").trim().length;
      let miss = 0;
      if (covPct < 63) miss += 2;
      else if (covPct < 80) miss += 1;

      if (len < 80) miss += 1;
      if (len < 30) miss += 1;

      return Math.min(3, Math.max(0, miss));
    }

    function computeDefendability(covPct, missing){
      // deterministic mapping
      if (missing === 0 && covPct >= 87) return "HIGH";
      if (missing <= 1 && covPct >= 72) return "MEDIUM";
      return "LOW";
    }

    function formatSummary(bundle, hashHex){
      const src = bundle.declared_sources.join(", ");
      return [
        `Decision: ${bundle.decision.type}`,
        `Scope: ${bundle.decision.scope}`,
        `Owner: ${bundle.decision.owner}`,
        `Moment T: ${bundle.decision.momentT}`,
        ``,
        `Declared sources: ${src}`,
        `Rules: deterministic (${bundle.mode})`,
        ``,
        `Interpretation:`,
        `- This bundle documents scope + declared sources + deterministic rules.`,
        `- It enables audit / dispute reconstruction without retroactive improvisation.`,
        `- Hash proves integrity over time (not "truth").`,
        ``,
        `hash (sha256): ${hashHex}`
      ].join("\n");
    }

    function formatPdfText(bundle, hashHex){
      // minimal printable view; you can refine later
      return [
        `RPO v0.1 — Rapport de préparation à la décision`,
        `---------------------------------------------`,
        ``,
        `Type de décision : ${bundle.decision.type}`,
        `Moment T         : ${bundle.decision.momentT}`,
        `Portée           : ${bundle.decision.scope}`,
        `Responsable      : ${bundle.decision.owner}`,
        ``,
        `Contexte`,
        `${bundle.decision.context}`,
        ``,
        `Sources déclarées`,
        `- ${bundle.declared_sources.join("\n- ") || "—"}`,
        ``,
        `Règles`,
        `- déterministes (local-only)`,
        ``,
        `Scellé (hash SHA-256)`,
        `${hashHex}`,
        ``,
        `Note: ce document prouve l’intégrité du bundle (pas la vérité). La responsabilité reste humaine.`
      ].join("\n");
    }

    function setView(view){
      state.view = view;
      document.querySelectorAll(".tab").forEach(t => t.classList.toggle("active", t.dataset.view === view));
      renderOutput();
    }

    function renderOutput(){
      if(!state.lastBundle){
        els.outBox.textContent = `Clique sur “GÉNÉRER”.\nTu peux aussi “EXEMPLE DE CHARGEMENT” pour une démo instantanée.`;
        els.hashFooter.textContent = "hash : —";
        return;
      }

      if(state.view === "summary"){
        els.outBox.textContent = formatSummary(state.lastBundle, state.lastHash);
      } else if(state.view === "json"){
        els.outBox.textContent = state.lastJson;
      } else if(state.view === "pdf"){
        els.outBox.textContent = "PDF (impression)\n\nClique ici : ouvre l’aperçu imprimable dans un nouvel onglet.\n\nAstuce : utilise ensuite Ctrl/Cmd+P.";
      }

      els.hashFooter.textContent = `hash : ${state.lastHash}`;
    }

    function updateMetrics(){
      els.mCoverage.textContent = `${state.lastCoveragePct}%`;
      els.mMissing.textContent = String(state.lastMissing);
      els.mDef.textContent = state.lastDefendability;
      els.mSeal.textContent = state.lastHash ? "SHA-256 sealed" : "—";
      els.sealedBadge.textContent = "Bundle sealed (local-only)";
    }

    function updateCockpitPreview(){
      const scope = els.scope.value.trim() || "—";
      const moment = normalizeDateFR(els.momentT.value) || "—";
      const n = getDeclaredSources().length;
      const cov = computeCoveragePct(n);
      const miss = computeMissing(cov, els.context.value);
      const def = computeDefendability(cov, miss);

      els.ckScope.textContent = scope;
      els.ckMoment.textContent = moment;
      els.ckCoverage.textContent = `${cov}%${miss ? ` (missing: ${miss})` : ""}`;
      els.ckDef.textContent = def;

      els.ckMeter.style.width = `${cov}%`;

      // cockpit hash: show last generated hash if exists, else placeholder
      els.ckHash.textContent = `hash : ${state.lastHash || "—"}`;
    }

    async function buildBundle(){
      const type = els.decisionType.value.trim();
      const momentT = normalizeDateFR(els.momentT.value) || todayISO();
      const scope = els.scope.value.trim() || "Company X — multi-sites, multi-entités";
      const owner = els.owner.value.trim() || "CEO / Executive committee";
      const context = (els.context.value || "").trim() || "—";
      const declared_sources = getDeclaredSources();

      const coveragePct = computeCoveragePct(declared_sources.length);
      const missing = computeMissing(coveragePct, context);
      const defendability = computeDefendability(coveragePct, missing);

      // deterministic bundle object
      const bundle = {
        spec: { name: "OpenProof RPO", version: "v0.1" },
        mode: "local-only",
        decision: { type, momentT, scope, owner, context },
        declared_sources,
        deterministic_rules: [
          "scope is frozen at moment T",
          "only declared sources exist in reasoning",
          "same input produces same output",
          "integrity is sealed by public hash (SHA-256)"
        ],
        metrics: {
          coveragePct,
          missing,
          defendability
        },
        created_at: todayISO()
      };

      // stable json + hash
      const stable = stableStringify(bundle);
      const hashHex = await sha256Hex(stable);

      state.lastBundle = bundle;
      state.lastHash = hashHex;
      state.lastCoveragePct = coveragePct;
      state.lastMissing = missing;
      state.lastDefendability = defendability;

      // output JSON (pretty, but still deterministic content)
      const pretty = JSON.stringify(bundle, null, 2);
      state.lastJson = pretty;

      updateMetrics();
      updateCockpitPreview();
      renderOutput();
    }

    function loadExample(){
      els.decisionType.value = "Nomination / rôle sensible";
      els.momentT.value = "28/01/2026";
      els.scope.value = "Company X — France scope (multi-sites, multi-entités)";
      els.owner.value = "CEO / Executive committee";
      els.context.value =
        "Décision sensible en environnement régulé. Exigence de traçabilité des sources et stabilité des définitions. " +
        "La décision peut être contestée et doit rester vérifiable dans le temps.";

      els.srcLms.checked = true;
      els.srcHris.checked = true;
      els.srcPerf.checked = true;
      els.srcOps.checked = true;
      els.src360.checked = false;
      els.srcLegal.checked = true;

      updateCockpitPreview();
    }

    function resetAll(){
      els.decisionType.value = "Nomination / rôle sensible";
      els.momentT.value = "";
      els.scope.value = "";
      els.owner.value = "";
      els.context.value = "";

      els.srcLms.checked = true;
      els.srcHris.checked = true;
      els.srcPerf.checked = true;
      els.srcOps.checked = true;
      els.src360.checked = false;
      els.srcLegal.checked = true;

      state.lastBundle = null;
      state.lastJson = "";
      state.lastHash = "";
      state.lastCoveragePct = 0;
      state.lastMissing = 0;
      state.lastDefendability = "—";

      els.mCoverage.textContent = "—";
      els.mMissing.textContent = "—";
      els.mDef.textContent = "—";
      els.mSeal.textContent = "—";
      els.hashFooter.textContent = "hash : —";
      els.ckHash.textContent = "hash : —";
      els.ckMeter.style.width = "0%";

      setView("summary");
      renderOutput();
      updateCockpitPreview();
    }

    // ---------------------------
    // Tabs / PDF behavior
    // ---------------------------
    document.querySelectorAll(".tab").forEach(tab => {
      tab.addEventListener("click", async () => {
        const view = tab.dataset.view;
        setView(view);

        if(view === "pdf"){
          if(!state.lastBundle){
            els.outBox.textContent = "Génère d’abord un bundle, puis ouvre l’aperçu imprimable.";
            return;
          }
          // Open printable view in a new tab
          const text = formatPdfText(state.lastBundle, state.lastHash);
          const w = window.open("", "_blank", "noopener,noreferrer");
          if(!w) return;

          const safe = text
            .replaceAll("&","&amp;")
            .replaceAll("<","&lt;")
            .replaceAll(">","&gt;");

          w.document.write(`
            <!doctype html>
            <html lang="fr">
              <head>
                <meta charset="utf-8" />
                <meta name="viewport" content="width=device-width, initial-scale=1" />
                <title>RPO v0.1 — PDF (impression)</title>
                <style>
                  body{ font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial; padding: 28px; color:#111; }
                  pre{ white-space: pre-wrap; word-break: break-word; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; font-size: 12px; line-height:1.45; }
                  .note{ margin-top: 18px; font-size: 12px; color:#444; }
                </style>
              </head>
              <body>
                <pre>${safe}</pre>
                <div class="note">Astuce : Ctrl/Cmd+P pour imprimer / enregistrer en PDF.</div>
              </body>
            </html>
          `);
          w.document.close();
        }
      });
    });

    // ---------------------------
    // Buttons
    // ---------------------------
    els.generateBtn.addEventListener("click", async () => {
      await buildBundle();
    });

    els.loadExampleBtn.addEventListener("click", async () => {
      loadExample();
      // important: "simulateur marche AVEC Load example"
      // -> after loading example, we generate immediately to show right panel reacts
      await buildBundle();
    });

    els.resetBtn.addEventListener("click", () => resetAll());

    els.copyHash.addEventListener("click", async () => {
      if(!state.lastHash) return;
      await navigator.clipboard.writeText(state.lastHash);
      els.copyHash.textContent = "Hachage copié";
      setTimeout(() => (els.copyHash.textContent = "Copier le hachage"), 1100);
    });

    els.copyJson.addEventListener("click", async () => {
      if(!state.lastJson) return;
      await navigator.clipboard.writeText(state.lastJson);
      els.copyJson.textContent = "JSON copié";
      setTimeout(() => (els.copyJson.textContent = "Copier le JSON"), 1100);
    });

    els.downloadJson.addEventListener("click", () => {
      if(!state.lastJson) return;
      const blob = new Blob([state.lastJson], { type: "application/json;charset=utf-8" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "decision_bundle.json";
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    });

    // ---------------------------
    // Live cockpit updates (so user always sees "where to click / what's happening")
    // ---------------------------
    const liveInputs = [
      els.decisionType, els.momentT, els.scope, els.owner, els.context,
      els.srcLms, els.srcHris, els.srcPerf, els.srcOps, els.src360, els.srcLegal
    ];
    liveInputs.forEach(el => {
      el.addEventListener("input", updateCockpitPreview);
      el.addEventListener("change", updateCockpitPreview);
    });

    // init
    resetAll();
    updateCockpitPreview();
  </script>
</body>
</html>



