<!DOCTYPE html>
<html lang="en" data-page="psycho-demo">
<head>
  <meta charset="UTF-8" />
  <title>OpenProof — Psycho-forensic demo | From raw story to control patterns</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- SEO -->
  <meta name="description"
        content="Psycho-forensic demo on top of the RPO standard. Paste a short narrative and see structural control patterns, coercion score, and highlighted sensitive passages. Runs locally, deterministic, no AI." />
  <link rel="canonical" href="https://rpo.openproof.net/demo-psycho.html" />

  <!-- Open Graph -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="OpenProof — Psycho-forensic narrative demo" />
  <meta property="og:description"
        content="From raw story to control patterns: a rule-based psycho-forensic layer on top of the RPO standard. Coercion score, risk hints and narrative profile (phenotype)." />
  <meta property="og:url" content="https://rpo.openproof.net/demo-psycho.html" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;600&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet" />

  <style>
    :root {
      --bg-main: #04040e;
      --bg-elevated: #0b0f14;
      --card-bg: #fbf4e6;
      --card-bg-soft: #f7efdd;
      --accent-gold: #d4af37;
      --accent-gold-soft: #f5e1a5;
      --accent-gold-strong: #ffcf6b;
      --accent-red-soft: #fbe3e3;
      --accent-red: #e25b5b;
      --accent-green-soft: #e0f3df;
      --accent-green: #2f9b5d;
      --border-gold: rgba(212, 175, 55, 0.65);
      --text-main: #f5f5ff;
      --text-muted: #a5acb8;
      --text-ink: #3a2c1a;
      --chip-bg: rgba(12, 18, 30, 0.9);
      --shadow-soft: 0 18px 45px rgba(0, 0, 0, 0.55);
      --radius-card: 22px;
      --radius-pill: 999px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top left, #151d2b 0, #04040e 42%, #000 100%);
      color: var(--text-main);
      -webkit-font-smoothing: antialiased;
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    .page-shell {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* NAVBAR ------------------------------------------------------- */
    .nav {
      position: sticky;
      top: 0;
      z-index: 40;
      backdrop-filter: blur(18px);
      background: linear-gradient(to bottom, rgba(4, 4, 14, 0.94), rgba(4, 4, 14, 0.86));
      border-bottom: 1px solid rgba(255, 255, 255, 0.04);
    }

    .nav-inner {
      max-width: 1180px;
      margin: 0 auto;
      padding: 14px 20px 10px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 20px;
    }

    .nav-left {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .logo-pill {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 6px 14px 6px 8px;
      border-radius: 999px;
      background: radial-gradient(circle at 0 0, #ffffff, #f2e3b2 40%, #9a7a2b 100%);
      box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.35), 0 12px 30px rgba(0, 0, 0, 0.6);
    }

    .logo-pill-icon {
      width: 26px;
      height: 26px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #ffffff 0, #f5e6bc 42%, #c59c3d 75%, #8a6a22 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 15px;
      color: #4a3915;
      font-weight: 600;
    }

    .logo-pill-text {
      display: flex;
      flex-direction: column;
      line-height: 1.15;
    }

    .logo-title {
      font-family: "Orbitron", system-ui, sans-serif;
      font-size: 11px;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: #20160a;
    }

    .logo-subtitle {
      font-size: 10px;
      color: #644b22;
    }

    .nav-links {
      display: flex;
      align-items: center;
      gap: 18px;
      font-size: 13px;
      color: var(--text-muted);
    }

    .nav-link {
      position: relative;
      padding-bottom: 2px;
    }

    .nav-link.active {
      color: #f5eedf;
      font-weight: 500;
    }

    .nav-link.active::after {
      content: "";
      position: absolute;
      left: 0;
      bottom: -4px;
      width: 100%;
      height: 2px;
      background: linear-gradient(to right, #f7e29b, #d4af37);
      border-radius: 999px;
    }

    .nav-right {
      display: flex;
      align-items: center;
    }

    .nav-cta {
      padding: 7px 14px;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(250, 237, 190, 0.9);
      background: radial-gradient(circle at top left, #f7e8c4, #cfa93a);
      color: #241b08;
      font-size: 12px;
      font-weight: 500;
      box-shadow: 0 12px 28px rgba(0, 0, 0, 0.6);
      cursor: pointer;
      text-decoration: none;
      white-space: nowrap;
    }

    .nav-cta:hover {
      filter: brightness(1.03);
      transform: translateY(-0.5px);
    }

    /* LAYOUT ------------------------------------------------------- */
    .content {
      flex: 1;
      padding: 26px 16px 40px;
    }

    .content-inner {
      max-width: 1180px;
      margin: 0 auto;
    }

    /* HERO --------------------------------------------------------- */
    .hero {
      display: grid;
      grid-template-columns: minmax(0, 3fr) minmax(0, 2.6fr);
      gap: 32px;
      margin-bottom: 34px;
      align-items: flex-start;
    }

    .hero-title {
      font-family: "Orbitron", system-ui, sans-serif;
      font-size: 32px;
      line-height: 1.25;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: #f7f1df;
      margin: 4px 0 14px;
    }

    .hero-highlight {
      color: var(--accent-gold-strong);
    }

    .hero-kicker {
      font-family: "Orbitron", system-ui, sans-serif;
      font-size: 11px;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: var(--accent-gold-soft);
      margin-bottom: 6px;
    }

    .hero-lead {
      font-size: 14px;
      line-height: 1.6;
      color: #d7dde8;
      max-width: 640px;
      margin-bottom: 12px;
    }

    .hero-extra {
      font-size: 13px;
      line-height: 1.55;
      color: #a8b0c0;
      max-width: 650px;
      margin-bottom: 14px;
    }

    .chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 4px;
    }

    .chip {
      font-size: 11px;
      padding: 5px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.06);
      background: linear-gradient(to bottom right, rgba(250, 230, 170, 0.16), rgba(8, 10, 18, 0.95));
      color: #f5edd9;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      font-weight: 500;
    }

    .chip-secondary {
      background: var(--chip-bg);
      color: var(--text-muted);
    }

    .hero-card {
      background: radial-gradient(circle at top left, #151b28, #050813 55%);
      border-radius: var(--radius-card);
      border: 1px solid rgba(255, 255, 255, 0.06);
      box-shadow: var(--shadow-soft);
      padding: 18px 20px 18px;
      color: #e2e6f0;
      position: relative;
      overflow: hidden;
    }

    .hero-card::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top right, rgba(255, 223, 133, 0.16), transparent 55%);
      opacity: 0.9;
      pointer-events: none;
    }

    .hero-card-inner {
      position: relative;
      z-index: 1;
    }

    .hero-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .hero-card-title {
      font-family: "Orbitron", system-ui, sans-serif;
      font-size: 13px;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: #f7f0d0;
    }

    .hero-card-badge {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      padding: 3px 10px;
      border-radius: 999px;
      border: 1px solid rgba(245, 226, 154, 0.7);
      background: rgba(10, 10, 15, 0.9);
      color: #f5e29e;
    }

    .hero-card-list {
      margin: 0;
      padding-left: 18px;
      font-size: 13px;
      line-height: 1.55;
      color: #d1d8e5;
    }

    .hero-card-list li {
      margin-bottom: 4px;
    }

    .hero-card-foot {
      margin-top: 10px;
      font-size: 11px;
      color: #9ca5b8;
    }

    .hero-card-foot em {
      font-style: normal;
      color: #f3d99b;
    }

    /* PLAYGROUND LAYOUT ------------------------------------------- */
    .section-title {
      font-family: "Orbitron", system-ui, sans-serif;
      font-size: 13px;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: var(--text-muted);
      margin: 8px 0 10px;
    }

    .playground-grid {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.3fr);
      gap: 26px;
      margin-bottom: 18px;
    }

    .card {
      background: linear-gradient(to bottom right, var(--card-bg), #f5ebd6);
      color: var(--text-ink);
      border-radius: var(--radius-card);
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.6);
      border: 1px solid rgba(0, 0, 0, 0.08);
      padding: 18px 20px 20px;
      position: relative;
    }

    .card::before {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: inherit;
      border-top: 2px solid rgba(212, 175, 55, 0.55);
      pointer-events: none;
    }

    .card h2 {
      margin: 0 0 10px;
      font-family: "Orbitron", system-ui, sans-serif;
      font-size: 15px;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: #3b2d14;
    }

    .card small {
      font-size: 12px;
      color: #7a6d55;
    }

    .field-label {
      font-size: 11px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: #8b7c63;
      margin-bottom: 4px;
    }

    .select,
    .textarea {
      width: 100%;
      font-family: inherit;
      font-size: 13px;
      border-radius: 10px;
      border: 1px solid rgba(120, 96, 56, 0.35);
      padding: 8px 10px;
      background: rgba(255, 255, 255, 0.9);
      color: #2f2515;
      outline: none;
    }

    .select:focus,
    .textarea:focus {
      border-color: var(--accent-gold);
      box-shadow: 0 0 0 1px rgba(212, 175, 55, 0.5);
    }

    .textarea {
      resize: vertical;
      min-height: 150px;
    }

    .field-tip {
      font-size: 11px;
      color: #8c7b60;
      margin-top: 6px;
    }

    .button-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 14px;
    }

    .btn {
      border-radius: 999px;
      font-size: 13px;
      font-weight: 500;
      padding: 8px 16px;
      border: none;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }

    .btn-primary {
      background: radial-gradient(circle at top left, #f7e6ba, #d4af37);
      color: #261c09;
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.5);
    }

    .btn-secondary {
      background: #f2e4c5;
      color: #4d3c1e;
      border: 1px solid rgba(145, 118, 61, 0.4);
    }

    .btn-ghost {
      background: transparent;
      color: #6b5730;
      border: 1px dashed rgba(120, 96, 56, 0.6);
    }

    .btn:hover {
      filter: brightness(1.03);
      transform: translateY(-0.5px);
    }

    /* RIGHT PANEL: FUSED VIEW ------------------------------------- */
    .score-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 14px;
      margin-bottom: 14px;
    }

    .score-box {
      background: var(--card-bg-soft);
      border-radius: 18px;
      border: 1px solid rgba(122, 103, 62, 0.35);
      padding: 10px 12px 11px;
    }

    .score-label {
      font-size: 11px;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      color: #8b7547;
      margin-bottom: 4px;
    }

    .score-value {
      font-size: 20px;
      font-weight: 600;
      color: #30200b;
      display: flex;
      align-items: baseline;
      gap: 4px;
    }

    .score-value span {
      font-size: 12px;
      color: #7d6947;
      font-weight: 500;
    }

    .score-note {
      font-size: 11px;
      margin-top: 2px;
      color: #7a6340;
    }

    .score-note--risk {
      color: var(--accent-red);
    }

    .mechanisms {
      margin-top: 6px;
      margin-bottom: 10px;
      font-size: 13px;
      color: #4e3a20;
    }

    .mechanisms strong {
      font-weight: 600;
    }

    .matrix-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 6px;
      font-size: 13px;
    }

    .matrix-table th,
    .matrix-table td {
      padding: 6px 6px;
    }

    .matrix-table thead th {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: #8d7b5c;
      border-bottom: 1px solid rgba(138, 114, 70, 0.4);
    }

    .matrix-table tbody tr:nth-child(odd) {
      background: rgba(248, 239, 222, 0.85);
    }

    .matrix-table tbody tr:nth-child(even) {
      background: rgba(246, 234, 213, 0.95);
    }

    .matrix-axis {
      color: #3a2710;
      white-space: nowrap;
    }

    .matrix-level-pill {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 105px;
      padding: 3px 8px;
      border-radius: 999px;
      font-size: 11px;
      font-weight: 600;
      border: 1px solid rgba(170, 96, 40, 0.4);
      background: #ffe3d3;
      color: #a1441d;
    }

    .matrix-level-pill--present {
      background: #fff3d3;
      border-color: rgba(172, 133, 52, 0.45);
      color: #886123;
    }

    .matrix-level-pill--none {
      background: #f1ebe0;
      border-style: dashed;
      border-color: rgba(145, 126, 90, 0.55);
      color: #8a7c5c;
      font-weight: 500;
    }

    .subsection-title {
      margin-top: 14px;
      margin-bottom: 6px;
      font-size: 12px;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: #8a7750;
    }

    .signals-list {
      font-size: 13px;
      margin: 0;
      padding-left: 18px;
      color: #4e3a20;
    }

    .signals-list li {
      margin-bottom: 3px;
    }

    .phenotype-text {
      font-size: 13px;
      color: #4a371d;
      line-height: 1.55;
    }

    .story-box {
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 16px;
      background: #fff9ec;
      border: 1px dashed rgba(159, 130, 63, 0.75);
      font-size: 13px;
      line-height: 1.55;
      color: #3d2d15;
    }

    .highlight {
      background: #ffe9a8;
      border-radius: 6px;
      padding: 0 2px;
      box-shadow: 0 0 0 1px rgba(223, 186, 92, 0.4);
    }

    .demo-disclaimer {
      margin-top: 10px;
      font-size: 11px;
      color: #8b7b5c;
    }

    .demo-disclaimer strong {
      font-weight: 600;
      color: #674d25;
    }

    .band-real-case {
      margin-top: 22px;
      background: radial-gradient(circle at top left, rgba(255, 230, 170, 0.16), rgba(6, 8, 18, 0.96));
      border-radius: 20px;
      border: 1px solid rgba(255, 236, 179, 0.28);
      padding: 14px 18px;
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      color: #f3eddc;
      font-size: 13px;
    }

    .band-real-case p {
      margin: 0;
      max-width: 720px;
    }

    .band-real-case em {
      font-style: normal;
      color: #f7dfa0;
    }

    .band-cta {
      border-radius: var(--radius-pill);
      border: 1px solid rgba(248, 228, 170, 0.9);
      background: radial-gradient(circle at top left, #f7e6b7, #d4af37);
      color: #261a06;
      padding: 8px 18px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      white-space: nowrap;
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.6);
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .band-cta:hover {
      filter: brightness(1.03);
      transform: translateY(-0.5px);
    }

    /* FOOTER ------------------------------------------------------- */
    .footer {
      border-top: 1px solid rgba(255, 255, 255, 0.06);
      padding: 14px 16px 18px;
      background: radial-gradient(circle at top, #0c111b 0, #04040e 55%, #000 100%);
      color: var(--text-muted);
      font-size: 12px;
    }

    .footer-inner {
      max-width: 1180px;
      margin: 0 auto;
    }

    .footer-main {
      margin-bottom: 6px;
    }

    .footer-links {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      font-size: 12px;
    }

    .footer-dot::before {
      content: "•";
      margin: 0 6px;
      opacity: 0.65;
    }

    .footer a {
      color: var(--text-muted);
    }

    .footer a:hover {
      color: #f3e7c0;
    }

    /* RESPONSIVE --------------------------------------------------- */
    @media (max-width: 960px) {
      .hero {
        grid-template-columns: minmax(0, 1fr);
      }
      .hero-card {
        margin-top: 4px;
      }
      .playground-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    @media (max-width: 720px) {
      .nav-inner {
        padding-inline: 12px;
      }
      .hero-title {
        font-size: 24px;
      }
      .content {
        padding-inline: 12px;
      }
      .card {
        padding-inline: 16px;
      }
      .score-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }
  </style>
</head>
<body>
<div class="page-shell">
  <!-- NAVBAR -->
  <header class="nav">
    <div class="nav-inner">
      <div class="nav-left">
        <div class="logo-pill">
          <div class="logo-pill-icon">◎</div>
          <div class="logo-pill-text">
            <div class="logo-title">OPENPROOF — RPO v0.1</div>
            <div class="logo-subtitle">Signed JSON • Human-readable PDF • Public hash</div>
          </div>
        </div>
      </div>
      <nav class="nav-links">
        <a href="overview.html" class="nav-link">Overview</a>
        <a href="index.html" class="nav-link">Specification</a>
        <a href="examples.html" class="nav-link">Examples</a>
        <a href="tests.html" class="nav-link">Tests</a>
        <a href="playground.html" class="nav-link">Playground</a>
        <a href="demo-psycho.html" class="nav-link active">Psycho-forensic demo</a>
      </nav>
      <div class="nav-right">
        <a
          href="https://github.com/openproof-net/rpo-spec-v0.1"
          class="nav-cta"
          target="_blank"
          rel="noopener noreferrer"
        >
          View on GitHub
        </a>
      </div>
    </div>
  </header>

  <!-- CONTENT -->
  <main class="content">
    <div class="content-inner">
      <!-- HERO -->
      <section class="hero">
        <div>
          <div class="hero-kicker">RPO demonstration layer • narrative mechanisms</div>
          <h1 class="hero-title">
            Try the <span class="hero-highlight">psycho-forensic</span> demo<br />
            — from raw story to control patterns
          </h1>
          <p class="hero-lead">
            Paste a short narrative about a potential coercive situation (domestic, workplace,
            institutional or online). This demo surfaces structural control patterns, estimates
            a rough coercion score, and highlights the narrative profile. Everything runs
            locally in your browser — no AI model.
          </p>
          <p class="hero-extra">
            In the scientific <strong>CNRS × TruthX</strong> pilot, this layer is powered by advanced
            psycho-forensic modules able to ingest message streams, reports and transcripts. Here
            you see a simplified and transparent narrative decoder that already reveals structural
            control schemes on top of the RPO “civil code”.
          </p>
          <div class="chip-row">
            <div class="chip">Based on models</div>
            <div class="chip chip-secondary">No AI, deterministic</div>
            <div class="chip">Coercive control focus</div>
            <div class="chip chip-secondary">RPO-compatible narrative layer</div>
          </div>
        </div>

        <aside class="hero-card">
          <div class="hero-card-inner">
            <div class="hero-card-header">
              <div class="hero-card-title">What this demo illustrates</div>
              <div class="hero-card-badge">Demo mode</div>
            </div>
            <ul class="hero-card-list">
              <li>Detection of narrative control mechanisms (locking, threats, economic pressure,
                  surveillance, normalisation).</li>
              <li>Aggregation into a mini-matrix of coercive control axes.</li>
              <li>Approximate coercion score and narrative risk level for the story.</li>
              <li>Highlighting of sensitive passages and the resulting narrative profile (phenotype).</li>
            </ul>
            <p class="hero-card-foot">
              In a full evaluation, this overlay would be one part of a broader
              <em>psycho-medical-forensic assessment</em> carried out by qualified professionals.
              This demo simply shows how structured patterns can be made visible.
            </p>
          </div>
        </aside>
      </section>

      <!-- PLAYGROUND -->
      <section>
        <div class="section-title">Play with a narrative</div>
        <div class="playground-grid">
          <!-- LEFT: INPUT -->
          <article class="card">
            <h2>1. Input narrative</h2>
            <small>Write a short story (1 to 3 paragraphs). Names can be anonymised. The goal is to reveal
              control structure, not to judge the case.</small>

            <div style="margin-top: 12px;">
              <div class="field-label">Context</div>
              <select id="contextSelect" class="select">
                <option value="generic">Not specified / generic</option>
                <option value="intimate" selected>Intimate / domestic</option>
                <option value="work">Workplace / management</option>
                <option value="institutional">Institutional / administrative</option>
                <option value="online">Online / digital</option>
              </select>
            </div>

            <div style="margin-top: 10px;">
              <div class="field-label">Narrative (free text)</div>
              <textarea id="narrativeInput" class="textarea"
                        placeholder="Describe what happened, in your own words. Who did what, when, where, and how did it affect you or others?"></textarea>
              <div class="field-tip">
                Tip: include at least one concrete action, one time marker, and every threat, justification
                or constraint you remember.
              </div>
            </div>

            <div class="button-row">
              <button class="btn btn-primary" id="analyzeButton">Analyse the story</button>
              <button class="btn btn-secondary" id="resetButton">Reset</button>
              <button class="btn btn-ghost" id="loadExampleButton">Load an example</button>
            </div>
          </article>

          <!-- RIGHT: OVERLAY PANEL -->
          <article class="card">
            <h2>2. Psycho-forensic overlay</h2>
            <small>The demo reads the text and highlights structural control patterns using a conservative,
              rule-based model. Scores are <strong>approximate</strong> and only indicate converging
              signals within this story.</small>

            <!-- Scores -->
            <div class="score-grid" style="margin-top: 12px;">
              <div class="score-box">
                <div class="score-label">Coercion score (approx.)</div>
                <div class="score-value">
                  <span id="coercionScoreValue">0</span><span>/ 100</span>
                </div>
                <div class="score-note" id="coercionScoreNote">
                  No clear structural coercive pattern yet. Add concrete actions, constraints or threats if they exist.
                </div>
              </div>
              <div class="score-box">
                <div class="score-label">Immediate risk (narrative)</div>
                <div class="score-value">
                  <span id="riskScoreValue">0</span><span>/ 100</span>
                </div>
                <div class="score-note score-note--risk" id="riskScoreNote">
                  No explicit threat or physical risk appears in the text.
                </div>
              </div>
            </div>

            <!-- Mechanisms detected -->
            <div class="mechanisms" id="mechanismsSummary">
              <strong>Mechanisms detected:</strong> none so far. Run an analysis to see patterns.
            </div>

            <!-- Matrix -->
            <div class="subsection-title">Coercive control matrix</div>
            <table class="matrix-table" aria-describedby="mechanismsSummary">
              <thead>
              <tr>
                <th style="text-align:left;">Control axis</th>
                <th style="text-align:right;">Demo level</th>
              </tr>
              </thead>
              <tbody id="matrixBody">
              <tr>
                <td class="matrix-axis">Isolation / confinement</td>
                <td style="text-align:right;">
                  <span class="matrix-level-pill matrix-level-pill--none">None so far</span>
                </td>
              </tr>
              <tr>
                <td class="matrix-axis">Surveillance &amp; suspicion</td>
                <td style="text-align:right;">
                  <span class="matrix-level-pill matrix-level-pill--none">None so far</span>
                </td>
              </tr>
              <tr>
                <td class="matrix-axis">Control of communications</td>
                <td style="text-align:right;">
                  <span class="matrix-level-pill matrix-level-pill--none">None so far</span>
                </td>
              </tr>
              <tr>
                <td class="matrix-axis">Threats &amp; sanctions</td>
                <td style="text-align:right;">
                  <span class="matrix-level-pill matrix-level-pill--none">None so far</span>
                </td>
              </tr>
              <tr>
                <td class="matrix-axis">Economic / resource control</td>
                <td style="text-align:right;">
                  <span class="matrix-level-pill matrix-level-pill--none">None so far</span>
                </td>
              </tr>
              <tr>
                <td class="matrix-axis">Normalisation &amp; mental pressure</td>
                <td style="text-align:right;">
                  <span class="matrix-level-pill matrix-level-pill--none">None so far</span>
                </td>
              </tr>
              </tbody>
            </table>

            <!-- Signals -->
            <div class="subsection-title">Signals to monitor</div>
            <ul class="signals-list" id="signalsList">
              <li>No weak axis detected yet. Signals will appear here once a story is analysed.</li>
            </ul>

            <!-- Phenotype -->
            <div class="subsection-title">Narrative profile (phenotype)</div>
            <p class="phenotype-text" id="phenotypeText">
              Once analysed, this field summarises the overall narrative profile (phenotype): how the different
              control axes combine in this story (isolated incident, emerging pattern, or dense coercive environment).
            </p>

            <!-- Story with highlights -->
            <div class="subsection-title">Story with sensitive passages highlighted</div>
            <div class="story-box" id="highlightedStory">
              The analysed story will appear here with sensitive passages highlighted once you run the demo.
            </div>

            <p class="demo-disclaimer">
              <strong>This heuristic logic is intentionally conservative and demonstrative.</strong>
              It simply makes possible control patterns visible from the provided text. It does not
              replace legal, clinical or protective assessment.
            </p>
          </article>
        </div>

        <!-- Real case band -->
        <div class="band-real-case">
          <p>
            Facing a real case or a complex file? This page shows a <em>demonstration decoder</em>.
            In the scientific / CNRS pilot, the psycho-forensic layer is coupled with the full
            RPO standard, temporal graphs and a structured legal reading. If you want to test
            these modules on real-world cases, you can apply to the CNRS × TruthX pilot programme.
          </p>
          <a
            class="band-cta"
            href="https://www.truthx.co/truthx-pilote-form"
            target="_blank"
            rel="noopener noreferrer"
          >
            Apply for the CNRS pilot
          </a>
        </div>
      </section>
    </div>
  </main>

  <!-- FOOTER -->
  <footer class="footer">
    <div class="footer-inner">
      <div class="footer-main">
        OpenProof — RPO Specification v0.1<br />
        © 2026 OpenProof Consortium. Research collaboration: CNRS – GREYC – Université de Caen Normandie —
        Editorial lead for the specification: <strong>Gersende Ryard de Parcey</strong>.
      </div>
      <div class="footer-links">
        <a href="overview.html">Technical site</a>
        <span class="footer-dot"></span>
        <a href="governance.html">Governance</a>
        <span class="footer-dot"></span>
        <a href="contact.html">Contact</a>
      </div>
    </div>
  </footer>
</div>

<!-- SCRIPT: HEURISTIC ANALYSER ---------------------------------------- -->
<script>
  (function () {
    const narrativeInput = document.getElementById("narrativeInput");
    const contextSelect = document.getElementById("contextSelect");
    const analyzeButton = document.getElementById("analyzeButton");
    const resetButton = document.getElementById("resetButton");
    const loadExampleButton = document.getElementById("loadExampleButton");

    const coercionScoreValue = document.getElementById("coercionScoreValue");
    const coercionScoreNote = document.getElementById("coercionScoreNote");
    const riskScoreValue = document.getElementById("riskScoreValue");
    const riskScoreNote = document.getElementById("riskScoreNote");
    const mechanismsSummary = document.getElementById("mechanismsSummary");
    const matrixBody = document.getElementById("matrixBody");
    const signalsList = document.getElementById("signalsList");
    const phenotypeText = document.getElementById("phenotypeText");
    const highlightedStory = document.getElementById("highlightedStory");

    // Lexical cues per control axis
    const AXES = [
      {
        id: "isolation",
        label: "Isolation / confinement",
        cues: [
          "locked me in",
          "locked her in",
          "locked him in",
          "locked me inside",
          "locked the door",
          "kept me in",
          "would not let me leave",
          "took my keys",
          "took her keys",
          "took his keys",
          "could not leave",
          "confined",
          "prevented me from leaving"
        ]
      },
      {
        id: "surveillance",
        label: "Surveillance & suspicion",
        cues: [
          "checked my phone",
          "checked her phone",
          "checked his phone",
          "checking my phone",
          "went through my messages",
          "accusing me of hiding",
          "accused me of hiding",
          "who are you texting",
          "who was calling",
          "spied on",
          "installed a tracker",
          "followed me",
          "monitoring my",
          "constantly asking where I was"
        ]
      },
      {
        id: "communications",
        label: "Control of communications",
        cues: [
          "took my phone",
          "took her phone",
          "took his phone",
          "no one needed to hear from me",
          "no one needed to hear from her",
          "no one needed to hear from him",
          "stopped me from calling",
          "not allowed to call",
          "not allowed to talk to",
          "forbade me to talk",
          "blocked me from",
          "cut me off from",
          "deleted my contacts"
        ]
      },
      {
        id: "threats",
        label: "Threats & sanctions",
        cues: [
          "threatened to",
          "threatened me",
          "or else",
          "otherwise he would",
          "otherwise she would",
          "he said he would stop paying the rent",
          "she said she would stop paying the rent",
          "would hit me",
          "would hurt me",
          "screamed that he would",
          "screamed that she would",
          "said I would regret",
          "yelled that I would regret"
        ]
      },
      {
        id: "economic",
        label: "Economic / resource control",
        cues: [
          "full access to my bank",
          "access to my bank account",
          "all my bank notifications",
          "take the car keys",
          "took the car keys",
          "took my car",
          "stopped paying",
          "cut the money",
          "took my money",
          "controlled all the money"
        ]
      },
      {
        id: "normalisation",
        label: "Normalisation & mental pressure",
        cues: [
          "said I was overreacting",
          "said that I was overreacting",
          "said I was crazy",
          "said she was crazy",
          "said he was crazy",
          "normal for couples",
          "normal for parents",
          "everyone does that",
          "that is how relationships work",
          "you are too sensitive",
          "you are imagining things"
        ]
      }
    ];

    // Threat cues for risk score
    const RISK_CUES = [
      "threatened",
      "hit me",
      "hurt me",
      "kill",
      "kill myself",
      "kill himself",
      "kill herself",
      "suicide",
      "locked me in",
      "could not leave",
      "took the car keys",
      "stopped paying the rent",
      "no one needed to hear from me tonight"
    ];

    function normalise(text) {
      return text.toLowerCase();
    }

    function countCues(text, cues) {
      const norm = normalise(text);
      let count = 0;
      cues.forEach(c => {
        if (!c) return;
        const pattern = c.toLowerCase();
        if (pattern && norm.includes(pattern)) {
          count++;
        }
      });
      return count;
    }

    function classifyLevel(count) {
      if (count >= 2) return { label: `Strong, ${count} cues`, type: "strong" };
      if (count === 1) return { label: "Present, 1 cue", type: "present" };
      return { label: "None so far", type: "none" };
    }

    function analyseNarrative() {
      const text = narrativeInput.value.trim();
      if (!text) {
        alert("Please paste or write a short narrative first.");
        return;
      }

      // Count cues per axis
      const axisResults = AXES.map(axis => {
        const count = countCues(text, axis.cues);
        return { axis, count, level: classifyLevel(count) };
      });

      const totalCues = axisResults.reduce((sum, r) => sum + r.count, 0);
      const strongAxes = axisResults.filter(r => r.level.type === "strong");
      const presentAxes = axisResults.filter(
        r => r.level.type === "present"
      );

      // Coercion score: 0–100
      let coercionScore = Math.min(100, strongAxes.length * 25 + presentAxes.length * 10);
      if (coercionScore === 0 && totalCues > 0) coercionScore = 15;

      // Risk score from threat cues
      const riskCount = countCues(text, RISK_CUES);
      let riskScore = 0;
      if (riskCount >= 3) riskScore = 100;
      else if (riskCount === 2) riskScore = 70;
      else if (riskCount === 1) riskScore = 40;

      coercionScoreValue.textContent = coercionScore.toString();
      riskScoreValue.textContent = riskScore.toString();

      if (coercionScore === 0) {
        coercionScoreNote.textContent =
          "No clear structural coercive pattern yet. It may describe conflict or tension, or the narrative may still be too fragmentary.";
      } else if (coercionScore < 45) {
        coercionScoreNote.textContent =
          "Some control cues appear in the story. The pattern is weak but may need monitoring over time.";
      } else if (coercionScore < 80) {
        coercionScoreNote.textContent =
          "Several control axes co-exist. This pattern suggests a possible coercive environment.";
      } else {
        coercionScoreNote.textContent =
          "Multiple strong axes converge. The story reads like a dense coercive structure.";
      }

      if (riskScore === 0) {
        riskScoreNote.textContent =
          "No explicit threat or physical risk appears in the text.";
      } else if (riskScore < 60) {
        riskScoreNote.textContent =
          "Signals of possible risk (threats, confinement, sanctions) appear in the story. They deserve attention.";
      } else {
        riskScoreNote.textContent =
          "High-intensity risk signals (threats, confinement, sanctions). This calls for immediate vigilance.";
      }

      // Mechanisms summary
      const activeAxes = axisResults.filter(r => r.count > 0);
      if (activeAxes.length === 0) {
        mechanismsSummary.innerHTML =
          "<strong>Mechanisms detected:</strong> none so far. The text may describe tension without clear control schemes.";
      } else {
        const labels = activeAxes
          .map(r => `${r.axis.label.toLowerCase()}`)
          .join(", ");
        mechanismsSummary.innerHTML =
          `<strong>Mechanisms detected:</strong> ${labels}.`;
      }

      // Matrix table
      matrixBody.innerHTML = "";
      axisResults.forEach(r => {
        const tr = document.createElement("tr");
        const tdAxis = document.createElement("td");
        tdAxis.className = "matrix-axis";
        tdAxis.textContent = r.axis.label;

        const tdLevel = document.createElement("td");
        tdLevel.style.textAlign = "right";

        const span = document.createElement("span");
        span.classList.add("matrix-level-pill");
        if (r.level.type === "present") span.classList.add("matrix-level-pill--present");
        else if (r.level.type === "none") span.classList.add("matrix-level-pill--none");

        span.textContent = r.level.label;
        tdLevel.appendChild(span);

        tr.appendChild(tdAxis);
        tr.appendChild(tdLevel);
        matrixBody.appendChild(tr);
      });

      // Signals to monitor: axes with exactly 1 cue
      const weakAxes = axisResults.filter(r => r.count === 1);
      signalsList.innerHTML = "";
      if (weakAxes.length === 0) {
        const li = document.createElement("li");
        li.textContent = "No single, isolated axis detected. Signals will appear here when weak patterns emerge.";
        signalsList.appendChild(li);
      } else {
        weakAxes.forEach(r => {
          const li = document.createElement("li");
          li.textContent = r.axis.label;
          signalsList.appendChild(li);
        });
      }

      // Phenotype text (narrative profile)
      if (totalCues === 0) {
        phenotypeText.textContent =
          "The narrative profile does not yet show a structured pattern of control. It may describe conflict or tension without systemic coercion, or the story may simply be too fragmentary.";
      } else if (strongAxes.length === 0 && presentAxes.length === 1) {
        phenotypeText.textContent =
          "The narrative profile shows isolated control behaviour on a single axis. It looks more like an early warning signal that should be monitored over time and cross-checked with other sources.";
      } else if (strongAxes.length <= 2) {
        phenotypeText.textContent =
          "The narrative profile points to a developing coercive control pattern: several axes start to interact, with episodes of pressure, surveillance or sanctions that may escalate if repeated.";
      } else {
        phenotypeText.textContent =
          "The narrative profile corresponds to a dense coercive control scheme: several axes interact (isolation, communications, sanctions, economic and mental pressure). In a full evaluation, this kind of phenotype would justify priority attention, safety planning and cross-checking with independent proof.";
      }

      // Highlighted story: wrap all cue spans
      highlightedStory.innerHTML = buildHighlightedStory(text);
    }

    function buildHighlightedStory(text) {
      let html = text;
      const allCues = Array.from(
        new Set(
          AXES.reduce((acc, axis) => acc.concat(axis.cues), []).filter(Boolean)
        )
      ).sort((a, b) => b.length - a.length); // longer first to avoid nested overlaps

      allCues.forEach(cue => {
        const pattern = cue.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
        const regex = new RegExp(pattern, "gi");
        html = html.replace(regex, match => `<span class="highlight">${match}</span>`);
      });

      return html;
    }

    function resetAll() {
      narrativeInput.value = "";
      coercionScoreValue.textContent = "0";
      riskScoreValue.textContent = "0";
      coercionScoreNote.textContent =
        "No clear structural coercive pattern yet. Add concrete actions, constraints or threats if they exist.";
      riskScoreNote.textContent =
        "No explicit threat or physical risk appears in the text.";
      mechanismsSummary.innerHTML =
        "<strong>Mechanisms detected:</strong> none so far. Run an analysis to see patterns.";
      matrixBody.innerHTML = "";
      AXES.forEach(axis => {
        const tr = document.createElement("tr");
        const tdAxis = document.createElement("td");
        tdAxis.className = "matrix-axis";
        tdAxis.textContent = axis.label;
        const tdLevel = document.createElement("td");
        tdLevel.style.textAlign = "right";
        const span = document.createElement("span");
        span.className = "matrix-level-pill matrix-level-pill--none";
        span.textContent = "None so far";
        tdLevel.appendChild(span);
        tr.appendChild(tdAxis);
        tr.appendChild(tdLevel);
        matrixBody.appendChild(tr);
      });
      signalsList.innerHTML = "";
      const li = document.createElement("li");
      li.textContent = "No weak axis detected yet. Signals will appear here once a story is analysed.";
      signalsList.appendChild(li);
      phenotypeText.textContent =
        "Once analysed, this field will describe the narrative profile (phenotype): the global shape of the story in terms of control patterns (isolated incident, emerging pattern, or dense coercive environment).";
      highlightedStory.textContent =
        "The analysed story will appear here with sensitive passages highlighted once you run the demo.";
    }

    function loadExample() {
      const exampleText =
        "On Saturday 12 February, around 9 pm, he locked me in the living room for almost two hours after I refused to cancel a dinner with my sister. " +
        "He stood in front of the door, took my phone and said that \"no one needed to hear from me tonight\". " +
        "Two days later, on Monday, he woke me up at 5:30 am accusing me of hiding conversations from him because I didn't leave my phone charging in the kitchen as he demanded. " +
        "Last week, he also threatened to take the car keys if I didn't give him all my bank notifications, saying it was \"normal for couples to share everything\" and that I was overreacting.";
      contextSelect.value = "intimate";
      narrativeInput.value = exampleText;
      analyseNarrative();
    }

    analyzeButton.addEventListener("click", analyseNarrative);
    resetButton.addEventListener("click", resetAll);
    loadExampleButton.addEventListener("click", loadExample);

    // Initialise matrix rows
    resetAll();
  })();
</script>
</body>
</html>


