<!DOCTYPE html>
<html lang="en" data-page="demo-psycho">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OpenProof — Psycho-Forensic Demo | Narrative control patterns</title>

  <!-- SEO -->
  <meta name="description"
        content="Psycho-forensic demo on top of the RPO standard. Paste a short narrative and see how structural control patterns, coercive axes and narrative risk can be surfaced without using any AI model." />
  <link rel="canonical" href="https://rpo.openproof.net/demo-psycho.html" />

  <!-- Open Graph -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="OpenProof — Psycho-Forensic Demo" />
  <meta property="og:description"
        content="From raw story to control patterns: experimental psycho-forensic overlay compatible with the RPO evidence standard." />
  <meta property="og:url" content="https://rpo.openproof.net/demo-psycho.html" />

  <style>
    :root {
      --bg-main: #04040e;
      --bg-elevated: #0b0f14;
      --panel-bg: #f7f1e3;
      --panel-border: #d4af37;
      --text-main: #f5f5ff;
      --text-muted: #b0b5c9;
      --gold: #f1e6a3;
      --gold-deep: #d4af37;
      --danger: #e44b4b;
      --danger-soft: #ffdad6;
      --accent-soft: rgba(212, 175, 55, 0.15);
      --shadow-soft: 0 24px 80px rgba(0, 0, 0, 0.6);
      --radius-large: 26px;
      --radius-medium: 18px;
      --radius-pill: 999px;
      --font-sans: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
                   "Inter", "Segoe UI", sans-serif;
      --font-mono: "SF Mono", ui-monospace, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: var(--font-sans);
      color: var(--text-main);
      background: radial-gradient(circle at top, #151a28 0, var(--bg-main) 42%, #02030a 100%);
      -webkit-font-smoothing: antialiased;
    }

    a {
      color: var(--gold);
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }

    .page-shell {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* Top nav */

    .top-nav {
      position: sticky;
      top: 0;
      z-index: 20;
      backdrop-filter: blur(22px);
      background: linear-gradient(to bottom, rgba(4,4,14,0.96), rgba(4,4,14,0.75) 60%, transparent 100%);
      border-bottom: 1px solid rgba(241, 230, 163, 0.08);
    }

    .top-nav-inner {
      max-width: 1120px;
      margin: 0 auto;
      padding: 14px 20px 10px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .brand-logo {
      width: 34px;
      height: 34px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 20%, #ffffff, #f3e8b2 35%, #d4af37 60%, #7a6432 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 0 1px rgba(0,0,0,0.5), 0 10px 25px rgba(0,0,0,0.7);
    }

    .brand-logo-inner {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      border: 1px solid rgba(4,4,14,0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      font-weight: 600;
      color: #3d3214;
      background: rgba(255,255,255,0.55);
    }

    .brand-text {
      display: flex;
      flex-direction: column;
      font-size: 13px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
    }

    .brand-title {
      font-weight: 600;
    }

    .brand-subtitle {
      font-size: 10px;
      color: var(--text-muted);
      letter-spacing: 0.2em;
    }

    .nav-links {
      display: flex;
      align-items: center;
      gap: 14px;
      font-size: 13px;
      color: var(--text-muted);
    }

    .nav-link {
      padding: 4px 8px;
      border-radius: 999px;
    }

    .nav-link.active {
      color: var(--gold);
      background: rgba(241, 230, 163, 0.08);
    }

    .nav-cta {
      padding: 7px 14px;
      border-radius: 999px;
      border: 1px solid rgba(241, 230, 163, 0.55);
      font-size: 13px;
      color: var(--gold);
      background: radial-gradient(circle at top left, rgba(241, 230, 163, 0.18), rgba(11,15,20,0.95));
      box-shadow: 0 10px 28px rgba(0,0,0,0.7);
    }

    .nav-cta:hover {
      background: radial-gradient(circle at top left, rgba(241, 230, 163, 0.27), rgba(11,15,20,1));
      text-decoration: none;
    }

    /* Layout */

    main {
      flex: 1;
    }

    .content {
      max-width: 1120px;
      margin: 0 auto;
      padding: 32px 20px 80px;
    }

    /* Hero section */

    .hero {
      display: grid;
      grid-template-columns: minmax(0, 1.45fr) minmax(0, 1.1fr);
      gap: 32px;
      align-items: stretch;
      margin-bottom: 40px;
    }

    .hero-left h1 {
      font-size: 34px;
      line-height: 1.12;
      letter-spacing: 0.03em;
      text-transform: uppercase;
      margin: 0 0 16px;
    }

    .hero-left h1 span.highlight {
      color: var(--gold);
    }

    .hero-lead {
      font-size: 15px;
      color: var(--text-muted);
      max-width: 540px;
      margin-bottom: 18px;
    }

    .hero-tagline {
      font-size: 13px;
      color: var(--text-main);
      margin-bottom: 18px;
    }

    .hero-badges {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 10px;
    }

    .badge {
      padding: 5px 11px;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(241, 230, 163, 0.24);
      font-size: 11px;
      letter-spacing: 0.07em;
      text-transform: uppercase;
      color: var(--gold);
      background: radial-gradient(circle at top left, rgba(241, 230, 163, 0.18), rgba(11,15,20,0.9));
    }

    .badge.dark {
      background: rgba(11,15,20,0.92);
      color: var(--text-muted);
      border-color: rgba(241, 230, 163, 0.12);
    }

    .hero-note {
      font-size: 12px;
      color: var(--text-muted);
      max-width: 520px;
    }

    .hero-note strong {
      color: var(--gold);
      font-weight: 500;
    }

    .hero-right {
      border-radius: var(--radius-large);
      background: radial-gradient(circle at top left, rgba(241, 230, 163, 0.22), rgba(11,15,20,0.98));
      border: 1px solid rgba(241, 230, 163, 0.38);
      box-shadow: var(--shadow-soft);
      padding: 20px 22px 18px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .hero-panel-title-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
    }

    .hero-panel-title {
      font-size: 14px;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: var(--gold);
    }

    .hero-panel-tag {
      font-size: 10px;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      padding: 4px 9px;
      border-radius: 999px;
      border: 1px solid rgba(241, 230, 163, 0.55);
      background: rgba(4,4,14,0.45);
      color: var(--text-muted);
    }

    .hero-panel-subtitle {
      font-size: 13px;
      color: var(--text-main);
      font-weight: 500;
      margin-top: 2px;
    }

    .hero-panel-list {
      margin: 6px 0 0;
      padding-left: 18px;
      font-size: 13px;
      color: var(--text-muted);
    }

    .hero-panel-list li + li {
      margin-top: 2px;
    }

    .hero-panel-footnote {
      margin-top: 4px;
      font-size: 11px;
      color: var(--text-muted);
    }

    .hero-panel-footnote strong {
      color: var(--gold);
      font-weight: 500;
    }

    /* Section titles */

    .section-label {
      font-size: 11px;
      letter-spacing: 0.24em;
      text-transform: uppercase;
      color: var(--text-muted);
      margin-bottom: 8px;
    }

    .section-title {
      font-size: 18px;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      margin-bottom: 22px;
    }

    .section-title span {
      color: var(--gold);
    }

    /* Narrative play area */

    .play-area {
      margin-top: 12px;
    }

    .play-grid {
      display: grid;
      grid-template-columns: minmax(0, 1.02fr) minmax(0, 1.15fr);
      gap: 20px;
      align-items: flex-start;
    }

    .card {
      background: var(--panel-bg);
      border-radius: var(--radius-large);
      border: 1px solid rgba(212, 175, 55, 0.65);
      box-shadow: var(--shadow-soft);
      padding: 20px 22px 22px;
      color: #1f1305;
    }

    .card-header {
      font-size: 13px;
      letter-spacing: 0.22em;
      text-transform: uppercase;
      color: #7a6432;
      margin-bottom: 10px;
    }

    .card-subtitle {
      font-size: 12px;
      color: #7e6d4a;
      margin-bottom: 14px;
    }

    .field-label {
      font-size: 11px;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: #7e6d4a;
      margin-bottom: 4px;
    }

    .select,
    .textarea {
      width: 100%;
      border-radius: 14px;
      border: 1px solid rgba(122, 100, 50, 0.25);
      padding: 10px 11px;
      font-size: 13px;
      font-family: var(--font-sans);
      color: #2a1c09;
      background: #fbf6ea;
      outline: none;
      transition: border-color 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
    }

    .select:focus,
    .textarea:focus {
      border-color: rgba(212, 175, 55, 0.85);
      background: #fdf8ee;
      box-shadow: 0 0 0 1px rgba(212, 175, 55, 0.65), 0 0 0 4px rgba(212, 175, 55, 0.2);
    }

    .select {
      appearance: none;
      -webkit-appearance: none;
      background-image: linear-gradient(45deg, transparent 50%, #b69a60 50%), linear-gradient(135deg, #b69a60 50%, transparent 50%);
      background-position: calc(100% - 16px) calc(50% - 3px), calc(100% - 12px) calc(50% - 3px);
      background-size: 6px 6px, 6px 6px;
      background-repeat: no-repeat;
    }

    .textarea {
      min-height: 180px;
      resize: vertical;
    }

    .field-hint {
      font-size: 11px;
      color: #8d7c56;
      margin-top: 8px;
    }

    .actions-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 14px;
    }

    .btn {
      border: none;
      border-radius: var(--radius-pill);
      font-size: 13px;
      padding: 9px 16px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      white-space: nowrap;
      transition: transform 0.12s ease, box-shadow 0.12s ease, background 0.12s ease;
    }

    .btn-primary {
      background: radial-gradient(circle at top left, #f3e8b2, #d4af37);
      color: #3d3214;
      box-shadow: 0 12px 30px rgba(0,0,0,0.35);
      font-weight: 500;
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 16px 38px rgba(0,0,0,0.45);
    }

    .btn-secondary {
      background: #f0e4cd;
      color: #5c4c2d;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(122, 100, 50, 0.4);
    }

    .btn-ghost {
      background: transparent;
      color: #5c4c2d;
      border-radius: var(--radius-pill);
      border: 1px dashed rgba(122, 100, 50, 0.6);
    }

    .btn-ghost:hover {
      background: rgba(244, 234, 210, 0.7);
    }

    .btn-icon {
      font-size: 15px;
      line-height: 1;
    }

    /* Right side psycho-forensic card */

    .card-right {
      position: relative;
      overflow: hidden;
    }

    .pill-grid {
      display: grid;
      grid-template-columns: repeat(2,minmax(0,1fr));
      gap: 10px;
      margin-bottom: 12px;
    }

    .metric-pill {
      border-radius: 18px;
      padding: 10px 12px 9px;
      background: #fbf6ea;
      border: 1px solid rgba(122, 100, 50, 0.4);
      display: flex;
      flex-direction: column;
      gap: 3px;
    }

    .metric-label {
      font-size: 10px;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: #927c4c;
    }

    .metric-value-row {
      display: flex;
      align-items: baseline;
      gap: 6px;
    }

    .metric-value {
      font-size: 18px;
      font-weight: 700;
      color: #39240d;
    }

    .metric-unit {
      font-size: 11px;
      color: #927c4c;
    }

    .metric-caption {
      font-size: 11px;
      color: #7f6d45;
    }

    .metric-caption.danger {
      color: var(--danger);
      font-weight: 500;
    }

    .metric-caption.safe {
      color: #3a7c4a;
      font-weight: 500;
    }

    .detected-heading {
      font-size: 11px;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: #927c4c;
      margin: 8px 0 4px;
    }

    .detected-body {
      font-size: 12px;
      color: #5a4523;
      margin-bottom: 8px;
    }

    .detected-body strong {
      font-weight: 600;
    }

    .matrix-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 4px;
      font-size: 12px;
    }

    .matrix-table th,
    .matrix-table td {
      padding: 6px 8px;
      border-bottom: 1px solid rgba(180, 155, 94, 0.4);
      vertical-align: top;
    }

    .matrix-table th {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: #927c4c;
      text-align: left;
    }

    .matrix-axis {
      font-weight: 500;
      color: #3b2711;
      width: 55%;
    }

    .matrix-level {
      text-align: right;
      white-space: nowrap;
      font-size: 11px;
      font-weight: 600;
      border-radius: 999px;
      padding: 3px 8px;
      display: inline-block;
    }

    .level-none {
      background: #f1e6d3;
      color: #7f6d45;
    }

    .level-present {
      background: #fff3c4;
      color: #8b5a1d;
    }

    .level-strong {
      background: var(--danger-soft);
      color: #8b1f1f;
      box-shadow: 0 0 0 1px rgba(228, 75, 75, 0.35);
    }

    .signals-block,
    .phenotype-block,
    .highlight-block {
      margin-top: 10px;
      padding-top: 8px;
      border-top: 1px dashed rgba(180, 155, 94, 0.6);
      font-size: 12px;
      color: #5a4523;
    }

    .signals-block ul {
      padding-left: 18px;
      margin: 4px 0 0;
    }

    .signals-block li + li {
      margin-top: 2px;
    }

    .signals-title,
    .phenotype-title,
    .highlight-title {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: #927c4c;
      margin-bottom: 3px;
    }

    .highlight-box {
      margin-top: 4px;
      padding: 8px 10px;
      border-radius: 14px;
      background: #fbf6ea;
      border: 1px solid rgba(212,175,55,0.5);
      font-size: 12px;
      line-height: 1.45;
      font-family: var(--font-sans);
    }

    mark.highlight {
      background: linear-gradient(90deg, rgba(241, 230, 163, 0.85), rgba(245, 222, 179, 0.1));
      border-radius: 4px;
      padding: 0 2px;
      box-shadow: 0 0 0 1px rgba(212, 175, 55, 0.3);
    }

    .demo-disclaimer {
      margin-top: 10px;
      font-size: 11px;
      color: #8d7c56;
    }

    /* CTA block */

    .cta-strip {
      margin-top: 30px;
      border-radius: 22px;
      background: radial-gradient(circle at top left, rgba(241, 230, 163, 0.12), rgba(11,15,20,0.98));
      border: 1px solid rgba(241, 230, 163, 0.35);
      padding: 18px 22px;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      color: var(--text-main);
      box-shadow: var(--shadow-soft);
    }

    .cta-text-main {
      font-size: 14px;
      font-weight: 500;
      margin-bottom: 3px;
    }

    .cta-text-sub {
      font-size: 12px;
      color: var(--text-muted);
      max-width: 540px;
    }

    .cta-btn {
      padding: 10px 18px;
      border-radius: var(--radius-pill);
      border: none;
      cursor: pointer;
      background: radial-gradient(circle at top left, #f3e8b2, #d4af37);
      color: #3d3214;
      font-size: 13px;
      font-weight: 600;
      box-shadow: 0 16px 32px rgba(0,0,0,0.55);
      white-space: nowrap;
    }

    .cta-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 20px 38px rgba(0,0,0,0.65);
    }

    .cta-note {
      font-size: 10px;
      color: var(--text-muted);
      margin-top: 4px;
      flex-basis: 100%;
    }

    /* Footer */

    footer {
      border-top: 1px solid rgba(241, 230, 163, 0.16);
      background: linear-gradient(to top, #020309, #050712);
      padding: 12px 18px 18px;
      font-size: 11px;
      color: var(--text-muted);
    }

    .footer-inner {
      max-width: 1120px;
      margin: 0 auto;
      display: flex;
      flex-wrap: wrap;
      gap: 6px 16px;
      align-items: center;
      justify-content: space-between;
    }

    .footer-links {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }

    .footer-link {
      color: var(--text-muted);
    }

    /* Responsive */

    @media (max-width: 960px) {
      .hero {
        grid-template-columns: minmax(0, 1fr);
      }

      .hero-right {
        order: -1;
      }

      .play-grid {
        grid-template-columns: minmax(0, 1fr);
      }

      .card-right {
        order: 2;
      }

      .cta-strip {
        flex-direction: column;
        align-items: flex-start;
      }
    }

    @media (max-width: 720px) {
      .top-nav-inner {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }

      .nav-links {
        flex-wrap: wrap;
      }

      .content {
        padding-inline: 16px;
      }

      .card {
        padding: 18px 16px 20px;
      }
    }
  </style>
</head>
<body>
<div class="page-shell">

  <!-- Top navigation -->
  <header class="top-nav">
    <div class="top-nav-inner">
      <div class="brand">
        <div class="brand-logo">
          <div class="brand-logo-inner">OP</div>
        </div>
        <div class="brand-text">
          <div class="brand-title">OPENPROOF — RPO v0.1</div>
          <div class="brand-subtitle">SIGNED JSON • HUMAN-READABLE PDF • PUBLIC HASH</div>
        </div>
      </div>
      <nav class="nav-links">
        <a class="nav-link" href="index.html">Overview</a>
        <a class="nav-link" href="specification.html">Specification</a>
        <a class="nav-link" href="examples.html">Examples</a>
        <a class="nav-link" href="tests.html">Tests</a>
        <a class="nav-link" href="playground.html">Playground</a>
        <span class="nav-link active">Psycho-Forensic Demo</span>
        <a class="nav-cta" href="https://github.com" target="_blank" rel="noopener noreferrer">View on GitHub</a>
      </nav>
    </div>
  </header>

  <main>
    <div class="content">

      <!-- Hero section -->
      <section class="hero">
        <div class="hero-left">
          <div class="section-label">RPO demonstration layer • narrative mechanisms</div>
          <h1>
            Try the <span class="highlight">psycho-forensic demo</span><br />
            — from raw story to control patterns
          </h1>
          <p class="hero-lead">
            Paste a short narrative about a potential coercive situation (domestic, workplace, institutional or online).
            This demo detects structural control patterns, estimates a rough coercion score, and highlights the narrative
            phenotype. Everything runs locally in your browser, with no AI model.
          </p>
          <p class="hero-tagline">
            In the scientific CNRS × TruthX pilot, this layer is powered by advanced psycho-forensic modules able to
            ingest message streams, reports and transcripts. Here you see a simplified and transparent decoder that already
            reveals structural control schemes.
          </p>
          <div class="hero-badges">
            <div class="badge">Based on models</div>
            <div class="badge">No AI, deterministic</div>
            <div class="badge">Coercive control focus</div>
            <div class="badge dark">RPO-compatible narrative layer</div>
          </div>
          <p class="hero-note">
            <strong>This is not a diagnostic tool.</strong> It does not decide who is right or wrong.
            It simply surfaces narrative structures that <em>could</em> be consistent with coercive control,
            to support professional assessment.
          </p>
        </div>

        <aside class="hero-right" aria-label="What this demo illustrates">
          <div class="hero-panel-title-row">
            <div>
              <div class="hero-panel-title">What this demo illustrates</div>
              <div class="hero-panel-subtitle">A narrative overlay that can sit on top of the RPO standard.</div>
            </div>
            <div class="hero-panel-tag">Demo mode</div>
          </div>
          <ul class="hero-panel-list">
            <li>Detection of control mechanisms (locking, threats, economic pressure, surveillance, normalisation).</li>
            <li>Aggregation into a mini-matrix of coercive control axes.</li>
            <li>Approximate coercion score and narrative risk level for the story.</li>
            <li>Highlighting of sensitive passages and the resulting narrative phenotype.</li>
          </ul>
          <p class="hero-panel-footnote">
            In a full evaluation, this layer would be one part of a broader
            <strong>psycho-medical-forensic assessment</strong> carried out by qualified professionals.
            Here it simply demonstrates how structured patterns can be made visible.
          </p>
        </aside>
      </section>

      <!-- Play with a narrative -->
      <section class="play-area" aria-labelledby="play-with-story">
        <div class="section-label" id="play-with-story">Play with a narrative</div>
        <h2 class="section-title">1. <span>Input narrative</span> • 2. Psycho-forensic overlay</h2>

        <div class="play-grid">
          <!-- Left card: narrative input -->
          <article class="card" aria-label="Narrative input">
            <div class="card-header">1. Narrative input</div>
            <div class="card-subtitle">
              Write a short account (1–3 paragraphs). Names can be anonymised.
              The goal is to observe the structure of control, not to judge the case.
            </div>

            <label class="field-label" for="context">Context</label>
            <select id="context" class="select">
              <option value="generic">Not specified / generic</option>
              <option value="intimate" selected>Intimate / domestic</option>
              <option value="work">Workplace / management</option>
              <option value="institutional">Institutional / administrative</option>
              <option value="online">Online / digital</option>
            </select>

            <div style="height: 10px;"></div>

            <label class="field-label" for="narrative">Narrative (free text)</label>
            <textarea id="narrative" class="textarea" placeholder="Describe what happened, in your own words. Who did what, when, where, and how did it affect you or others?"></textarea>

            <p class="field-hint">
              Tip: include at least one concrete action, a time marker, and all the constraints, threats or justifications you remember.
            </p>

            <div class="actions-row">
              <button class="btn btn-primary" id="analyze-btn">
                <span class="btn-icon">➜</span> Analyse the story
              </button>
              <button class="btn btn-secondary" id="reset-btn">Reset</button>
              <button class="btn btn-ghost" id="load-example-btn">
                Load an example
              </button>
            </div>
          </article>

          <!-- Right card: psycho-forensic overlay -->
          <article class="card card-right" aria-label="Psycho-forensic overlay">
            <div class="card-header">2. Psycho-medical-legal overlay</div>
            <div class="card-subtitle">
              The demo reads the text and highlights structural control patterns, using a conservative,
              rule-based model. Scores are <strong>approximate</strong> and only indicate converging signals
              within this story.
            </div>

            <div class="pill-grid">
              <div class="metric-pill">
                <div class="metric-label">Coercion score (approx.)</div>
                <div class="metric-value-row">
                  <span class="metric-value" id="coercion-score">0</span>
                  <span class="metric-unit">/ 100</span>
                </div>
                <div class="metric-caption" id="coercion-caption">
                  No structural control detected yet.
                </div>
              </div>
              <div class="metric-pill">
                <div class="metric-label">Immediate risk (narrative)</div>
                <div class="metric-value-row">
                  <span class="metric-value" id="risk-score">0</span>
                  <span class="metric-unit">/ 100</span>
                </div>
                <div class="metric-caption safe" id="risk-caption">
                  No explicit threat or physical risk appears in the text.
                </div>
              </div>
            </div>

            <div class="detected-heading">Mechanisms detected</div>
            <div class="detected-body" id="mechanisms-summary">
              No control mechanism detected yet.
            </div>

            <table class="matrix-table" aria-label="Coercive control axes">
              <thead>
              <tr>
                <th>Coercive control axis</th>
                <th>Demo level</th>
              </tr>
              </thead>
              <tbody id="matrix-body">
              <tr>
                <td class="matrix-axis">Isolation / confinement</td>
                <td class="matrix-level level-none">None so far</td>
              </tr>
              <tr>
                <td class="matrix-axis">Surveillance &amp; suspicion</td>
                <td class="matrix-level level-none">None so far</td>
              </tr>
              <tr>
                <td class="matrix-axis">Control of communications</td>
                <td class="matrix-level level-none">None so far</td>
              </tr>
              <tr>
                <td class="matrix-axis">Threats &amp; sanctions</td>
                <td class="matrix-level level-none">None so far</td>
              </tr>
              <tr>
                <td class="matrix-axis">Economic / resource control</td>
                <td class="matrix-level level-none">None so far</td>
              </tr>
              <tr>
                <td class="matrix-axis">Normalisation &amp; mental pressure</td>
                <td class="matrix-level level-none">None so far</td>
              </tr>
              </tbody>
            </table>

            <div class="signals-block">
              <div class="signals-title">Signals to monitor</div>
              <div id="signals-text">
                No signal yet, as no text has been analysed.
              </div>
              <ul id="signals-list"></ul>
            </div>

            <div class="phenotype-block">
              <div class="phenotype-title">Narrative phenotype</div>
              <div id="phenotype-text">
                The narrative profile will appear here after analysis.
              </div>
            </div>

            <div class="highlight-block">
              <div class="highlight-title">Story with sensitive passages highlighted</div>
              <div class="highlight-box" id="highlighted-text">
                The analysed story will be repeated here, with sensitive segments highlighted.
              </div>
            </div>

            <p class="demo-disclaimer">
              This heuristic logic is intentionally conservative and demonstrative. It simply makes
              possible control patterns visible from the provided text. It does not replace legal,
              clinical or protective assessment.
            </p>
          </article>
        </div>

        <p class="demo-disclaimer" style="margin-top:14px;">
          <strong>Reminder:</strong> this is an experimental, open demonstration layer compatible with
          the RPO narrative structure. It does not embed any AI model and does not determine truth or falsity.
        </p>
      </section>

      <!-- CNRS pilot CTA -->
      <section class="cta-strip" aria-label="CNRS pilot invitation">
        <div>
          <div class="cta-text-main">Facing a real, complex case?</div>
          <div class="cta-text-sub">
            This page shows a demonstrative narrative decoder. In the CNRS scientific pilot,
            the psycho-forensic layer is coupled with the full RPO standard, temporal graphs and
            structured legal encoding. If you want to test these advanced modules on real cases,
            you can apply to the CNRS × TruthX pilot programme.
          </div>
        </div>
        <button class="cta-btn">
          Apply for the CNRS pilot
        </button>
        <div class="cta-note">
          This demonstration is not legal advice or a clinical diagnosis. It does not replace specialist support.
        </div>
      </section>

    </div>
  </main>

  <!-- Footer -->
  <footer>
    <div class="footer-inner">
      <div>
        <div>OpenProof — RPO Specification v0.1</div>
        <div>
          © 2026 OpenProof Consortium.
          Research collaboration: CNRS – GREYC – Université de Caen Normandie —
          Requirements editor: Gersende Ryard de Parcey.
        </div>
      </div>
      <div class="footer-links">
        <a href="https://openproof.net" class="footer-link" target="_blank" rel="noopener noreferrer">Technical site</a>
        <a href="https://truthx-openproof.org" class="footer-link" target="_blank" rel="noopener noreferrer">Governance</a>
        <a href="mailto:openproof@truthx.co" class="footer-link">Contact</a>
      </div>
    </div>
  </footer>
</div>

<script>
  // --- Simple deterministic heuristic engine (demo only, no AI) ---

  const narrativeEl = document.getElementById('narrative');
  const analyzeBtn = document.getElementById('analyze-btn');
  const resetBtn = document.getElementById('reset-btn');
  const loadExampleBtn = document.getElementById('load-example-btn');

  const coercionScoreEl = document.getElementById('coercion-score');
  const coercionCaptionEl = document.getElementById('coercion-caption');
  const riskScoreEl = document.getElementById('risk-score');
  const riskCaptionEl = document.getElementById('risk-caption');
  const mechanismsSummaryEl = document.getElementById('mechanisms-summary');
  const matrixBodyEl = document.getElementById('matrix-body');
  const signalsTextEl = document.getElementById('signals-text');
  const signalsListEl = document.getElementById('signals-list');
  const phenotypeTextEl = document.getElementById('phenotype-text');
  const highlightedTextEl = document.getElementById('highlighted-text');

  const axes = [
    {
      key: 'isolation',
      label: 'Isolation / confinement',
      keywords: ['locked me', 'locked', 'blocked the door', 'would not let me leave', 'kept me in', 'confined me'],
    },
    {
      key: 'surveillance',
      label: 'Surveillance & suspicion',
      keywords: ['accusing me', 'accused me', 'checking my phone', 'monitoring my phone', 'spied on', 'surveillance'],
    },
    {
      key: 'communications',
      label: 'Control of communications',
      keywords: ['took my phone', 'took away my phone', 'no one needed to hear from me', 'stopped me from calling', 'blocked my messages'],
    },
    {
      key: 'threats',
      label: 'Threats & sanctions',
      keywords: ['threatened', 'if i refused', 'would stop paying', 'or else', 'raise the rent', 'lose my job', 'take the car keys'],
    },
    {
      key: 'economic',
      label: 'Economic / resource control',
      keywords: ['rent', 'bank account', 'money', 'salary', 'credit card', 'financial control', 'resources'],
    },
    {
      key: 'normalisation',
      label: 'Normalisation & mental pressure',
      keywords: ['normal for couples', 'everyone does', 'you are overreacting', 'you are crazy', 'i was overreacting', 'it is normal'],
    },
  ];

  const riskKeywords = ['threatened', 'kill', 'hurt', 'violence', 'danger', 'unsafe', 'afraid', 'fear', 'stop paying the rent', 'take the car keys'];

  const highlightTerms = [
    'locked me',
    'took my phone',
    'no one needed to hear from me tonight',
    'accusing me',
    'threatened',
    'take the car keys',
    'bank notifications',
    'normal for couples',
    'overreacting'
  ];

  function normaliseText(text) {
    return text.toLowerCase();
  }

  function countOccurrences(text, pattern) {
    const escaped = pattern.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    const regex = new RegExp(escaped, 'g');
    const matches = text.match(regex);
    return matches ? matches.length : 0;
  }

  function analyzeNarrative() {
    const raw = narrativeEl.value.trim();
    if (!raw) {
      alert('Please paste or write a short narrative first.');
      return;
    }

    const text = normaliseText(raw);

    const axisResults = axes.map(axis => {
      let count = 0;
      axis.keywords.forEach(k => {
        count += countOccurrences(text, k.toLowerCase());
      });
      return { axis, count };
    });

    const totalIndices = axisResults.reduce((acc, r) => acc + r.count, 0);
    const activeAxes = axisResults.filter(r => r.count > 0);

    // Coercion score: bound between 0 and 100, based on indices and axes
    let score = Math.min(100, (totalIndices * 12) + (activeAxes.length * 10));
    if (score > 0 && score < 20 && activeAxes.length >= 1) score = 20; // small floor if something is present
    coercionScoreEl.textContent = score.toString();

    if (score === 0) {
      coercionCaptionEl.textContent = 'No structural control detected yet.';
      coercionCaptionEl.classList.remove('danger');
    } else if (score < 50) {
      coercionCaptionEl.textContent = 'Some control cues appear in this story. Further context would be needed.';
      coercionCaptionEl.classList.remove('danger');
    } else {
      coercionCaptionEl.textContent = 'Several control axes co-exist. This pattern suggests a possible coercive environment.';
      coercionCaptionEl.classList.add('danger');
    }

    // Risk score: based on explicit threat / danger words
    let riskCount = 0;
    riskKeywords.forEach(k => {
      riskCount += countOccurrences(text, k.toLowerCase());
    });
    let riskScore = 0;
    if (riskCount === 1) riskScore = 40;
    else if (riskCount === 2) riskScore = 70;
    else if (riskCount >= 3) riskScore = 100;
    riskScoreEl.textContent = riskScore.toString();

    if (riskScore === 0) {
      riskCaptionEl.textContent = 'No explicit threat or physical risk appears in the text.';
      riskCaptionEl.classList.remove('danger');
      riskCaptionEl.classList.add('safe');
    } else {
      riskCaptionEl.textContent = 'Risk signals appear in the story (threats, escalation, sanctions). This calls for immediate vigilance.';
      riskCaptionEl.classList.remove('safe');
      riskCaptionEl.classList.add('danger');
    }

    // Mechanisms summary
    if (activeAxes.length === 0) {
      mechanismsSummaryEl.textContent = 'No control mechanism detected at this level in the story.';
    } else {
      const labels = activeAxes.map(r => r.axis.label);
      mechanismsSummaryEl.innerHTML =
        '<strong>Mechanisms detected:</strong> ' +
        labels.join(', ') +
        '.';
    }

    // Matrix table
    matrixBodyEl.innerHTML = '';
    axisResults.forEach(r => {
      const row = document.createElement('tr');
      const axisCell = document.createElement('td');
      axisCell.className = 'matrix-axis';
      axisCell.textContent = r.axis.label;

      const levelCell = document.createElement('td');
      let label, levelClass;
      if (r.count === 0) {
        label = 'None so far';
        levelClass = 'matrix-level level-none';
      } else if (r.count === 1) {
        label = 'Present, 1 cue';
        levelClass = 'matrix-level level-present';
      } else {
        label = 'Strong, ' + r.count + ' cues';
        levelClass = 'matrix-level level-strong';
      }
      levelCell.className = levelClass;
      levelCell.textContent = label;

      row.appendChild(axisCell);
      row.appendChild(levelCell);
      matrixBodyEl.appendChild(row);
    });

    // Signals to monitor
    signalsListEl.innerHTML = '';
    if (activeAxes.length === 0) {
      signalsTextEl.textContent = 'No weak signal yet, as no structural control has been detected.';
    } else {
      signalsTextEl.textContent = 'Axes appearing only once so far (to be watched over time):';
      const weakAxes = axisResults.filter(r => r.count === 1);
      weakAxes.forEach(r => {
        const li = document.createElement('li');
        li.textContent = r.axis.label;
        signalsListEl.appendChild(li);
      });
      if (weakAxes.length === 0) {
        const li = document.createElement('li');
        li.textContent = 'All detected axes show repeated cues in this single story.';
        signalsListEl.appendChild(li);
      }
    }

    // Narrative phenotype
    if (activeAxes.length === 0) {
      phenotypeTextEl.textContent =
        'The narrative does not show a clear coercive pattern at this stage. ' +
        'Isolated tensions may be present, but the structure does not converge on systematic control.';
    } else {
      const axisLabels = activeAxes.map(r => r.axis.label);
      phenotypeTextEl.textContent =
        'The story reads like a pattern of structured control where several axes interact: ' +
        axisLabels.join(', ') +
        '. In a full evaluation, this combination would justify careful attention and cross-checking with other evidence.';
    }

    // Highlighted narrative
    let highlighted = raw;
    highlightTerms.forEach(term => {
      const escaped = term.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
      const regex = new RegExp(escaped, 'gi');
      highlighted = highlighted.replace(regex, match => '<mark class="highlight">' + match + '</mark>');
    });
    highlightedTextEl.innerHTML = highlighted;
  }

  function resetDemo() {
    narrativeEl.value = '';
    coercionScoreEl.textContent = '0';
    coercionCaptionEl.textContent = 'No structural control detected yet.';
    coercionCaptionEl.classList.remove('danger');
    riskScoreEl.textContent = '0';
    riskCaptionEl.textContent = 'No explicit threat or physical risk appears in the text.';
    riskCaptionEl.classList.remove('danger');
    riskCaptionEl.classList.add('safe');
    mechanismsSummaryEl.textContent = 'No control mechanism detected yet.';
    signalsTextEl.textContent = 'No signal yet, as no text has been analysed.';
    signalsListEl.innerHTML = '';
    phenotypeTextEl.textContent = 'The narrative profile will appear here after analysis.';
    highlightedTextEl.textContent = 'The analysed story will be repeated here, with sensitive segments highlighted.';
    // Reset matrix
    matrixBodyEl.innerHTML = '';
    axes.forEach(axis => {
      const row = document.createElement('tr');
      const axisCell = document.createElement('td');
      axisCell.className = 'matrix-axis';
      axisCell.textContent = axis.label;
      const levelCell = document.createElement('td');
      levelCell.className = 'matrix-level level-none';
      levelCell.textContent = 'None so far';
      row.appendChild(axisCell);
      row.appendChild(levelCell);
      matrixBodyEl.appendChild(row);
    });
  }

  function loadExample() {
    const example = "On Saturday 12 February, around 9 pm, he locked me in the living room for almost two hours after I refused to cancel a dinner with my sister. " +
      "He stood in front of the door, took my phone and said that \"no one needed to hear from me tonight\". " +
      "Two days later, on Monday, he woke me up at 5:30 am accusing me of hiding conversations from him because I didn't leave my phone charging in the kitchen as he demanded. " +
      "Last week, he also threatened to take the car keys if I didn't give him all my bank notifications, saying it was \"normal for couples to share everything\" and that I was overreacting.";
    narrativeEl.value = example;
    analyzeNarrative();
  }

  analyzeBtn.addEventListener('click', analyzeNarrative);
  resetBtn.addEventListener('click', resetDemo);
  loadExampleBtn.addEventListener('click', loadExample);

  // Initialise matrix on load
  resetDemo();
</script>
</body>
</html>
