<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>OpenProof — Psycho-Forensic Demo | Narrative control patterns</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- SEO -->
  <meta name="description"
        content="Psycho-forensic demo on top of the RPO standard. Paste a short narrative and see how structural markers of coercive control and narrative pressure are highlighted." />
  <link rel="canonical" href="https://rpo.openproof.net/demo-psycho.html" />

  <!-- Open Graph -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="OpenProof — Psycho-Forensic Demo" />
  <meta property="og:description"
        content="From raw narrative to structural control patterns: experimental psycho-forensic layer compatible with the RPO standard." />
  <meta property="og:url" content="https://rpo.openproof.net/demo-psycho.html" />

  <style>
    :root {
      --bg-main: #04040e;
      --bg-elevated: #0b0f14;
      --card-bg: #fbf8f1;
      --card-soft: #f7f3e8;
      --accent-gold: #d4af37;
      --accent-gold-soft: #f3e8b2;
      --accent-gold-deep: #b08a22;
      --text-main: #f7f3e8;
      --text-ink: #1f1b12;
      --text-muted: #7a7361;
      --pill-bg: rgba(243, 232, 178, 0.1);
      --pill-border: rgba(243, 232, 178, 0.7);
      --danger: #ff6b6b;
      --safe: #3ecf8e;
      --shadow-soft: 0 18px 40px rgba(0, 0, 0, 0.55);
      --radius-card: 22px;
      --radius-pill: 999px;
      --highlight: rgba(244, 208, 111, 0.35);
      --border-gold-soft: 1px solid rgba(212, 175, 55, 0.7);
      --border-gold-strong: 1px solid rgba(255, 215, 128, 0.9);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Inter", sans-serif;
      background: radial-gradient(circle at top, #151a26 0, var(--bg-main) 55%);
      color: var(--text-main);
      -webkit-font-smoothing: antialiased;
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    /* Top nav */

    .nav {
      position: sticky;
      top: 0;
      z-index: 40;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 36px;
      background: linear-gradient(to bottom,
        rgba(4, 4, 14, 0.98),
        rgba(4, 4, 14, 0.92),
        rgba(4, 4, 14, 0.86),
        rgba(4, 4, 14, 0.0)
      );
      backdrop-filter: blur(16px);
      border-bottom: 1px solid rgba(212, 175, 55, 0.25);
    }

    .nav-left {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .nav-emblem {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 20%, #fff8dc, #d4af37 40%, #7a6432 75%, #2a2114 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.5), 0 10px 30px rgba(0, 0, 0, 0.7);
      flex-shrink: 0;
    }

    .nav-emblem-inner {
      width: 22px;
      height: 22px;
      border-radius: 50%;
      border: 2px solid rgba(4, 4, 14, 0.9);
      position: relative;
    }

    .nav-emblem-inner::before,
    .nav-emblem-inner::after {
      content: "";
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(4, 4, 14, 0.9);
    }

    .nav-emblem-inner::before {
      top: 3px;
      width: 2px;
      height: 10px;
    }

    .nav-emblem-inner::after {
      bottom: 3px;
      width: 8px;
      height: 2px;
      border-radius: 999px;
    }

    .nav-title-block {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .nav-title {
      font-size: 14px;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      font-weight: 600;
    }

    .nav-subtitle {
      font-size: 11px;
      color: rgba(247, 243, 232, 0.68);
    }

    .nav-links {
      display: flex;
      align-items: center;
      gap: 18px;
      font-size: 13px;
    }

    .nav-link {
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid transparent;
      color: rgba(247, 243, 232, 0.78);
    }

    .nav-link:hover {
      border-color: rgba(243, 232, 178, 0.5);
      background: rgba(243, 232, 178, 0.05);
    }

    .nav-link-active {
      border-color: rgba(243, 232, 178, 0.9);
      background: radial-gradient(circle at top, rgba(243, 232, 178, 0.15), rgba(243, 232, 178, 0.02));
      color: #fff9e8;
    }

    .nav-cta {
      padding: 8px 16px;
      border-radius: 999px;
      border: 1px solid rgba(255, 228, 150, 0.95);
      background: radial-gradient(circle at 20% 0, #fff7da, #f3e0a5 40%, #c79f2e 100%);
      color: #20160b;
      font-size: 13px;
      font-weight: 600;
      box-shadow: 0 12px 28px rgba(0, 0, 0, 0.7);
    }

    .nav-cta:hover {
      filter: brightness(1.05);
      transform: translateY(-1px);
    }

    main {
      max-width: 1180px;
      margin: 0 auto;
      padding: 40px 24px 80px;
    }

    /* Hero */

    .hero {
      display: grid;
      grid-template-columns: minmax(0, 3.2fr) minmax(0, 2.2fr);
      gap: 32px;
      align-items: stretch;
      margin-bottom: 40px;
    }

    .hero-left-title {
      font-family: "Orbitron", system-ui, -apple-system, BlinkMacSystemFont, "Inter", sans-serif;
      font-size: 32px;
      line-height: 1.15;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      margin-bottom: 18px;
    }

    .hero-left-sub {
      max-width: 520px;
      font-size: 14px;
      color: rgba(247, 243, 232, 0.78);
      margin-bottom: 16px;
    }

    .hero-pills {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 14px;
    }

    .pill {
      padding: 4px 10px;
      border-radius: var(--radius-pill);
      border: 1px solid var(--pill-border);
      background: var(--pill-bg);
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: rgba(243, 232, 178, 0.95);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .pill-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 10%, #fff7da, #f3e0a5 40%, #d4af37 100%);
    }

    .hero-left-note {
      font-size: 12px;
      color: rgba(247, 243, 232, 0.65);
      max-width: 540px;
    }

    .hero-right {
      background: radial-gradient(circle at top left, #fdf7e9, #f7f3e8 40%, #efe3c6 100%);
      border-radius: var(--radius-card);
      border: var(--border-gold-soft);
      box-shadow: var(--shadow-soft);
      padding: 20px 22px;
      color: var(--text-ink);
      display: flex;
      flex-direction: column;
      gap: 14px;
      position: relative;
      overflow: hidden;
    }

    .hero-right::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top right, rgba(243, 232, 178, 0.55), transparent 55%);
      opacity: 0.7;
      pointer-events: none;
    }

    .hero-right-inner {
      position: relative;
      z-index: 1;
    }

    .hero-card-label-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }

    .hero-card-title {
      font-size: 13px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: #7a6432;
    }

    .hero-card-tag {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(122, 100, 50, 0.55);
      background: rgba(251, 248, 241, 0.9);
      color: #7a6432;
    }

    .hero-card-lead {
      font-size: 13px;
      margin-bottom: 10px;
    }

    .hero-card-list {
      list-style: none;
      padding: 0;
      margin: 0 0 8px;
      font-size: 12px;
      color: #554b33;
    }

    .hero-card-list li {
      margin-bottom: 4px;
      display: flex;
      align-items: flex-start;
      gap: 8px;
    }

    .hero-card-bullet {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      margin-top: 5px;
      background: linear-gradient(to bottom right, #f6e2a9, #d4af37);
      flex-shrink: 0;
    }

    .hero-card-foot {
      font-size: 11px;
      color: #8a7b57;
    }

    .hero-card-foot span {
      font-weight: 600;
      color: #5a4c2e;
    }

    /* Demo section */

    .section-title {
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      margin-bottom: 12px;
      color: rgba(247, 243, 232, 0.7);
    }

    .demo-grid {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.1fr);
      gap: 24px;
      align-items: flex-start;
      margin-bottom: 26px;
    }

    .card {
      background: radial-gradient(circle at top left, #fdf7ec, var(--card-soft) 40%, var(--card-bg) 100%);
      border-radius: var(--radius-card);
      border: var(--border-gold-soft);
      box-shadow: var(--shadow-soft);
      padding: 20px 22px 20px;
      color: var(--text-ink);
      position: relative;
    }

    .card::before {
      content: "";
      position: absolute;
      left: 0;
      right: 0;
      top: 0;
      height: 3px;
      border-radius: 22px 22px 0 0;
      background: linear-gradient(to right,
        rgba(212, 175, 55, 0.2),
        rgba(243, 232, 178, 0.9),
        rgba(212, 175, 55, 0.2)
      );
      opacity: 0.9;
    }

    .card-title {
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      margin-bottom: 10px;
      color: #7a6432;
    }

    .field-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: #8c7a4b;
      margin-bottom: 6px;
    }

    .select {
      width: 100%;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(189, 168, 118, 0.9);
      font-size: 13px;
      background: rgba(251, 248, 241, 0.98);
      color: #1f1b12;
      margin-bottom: 12px;
    }

    textarea {
      width: 100%;
      min-height: 170px;
      border-radius: 14px;
      border: 1px solid rgba(189, 168, 118, 0.9);
      padding: 10px 11px;
      font-size: 13px;
      resize: vertical;
      background: rgba(251, 248, 241, 0.98);
      color: #1f1b12;
      line-height: 1.35;
    }

    textarea::placeholder {
      color: rgba(102, 92, 72, 0.7);
    }

    .helper {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 6px;
    }

    .button-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 14px;
    }

    .btn {
      border-radius: 999px;
      border: 1px solid transparent;
      font-size: 13px;
      padding: 8px 16px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: none;
    }

    .btn-primary {
      background: radial-gradient(circle at 20% 0, #fff7da, #f3e0a5 40%, #c79f2e 100%);
      border-color: rgba(255, 228, 150, 0.95);
      color: #20160b;
      font-weight: 600;
      box-shadow: 0 10px 24px rgba(0, 0, 0, 0.6);
    }

    .btn-primary:hover {
      filter: brightness(1.05);
      transform: translateY(-1px);
    }

    .btn-light {
      background: rgba(251, 248, 241, 0.9);
      border-color: rgba(189, 168, 118, 0.6);
      color: #4f4530;
    }

    .btn-light:hover {
      background: #fffaf0;
    }

    .btn-icon {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      border: 2px solid #a17c1a;
      box-shadow: 0 0 0 2px rgba(255, 238, 200, 0.8);
    }

    .btn-secondary {
      background: rgba(4, 4, 14, 0.03);
      border-color: rgba(189, 168, 118, 0.6);
      color: #4f4530;
    }

    .btn-secondary:hover {
      background: rgba(243, 232, 178, 0.12);
    }

    /* Right card content */

    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
      margin-bottom: 10px;
    }

    .metric-box {
      border-radius: 14px;
      padding: 8px 10px 7px;
      background: rgba(251, 248, 241, 0.98);
      border: 1px solid rgba(189, 168, 118, 0.8);
      font-size: 11px;
      display: flex;
      flex-direction: column;
      gap: 3px;
    }

    .metric-label {
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: #8c7a4b;
    }

    .metric-value {
      font-size: 16px;
      font-weight: 600;
      color: #2b2316;
    }

    .metric-detail {
      font-size: 11px;
      color: #7a7361;
    }

    .matrix {
      width: 100%;
      border-spacing: 0;
      border-collapse: separate;
      margin-top: 10px;
      font-size: 11px;
    }

    .matrix th,
    .matrix td {
      padding: 6px 8px;
      border-bottom: 1px solid rgba(210, 191, 145, 0.4);
    }

    .matrix th {
      text-align: left;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      font-weight: 500;
      color: #8c7a4b;
      font-size: 10px;
    }

    .matrix tr:last-child td {
      border-bottom: none;
    }

    .matrix-axis {
      color: #4a3f26;
      width: 55%;
    }

    .matrix-level {
      text-align: right;
      font-weight: 500;
    }

    .matrix-level-none {
      color: #8f8a7a;
    }

    .matrix-level-low {
      color: #b8860b;
    }

    .matrix-level-high {
      color: #b22222;
    }

    .detected-list,
    .signals-text,
    .phenotype-text {
      font-size: 11px;
      color: #6b5f40;
      margin-top: 6px;
    }

    .detected-list strong {
      font-weight: 600;
      color: #4a3f26;
    }

    .highlight-box {
      margin-top: 12px;
      border-radius: 14px;
      border: 1px dashed rgba(189, 168, 118, 0.8);
      background: rgba(251, 248, 241, 0.9);
      padding: 10px 11px;
      font-size: 11px;
      color: #3a3224;
      max-height: 170px;
      overflow-y: auto;
      white-space: pre-wrap;
    }

    .highlight-label {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: #8c7a4b;
      margin-bottom: 4px;
    }

    .highlight-span {
      background: var(--highlight);
      border-radius: 4px;
      padding: 0 1px;
    }

    /* Bottom CTA */

    .cta-strip {
      margin-top: 28px;
      background: radial-gradient(circle at top left, rgba(243, 232, 178, 0.12), rgba(10, 10, 22, 0.96));
      border-radius: var(--radius-card);
      border: 1px solid rgba(212, 175, 55, 0.5);
      padding: 16px 20px;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 14px;
      color: #f7f3e8;
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.6);
    }

    .cta-text-main {
      font-size: 13px;
      font-weight: 500;
      margin-bottom: 4px;
    }

    .cta-text-sub {
      font-size: 12px;
      color: rgba(247, 243, 232, 0.7);
    }

    .cta-button {
      padding: 9px 18px;
      border-radius: 999px;
      border: 1px solid rgba(255, 228, 150, 0.95);
      background: radial-gradient(circle at 20% 0, #fff7da, #f3e0a5 40%, #c79f2e 100%);
      color: #20160b;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.8);
      white-space: nowrap;
    }

    .cta-button:hover {
      filter: brightness(1.05);
      transform: translateY(-1px);
    }

    /* Footer */

    footer {
      border-top: 1px solid rgba(212, 175, 55, 0.4);
      background: radial-gradient(circle at top, #111623, #04040e 55%);
      padding: 14px 24px 18px;
      color: rgba(247, 243, 232, 0.72);
      font-size: 11px;
    }

    .footer-inner {
      max-width: 1180px;
      margin: 0 auto;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }

    .footer-links {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }

    .footer-link {
      text-decoration: none;
      color: rgba(247, 243, 232, 0.75);
    }

    .footer-link:hover {
      text-decoration: underline;
    }

    @media (max-width: 960px) {
      .hero {
        grid-template-columns: minmax(0, 1fr);
      }

      .demo-grid {
        grid-template-columns: minmax(0, 1fr);
      }

      main {
        padding-top: 26px;
      }
    }

    @media (max-width: 720px) {
      .nav {
        padding: 10px 16px;
      }

      main {
        padding: 26px 16px 70px;
      }

      .cta-strip {
        align-items: flex-start;
      }
    }
  </style>
</head>
<body>
<header class="nav">
  <div class="nav-left">
    <div class="nav-emblem">
      <div class="nav-emblem-inner"></div>
    </div>
    <div class="nav-title-block">
      <div class="nav-title">OPENPROOF — RPO v0.1</div>
      <div class="nav-subtitle">Signed JSON • Human-readable PDF • Public hash</div>
    </div>
  </div>
  <nav class="nav-links">
    <a class="nav-link" href="index.html" target="_blank" rel="noopener noreferrer">Overview</a>
    <a class="nav-link" href="specification.html" target="_blank" rel="noopener noreferrer">Specification</a>
    <a class="nav-link" href="examples.html" target="_blank" rel="noopener noreferrer">Examples</a>
    <a class="nav-link" href="tests.html" target="_blank" rel="noopener noreferrer">Tests</a>
    <a class="nav-link" href="playground.html" target="_blank" rel="noopener noreferrer">Playground</a>
    <a class="nav-link nav-link-active" href="demo-psycho.html">Psycho-forensic demo</a>
    <a class="nav-cta" href="https://github.com/openproof-net/rpo-spec-v0.1"
       target="_blank" rel="noopener noreferrer">View on GitHub</a>
  </nav>
</header>

<main>
  <!-- HERO -->
  <section class="hero">
    <div>
      <div class="section-title">RPO demo layer · Narrative mechanisms</div>
      <h1 class="hero-left-title">
        Try the psycho-forensic demo<br />
        from raw story to control patterns
      </h1>
      <p class="hero-left-sub">
        Paste a short narrative describing a potential coercive situation
        (domestic, workplace or institutional). This demo highlights
        structural control mechanisms and gives an approximate narrative
        imprint — without using any AI model.
      </p>

      <div class="hero-pills">
        <div class="pill"><span class="pill-dot"></span> Model-free determination</div>
        <div class="pill"><span class="pill-dot"></span> Coercive control matrix</div>
        <div class="pill"><span class="pill-dot"></span> RPO-compatible narrative layer</div>
      </div>

      <p class="hero-left-note">
        In the CNRS × TruthX scientific pilot, this layer is powered by advanced
        psycho-forensic modules able to ingest message logs, reports and
        transcripts. Here you see a simplified and transparent demonstrator
        that already exposes structural control patterns.
      </p>
    </div>

    <aside class="hero-right">
      <div class="hero-right-inner">
        <div class="hero-card-label-row">
          <div class="hero-card-title">What this demo illustrates</div>
          <div class="hero-card-tag">Demo version</div>
        </div>
        <p class="hero-card-lead">
          Think of it as a narrative decoder that can sit on top of the RPO
          evidence bundle.
        </p>
        <ul class="hero-card-list">
          <li>
            <span class="hero-card-bullet"></span>
            <span>Detects typical axes of coercive control
              (isolation, surveillance, economic pressure).</span>
          </li>
          <li>
            <span class="hero-card-bullet"></span>
            <span>Builds a small control matrix and an approximate
              <strong>coercion score</strong>.</span>
          </li>
          <li>
            <span class="hero-card-bullet"></span>
            <span>Highlights sensitive segments of the story that carry
              structural pressure.</span>
          </li>
          <li>
            <span class="hero-card-bullet"></span>
            <span>Stays heuristic and conservative: no diagnosis, no legal
              qualification.</span>
          </li>
        </ul>
        <p class="hero-card-foot">
          <span>Goal:</span> make invisible control structures readable, before
          connecting deeper scientific engines in restricted pilots.
        </p>
      </div>
    </aside>
  </section>

  <!-- DEMO -->
  <section aria-label="Psycho-forensic narrative demo">
    <div class="section-title">Play with a narrative</div>

    <div class="demo-grid">
      <!-- LEFT: INPUT -->
      <div class="card">
        <h2 class="card-title">1. Narrative input</h2>
        <div class="field-label">Context</div>
        <select id="contextSelect" class="select">
          <option value="generic">Unspecified / generic</option>
          <option value="intimate">Intimate / domestic</option>
          <option value="work">Workplace / management</option>
          <option value="institutional">Institutional / administrative</option>
          <option value="online">Online / digital</option>
        </select>

        <div class="field-label">Story (free text)</div>
        <textarea id="storyInput" placeholder="Describe what happened, with your own words. Who did what, when, where, and how did it affect you or others?"></textarea>
        <p class="helper">
          Tip: include at least one concrete action, a time marker and all
          threats, justifications or constraints you remember.
        </p>

        <div class="button-row">
          <button class="btn btn-primary" id="analyzeBtn">
            <span class="btn-icon"></span>
            <span>Analyse the narrative</span>
          </button>
          <button class="btn btn-light" id="resetBtn">Reset</button>
          <button class="btn btn-secondary" id="loadExampleBtn">Load an example</button>
        </div>
      </div>

      <!-- RIGHT: RESULTS -->
      <div class="card">
        <h2 class="card-title">2. Psycho-forensic overlay</h2>

        <div class="metrics-grid">
          <div class="metric-box">
            <div class="metric-label">Coercion score (approx.)</div>
            <div class="metric-value" id="coercionScore">0 / 100</div>
            <div class="metric-detail" id="coercionScoreDetail">No structural control detected yet.</div>
          </div>
          <div class="metric-box">
            <div class="metric-label">Immediate risk (narrative)</div>
            <div class="metric-value" id="riskScore">0 / 100</div>
            <div class="metric-detail" id="riskScoreDetail">No explicit threat in the story.</div>
          </div>
        </div>

        <div class="detected-list" id="mechanismsDetected">
          <strong>Mechanisms detected:</strong> none yet — paste a story on the left and click “Analyse”.
        </div>

        <table class="matrix" aria-label="Coercive control matrix">
          <thead>
          <tr>
            <th>Coercive control axis</th>
            <th style="text-align:right;">Level (demo)</th>
          </tr>
          </thead>
          <tbody>
          <tr>
            <td class="matrix-axis">Isolation / confinement</td>
            <td class="matrix-level matrix-level-none" id="axisIsolation">None so far</td>
          </tr>
          <tr>
            <td class="matrix-axis">Surveillance &amp; suspicion</td>
            <td class="matrix-level matrix-level-none" id="axisSurveillance">None so far</td>
          </tr>
          <tr>
            <td class="matrix-axis">Control of communications</td>
            <td class="matrix-level matrix-level-none" id="axisComms">None so far</td>
          </tr>
          <tr>
            <td class="matrix-axis">Threats &amp; sanctions</td>
            <td class="matrix-level matrix-level-none" id="axisThreats">None so far</td>
          </tr>
          <tr>
            <td class="matrix-axis">Economic / resource control</td>
            <td class="matrix-level matrix-level-none" id="axisEconomic">None so far</td>
          </tr>
          <tr>
            <td class="matrix-axis">Normalisation &amp; mental pressure</td>
            <td class="matrix-level matrix-level-none" id="axisNormalisation">None so far</td>
          </tr>
          </tbody>
        </table>

        <div class="signals-text" id="signalsToWatch">
          <strong>Signals to monitor:</strong> will appear here once a story has been analysed.
        </div>

        <div class="phenotype-text" id="phenotypeSummary">
          <strong>Narrative phenotype:</strong> not assessed yet.
        </div>

        <div class="highlight-box" id="highlightBox">
          <div class="highlight-label">Story with sensitive passages</div>
          <div id="highlightContent">The analysed narrative will be displayed here, with passages carrying structural pressure highlighted in gold.</div>
        </div>
      </div>
    </div>

    <div class="cta-strip">
      <div>
        <div class="cta-text-main">Facing a real case rather than a demo?</div>
        <div class="cta-text-sub">
          This page shows a demonstrative decoding only. In the scientific CNRS × TruthX
          pilot, the psycho-forensic layer is stricter, coupled to the RPO standard and
          includes structured legal views.
        </div>
      </div>
      <a class="cta-button"
         href="https://www.truthx.co/pilote-individuel"
         target="_blank" rel="noopener noreferrer">
        Apply for the CNRS pilot
      </a>
    </div>
  </section>
</main>

<footer>
  <div class="footer-inner">
    <div>
      OpenProof — RPO Specification v0.1<br />
      © 2026 OpenProof Consortium. Research collaboration: CNRS — GREYC — Université de Caen Normandie —
      Specification editor: Gersende Ryard de Parcey.
    </div>
    <div class="footer-links">
      <a class="footer-link" href="https://openproof.net" target="_blank" rel="noopener noreferrer">Technical site</a>
      <a class="footer-link" href="https://truthx-openproof.org" target="_blank" rel="noopener noreferrer">Governance</a>
      <a class="footer-link" href="mailto:openproof@truthx.co">Contact</a>
    </div>
  </div>
</footer>

<script>
  // --- Simple keyword maps for demo heuristics ---
  const axisKeywords = {
    isolation: [
      "locked me", "locked her", "locked him", "locked in",
      "confined", "no one could leave", "took my keys", "seized my keys"
    ],
    surveillance: [
      "checked my phone", "checked my messages", "monitoring",
      "tracked my location", "installed a camera", "spied", "spying",
      "had to share my location", "tracking app"
    ],
    comms: [
      "took my phone", "took her phone", "took his phone",
      "blocked my number", "blocked me", "deleted my messages",
      "forbade me to call", "forbade me to speak", "no one needed to hear from me"
    ],
    threats: [
      "threatened", "if you don't", "otherwise I will",
      "you will regret", "shouted that he would", "broke my things",
      "punish", "punished", "hit me", "slapped", "pushed me", "violent"
    ],
    economic: [
      "took my card", "took my money", "controlled all the accounts",
      "no access to money", "gave me cash", "stopped paying", "kept my salary"
    ],
    normalisation: [
      "normal for couples", "everyone does that", "you are crazy",
      "you are too sensitive", "it was just a joke", "no one will believe you",
      "overreacting", "imagining things"
    ]
  };

  const riskKeywords = [
    "hit me", "hit her", "hit him", "strangled", "choked", "threatened to kill",
    "threatened to hurt", "threatened the children", "knife", "gun"
  ];

  const evidenceMarkers = [
    "email", "emails", "message", "messages", "sms", "texted",
    "recording", "screenshot", "witness", "witnesses", "police", "report"
  ];

  const sentenceSplitter = /(?<=[.!?])\s+/;

  function analyseStory() {
    const context = document.getElementById("contextSelect").value;
    const story = document.getElementById("storyInput").value.trim();

    if (!story) {
      alert("Please paste or type a short narrative first.");
      return;
    }

    const storyLower = story.toLowerCase();

    // Sentences
    const sentences = story.split(sentenceSplitter).filter(s => s.trim().length > 0);
    const sentenceCount = sentences.length;

    // Evidence markers
    let evidenceCount = 0;
    evidenceMarkers.forEach(k => {
      if (storyLower.includes(k)) evidenceCount++;
    });

    // Axes detection
    const axesState = {
      isolation: false,
      surveillance: false,
      comms: false,
      threats: false,
      economic: false,
      normalisation: false
    };

    Object.entries(axisKeywords).forEach(([axis, keywords]) => {
      axesState[axis] = keywords.some(k => storyLower.includes(k));
    });

    const axesDetected = Object.values(axesState).filter(Boolean).length;

    // Coercion score: simple proportional score + context bonus
    let coercionScore = Math.round((axesDetected / 6) * 80);
    if (context === "intimate" || context === "work") {
      coercionScore += 5;
    }
    if (coercionScore > 100) coercionScore = 100;

    // Risk score
    let riskScore = riskKeywords.some(k => storyLower.includes(k)) ? 70 : 0;
    if (axesState.threats) riskScore = Math.max(riskScore, 40);
    if (context === "intimate" && riskScore > 0) riskScore += 10;
    if (riskScore > 100) riskScore = 100;

    // Update cards
    const coercionScoreEl = document.getElementById("coercionScore");
    const coercionDetailEl = document.getElementById("coercionScoreDetail");
    const riskScoreEl = document.getElementById("riskScore");
    const riskDetailEl = document.getElementById("riskScoreDetail");

    coercionScoreEl.textContent = coercionScore + " / 100";
    riskScoreEl.textContent = riskScore + " / 100";

    if (axesDetected === 0) {
      coercionDetailEl.textContent = "No structural control axis clearly detected in this short narrative.";
    } else if (axesDetected === 1) {
      coercionDetailEl.textContent = "One control axis appears in the narrative. Useful to monitor over time.";
    } else if (axesDetected <= 3) {
      coercionDetailEl.textContent = "Several control axes co-exist. This pattern suggests a possible coercive dynamic.";
    } else {
      coercionDetailEl.textContent = "Multiple axes are active at once. This looks like a dense coercive structure.";
    }

    if (riskScore === 0) {
      riskDetailEl.textContent = "No explicit threat or physical risk appears in the text.";
    } else if (riskScore < 60) {
      riskDetailEl.textContent = "Threats or pressure are narrated. Risk should be assessed in context.";
    } else {
      riskDetailEl.textContent = "Narrative contains explicit danger markers. In real life, urgent support would be required.";
    }

    // Mechanisms summary
    const mechEl = document.getElementById("mechanismsDetected");
    const labels = [];
    if (axesState.isolation) labels.push("isolation / confinement");
    if (axesState.surveillance) labels.push("surveillance & suspicion");
    if (axesState.comms) labels.push("control of communications");
    if (axesState.threats) labels.push("threats & sanctions");
    if (axesState.economic) labels.push("economic / resource control");
    if (axesState.normalisation) labels.push("normalisation & mental pressure");

    if (labels.length === 0) {
      mechEl.innerHTML = "<strong>Mechanisms detected:</strong> none clearly detected in this short text.";
    } else {
      mechEl.innerHTML =
        "<strong>Mechanisms detected:</strong> " + labels.join(", ") + ".";
    }

    // Update matrix cells
    function setAxisCell(id, active) {
      const el = document.getElementById(id);
      el.classList.remove("matrix-level-none", "matrix-level-low", "matrix-level-high");
      if (!active) {
        el.classList.add("matrix-level-none");
        el.textContent = "None so far";
      } else {
        el.classList.add("matrix-level-low");
        el.textContent = "Present in this story";
      }
    }

    setAxisCell("axisIsolation", axesState.isolation);
    setAxisCell("axisSurveillance", axesState.surveillance);
    setAxisCell("axisComms", axesState.comms);
    setAxisCell("axisThreats", axesState.threats);
    setAxisCell("axisEconomic", axesState.economic);
    setAxisCell("axisNormalisation", axesState.normalisation);

    // Signals to monitor
    const signalsEl = document.getElementById("signalsToWatch");
    if (labels.length === 0) {
      signalsEl.innerHTML = "<strong>Signals to monitor:</strong> none highlighted at demo level. The narrative can still be important for a human expert.";
    } else {
      signalsEl.innerHTML =
        "<strong>Signals to monitor:</strong> repetition over time of " +
        labels.join(", ") +
        ", escalation of threats, and attempts to cut the person from external support.";
    }

    // Phenotype summary
    const phenotypeEl = document.getElementById("phenotypeSummary");
    let phenotype = "";

    if (sentenceCount <= 2 && axesDetected === 0) {
      phenotype = "Very short and factual narrative, with limited structure. Needs more details for proper analysis.";
    } else if (axesDetected === 0) {
      phenotype = "Structured narrative without obvious coercive pattern. Can still hide contextual issues.";
    } else if (axesDetected <= 2) {
      phenotype = "Episodic coercive pattern: some control axes appear, but the structure is still relatively loose.";
    } else {
      phenotype = "Dense coercive pattern: several axes interact. The story reads like a systemic control environment.";
    }

    phenotypeEl.innerHTML = "<strong>Narrative phenotype:</strong> " + phenotype;

    // Highlight sensitive spans inside the story
    const highlightBox = document.getElementById("highlightBox");
    const highlightContent = document.getElementById("highlightContent");

    const highlightKeywords = [
      ...axisKeywords.isolation,
      ...axisKeywords.surveillance,
      ...axisKeywords.comms,
      ...axisKeywords.threats,
      ...axisKeywords.economic,
      ...axisKeywords.normalisation
    ];

    let highlightedStory = story;
    highlightKeywords.forEach(keyword => {
      if (!keyword) return;
      const escaped = keyword.replace(/[-/\\^$*+?.()|[\]{}]/g, "\\$&");
      const regex = new RegExp(escaped, "gi");
      highlightedStory = highlightedStory.replace(regex, match =>
        `<span class="highlight-span">${match}</span>`
      );
    });

    highlightContent.innerHTML = highlightedStory;
    highlightBox.scrollTop = 0;
  }

  document.getElementById("analyzeBtn").addEventListener("click", analyseStory);

  document.getElementById("resetBtn").addEventListener("click", () => {
    document.getElementById("storyInput").value = "";
    document.getElementById("contextSelect").value = "generic";
    // Reset visible outputs
    document.getElementById("coercionScore").textContent = "0 / 100";
    document.getElementById("coercionScoreDetail").textContent =
      "No structural control axis clearly detected in this short narrative.";
    document.getElementById("riskScore").textContent = "0 / 100";
    document.getElementById("riskScoreDetail").textContent =
      "No explicit threat in the story.";
    document.getElementById("mechanismsDetected").innerHTML =
      "<strong>Mechanisms detected:</strong> none yet — paste a story on the left and click “Analyse”.";
    ["axisIsolation", "axisSurveillance", "axisComms", "axisThreats", "axisEconomic", "axisNormalisation"]
      .forEach(id => {
        const el = document.getElementById(id);
        el.classList.remove("matrix-level-low", "matrix-level-high");
        el.classList.add("matrix-level-none");
        el.textContent = "None so far";
      });
    document.getElementById("signalsToWatch").innerHTML =
      "<strong>Signals to monitor:</strong> will appear here once a story has been analysed.";
    document.getElementById("phenotypeSummary").innerHTML =
      "<strong>Narrative phenotype:</strong> not assessed yet.";
    document.getElementById("highlightContent").textContent =
      "The analysed narrative will be displayed here, with passages carrying structural pressure highlighted in gold.";
  });

  document.getElementById("loadExampleBtn").addEventListener("click", () => {
    const example = "On Saturday 12 February, around 9 pm, he locked me in the living room for almost two hours after I refused to cancel a dinner with my sister. He stood in front of the door, took my phone and said that \"no one needed to hear from me tonight\". Two days later he demanded full access to my bank account and said that if I refused, he would stop paying the rent. When I tried to complain, he repeated that it was \"normal for couples to share everything\" and that I was overreacting.";
    document.getElementById("contextSelect").value = "intimate";
    document.getElementById("storyInput").value = example;
    analyseStory();
  });
</script>
</body>
</html>


