<!DOCTYPE html>
<html lang="en" data-page="legal-demo">
<head>
  <meta charset="UTF-8" />
  <title>OpenProof — Legal demo | From raw story to legal framing</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- SEO -->
  <meta name="description"
        content="Legal demo layer on top of the RPO standard. Paste a short narrative and see structural legal signals, coercion score, risk hints and highlighted sensitive passages. Runs locally, deterministic, no AI." />
  <link rel="canonical" href="https://rpo.openproof.net/demo-legal.html" />

  <!-- Open Graph -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="OpenProof — Legal narrative demo" />
  <meta property="og:description"
        content="From raw story to legal framing: a rule-based legal layer on top of the RPO standard. Coercion score, legal risk hints and narrative profile (demo)." />
  <meta property="og:url" content="https://rpo.openproof.net/demo-legal.html" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;600&family=Inter:wght@300;400;500;600&display=swap"
        rel="stylesheet" />

  <style>
    :root {
      --bg: #04040e;
      --bg-elevated: #0b0f14;
      --panel: #f9f1df;
      --panel-soft: #f4ebd7;
      --panel-border: #e0cfaa;
      --accent-gold: #d4af37;
      --accent-gold-soft: #f1e6a3;
      --accent-red: #d65b5b;
      --accent-green: #4aa66a;
      --accent-amber: #e0a63a;
      --text-main: #f7f3e8;
      --text-muted: #c3c6d3;
      --text-dark: #3a3120;
      --chip-bg: rgba(212, 175, 55, 0.12);
      --chip-border: rgba(212, 175, 55, 0.45);
      --radius-large: 24px;
      --radius-chip: 999px;
      --shadow-soft: 0 22px 60px rgba(0, 0, 0, 0.55);
      --shadow-panel: 0 14px 40px rgba(0, 0, 0, 0.35);
      --font-ui: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      --font-orbitron: "Orbitron", system-ui, sans-serif;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: var(--font-ui);
      background: radial-gradient(circle at top left, #111525 0, #04040e 55%, #020308 100%);
      color: var(--text-main);
      -webkit-font-smoothing: antialiased;
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    main {
      max-width: 1200px;
      margin: 0 auto;
      padding: 24px 20px 80px;
    }

    /* Top nav */

    .top-nav {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 16px;
      border-radius: 999px;
      border: 1px solid rgba(212, 175, 55, 0.4);
      background: linear-gradient(
          135deg,
          rgba(241, 230, 163, 0.06),
          rgba(4, 4, 14, 0.95)
        );
      box-shadow: 0 18px 45px rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(20px);
      position: sticky;
      top: 12px;
      z-index: 20;
    }

    .brand-block {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .brand-logo {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 20%, #fdf7df, #d4af37 45%, #4a3b10 100%);
      border: 1px solid rgba(255, 255, 255, 0.4);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.65);
      font-family: var(--font-orbitron);
      font-size: 11px;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: #1b1404;
    }

    .brand-text {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .brand-title {
      font-family: var(--font-orbitron);
      font-size: 13px;
      letter-spacing: 0.18em;
      text-transform: uppercase;
    }

    .brand-subtitle {
      font-size: 11px;
      color: var(--text-muted);
    }

    .nav-links {
      display: flex;
      align-items: center;
      gap: 18px;
      font-size: 13px;
      color: var(--text-muted);
    }

    .nav-link {
      padding: 6px 10px;
      border-radius: 999px;
      transition: background 0.2s ease, color 0.2s ease;
    }

    .nav-link:hover {
      color: var(--text-main);
      background: rgba(241, 230, 163, 0.1);
    }

    .nav-link.current {
      color: #111015;
      background: linear-gradient(135deg, #f1e6a3, #d4af37);
      box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.6);
    }

    .nav-cta {
      padding: 8px 14px;
      border-radius: 999px;
      font-size: 13px;
      border: 1px solid rgba(241, 230, 163, 0.7);
      background: radial-gradient(circle at top left, #f1e6a3, #d4af37);
      color: #141018;
      font-weight: 500;
      box-shadow: 0 10px 26px rgba(0, 0, 0, 0.7);
    }

    /* Hero */

    .hero {
      display: grid;
      grid-template-columns: minmax(0, 3.2fr) minmax(0, 2.3fr);
      gap: 32px;
      margin-top: 32px;
      margin-bottom: 40px;
    }

    .hero h1 {
      font-family: var(--font-orbitron);
      font-size: clamp(30px, 3.4vw, 40px);
      line-height: 1.08;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      margin: 0 0 16px;
    }

    .hero-highlight {
      color: var(--accent-gold-soft);
    }

    .hero-subtitle {
      font-size: 15px;
      color: var(--text-muted);
      max-width: 560px;
      line-height: 1.6;
    }

    .hero-badges {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 18px;
      margin-bottom: 14px;
    }

    .chip {
      border-radius: var(--radius-chip);
      border: 1px solid var(--chip-border);
      background: var(--chip-bg);
      padding: 5px 12px;
      font-size: 11px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--accent-gold-soft);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .chip-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--accent-gold-soft);
    }

    .hero-note {
      margin-top: 10px;
      font-size: 12px;
      color: var(--text-muted);
      max-width: 600px;
    }

    .hero-note strong {
      color: var(--accent-gold-soft);
      font-weight: 500;
    }

    .hero-panel {
      background: radial-gradient(circle at top, #111522 0, #04040e 60%);
      border-radius: var(--radius-large);
      border: 1px solid rgba(241, 230, 163, 0.16);
      padding: 18px 20px 20px;
      box-shadow: var(--shadow-soft);
      position: relative;
    }

    .hero-panel::before {
      content: "DEMO MODE";
      position: absolute;
      top: 14px;
      right: 16px;
      font-size: 10px;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      border-radius: 999px;
      padding: 4px 10px;
      border: 1px solid rgba(241, 230, 163, 0.6);
      background: linear-gradient(
        135deg,
        rgba(241, 230, 163, 0.18),
        rgba(4, 4, 14, 0.75)
      );
      color: var(--accent-gold-soft);
    }

    .hero-panel-title {
      font-family: var(--font-orbitron);
      font-size: 15px;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      margin-bottom: 14px;
    }

    .hero-panel ul {
      margin: 0;
      padding-left: 18px;
      font-size: 13px;
      line-height: 1.6;
      color: var(--text-muted);
    }

    .hero-panel li + li {
      margin-top: 6px;
    }

    .hero-panel-footer {
      margin-top: 12px;
      font-size: 11px;
      color: var(--text-muted);
    }

    .hero-panel-footer strong {
      color: var(--accent-gold-soft);
    }

    /* Main demo section */

    .section-label {
      margin-top: 18px;
      margin-bottom: 10px;
      font-size: 12px;
      letter-spacing: 0.24em;
      text-transform: uppercase;
      color: var(--text-muted);
    }

    .demo-grid {
      display: grid;
      grid-template-columns: minmax(0, 1.05fr) minmax(0, 1.2fr);
      gap: 28px;
      align-items: flex-start;
    }

    .panel {
      background: linear-gradient(180deg, var(--panel) 0, #f7f0df 65%, #f3ebd9 100%);
      border-radius: var(--radius-large);
      border: 1px solid var(--panel-border);
      box-shadow: var(--shadow-panel);
      padding: 20px 22px 20px;
      color: var(--text-dark);
      position: relative;
    }

    .panel h2 {
      font-family: var(--font-orbitron);
      font-size: 14px;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      margin: 0 0 10px;
    }

    .panel p {
      margin: 0 0 8px;
      font-size: 13px;
      line-height: 1.5;
    }

    .field-label {
      margin-top: 10px;
      font-size: 12px;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: #7b6a3a;
    }

    select,
    textarea {
      width: 100%;
      margin-top: 6px;
      border-radius: 12px;
      border: 1px solid #e2d3b3;
      font-family: var(--font-ui);
      font-size: 13px;
      padding: 8px 10px;
      background: rgba(255, 255, 255, 0.85);
      color: #30230f;
      outline: none;
    }

    select:focus,
    textarea:focus {
      border-color: var(--accent-gold);
      box-shadow: 0 0 0 1px rgba(212, 175, 55, 0.35);
    }

    textarea {
      min-height: 180px;
      resize: vertical;
      line-height: 1.4;
    }

    .helper-text {
      margin-top: 6px;
      font-size: 11px;
      color: #8b7c54;
    }

    .button-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 14px;
    }

    .btn-primary,
    .btn-secondary,
    .btn-ghost {
      border-radius: 999px;
      font-size: 13px;
      padding: 8px 14px;
      border: none;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-weight: 500;
      transition: transform 0.08s ease, box-shadow 0.08s ease, background 0.15s ease;
    }

    .btn-primary {
      background: radial-gradient(circle at top left, #f1e6a3, #d4af37);
      color: #181213;
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.4);
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 16px 36px rgba(0, 0, 0, 0.55);
    }

    .btn-secondary {
      background: #f7f1e3;
      color: #3a3120;
      border: 1px solid #e0cfaa;
    }

    .btn-secondary:hover {
      background: #f0e5cf;
    }

    .btn-ghost {
      background: transparent;
      color: #3a3120;
      border: 1px dashed #d9c7a0;
    }

    .btn-ghost:hover {
      background: #f6eddd;
    }

    .btn-icon {
      font-size: 14px;
    }

    /* Legal overlay panel */

    .score-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px;
      margin-bottom: 12px;
    }

    .score-card {
      border-radius: 18px;
      border: 1px solid #e3d2ab;
      background: radial-gradient(circle at top, #fffdf5 0, #f3ebd9 60%, #efe1c8 100%);
      padding: 10px 12px 10px;
    }

    .score-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: #8a7744;
      margin-bottom: 4px;
    }

    .score-value-row {
      display: flex;
      align-items: baseline;
      gap: 4px;
      margin-bottom: 4px;
    }

    .score-number {
      font-size: 22px;
      font-weight: 600;
      color: #3a3120;
    }

    .score-max {
      font-size: 12px;
      color: #8a7a53;
    }

    .score-comment {
      font-size: 12px;
      line-height: 1.4;
    }

    .score-comment strong {
      font-weight: 600;
    }

    .score-comment.coercion {
      color: #8a4b2f;
    }

    .score-comment.risk-low {
      color: #497b4f;
    }

    .score-comment.risk-medium {
      color: #a36e1b;
    }

    .score-comment.risk-high {
      color: #a2322c;
    }

    .section-subtitle {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      margin-top: 10px;
      margin-bottom: 4px;
      color: #8f7b4a;
    }

    .legal-list {
      margin: 0;
      padding-left: 18px;
      font-size: 13px;
      line-height: 1.5;
    }

    .legal-list li + li {
      margin-top: 3px;
    }

    .matrix {
      margin-top: 8px;
      border-radius: 16px;
      overflow: hidden;
      border: 1px solid #e1d0ac;
      background: #faf1df;
    }

    .matrix-row {
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 0.9fr);
      font-size: 13px;
      padding: 8px 10px;
      align-items: center;
    }

    .matrix-row:nth-child(odd) {
      background: #f7edd7;
    }

    .matrix-row-header {
      background: #efe0c0;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      font-weight: 600;
      color: #7b6235;
    }

    .matrix-axis {
      color: #3a3120;
    }

    .matrix-level {
      justify-self: flex-end;
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid #ddc898;
      background: #fdf7ea;
      font-weight: 500;
    }

    .matrix-level-none {
      color: #77705b;
      background: #f7efe1;
    }

    .matrix-level-present {
      color: #8a5c23;
      background: #fff3d8;
    }

    .matrix-level-strong {
      color: #8a2424;
      background: #ffe5de;
      border-color: #e0a0a0;
    }

    .signals-list {
      margin: 0;
      padding-left: 18px;
      font-size: 13px;
    }

    /* Highlighted story */

    .highlight-box {
      margin-top: 8px;
      border-radius: 18px;
      border: 1px dashed #e0cfaa;
      background: #fbf4e6;
      padding: 10px 12px;
      font-size: 13px;
      line-height: 1.5;
      max-height: 220px;
      overflow: auto;
    }

    .legal-highlight {
      background: #ffedc2;
      box-shadow: 0 0 0 1px rgba(212, 175, 55, 0.45);
      border-radius: 4px;
      padding: 0 2px;
    }

    /* Footer */

    footer {
      margin-top: 40px;
      padding-top: 16px;
      border-top: 1px solid rgba(241, 230, 163, 0.2);
      font-size: 12px;
      color: var(--text-muted);
    }

    .footer-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      justify-content: space-between;
    }

    .footer-links {
      display: flex;
      gap: 16px;
      font-size: 12px;
    }

    .footer-links a {
      color: var(--text-muted);
    }

    .footer-links a:hover {
      color: var(--accent-gold-soft);
    }

    @media (max-width: 960px) {
      .top-nav {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }

      .nav-links {
        flex-wrap: wrap;
        justify-content: flex-start;
      }

      .hero {
        grid-template-columns: minmax(0, 1fr);
      }

      .demo-grid {
        grid-template-columns: minmax(0, 1fr);
      }

      main {
        padding: 20px 16px 64px;
      }
    }
  </style>
</head>

<body>
  <main>
    <!-- NAV -->
    <header class="top-nav">
      <div class="brand-block">
        <div class="brand-logo">RPO</div>
        <div class="brand-text">
          <div class="brand-title">OPENPROOF — RPO V0.1</div>
          <div class="brand-subtitle">Signed JSON • Human-readable PDF • Public hash</div>
        </div>
      </div>
      <nav class="nav-links">
        <a class="nav-link" href="overview.html">Overview</a>
        <a class="nav-link" href="spec.html">Specification</a>
        <a class="nav-link" href="examples.html">Examples</a>
        <a class="nav-link" href="tests.html">Tests</a>
        <a class="nav-link" href="playground.html">Playground</a>
        <a class="nav-link" href="demo-psycho.html">Psycho-forensic demo</a>
        <span class="nav-link current">Legal demo</span>
        <a class="nav-cta" href="https://github.com" target="_blank" rel="noopener noreferrer">
          View on GitHub
        </a>
      </nav>
    </header>

    <!-- HERO -->
    <section class="hero">
      <div>
        <p class="section-label">RPO DEMONSTRATION LAYER · LEGAL FRAMING</p>
        <h1>
          Try the <span class="hero-highlight">legal demo</span><br />
          — from raw story to<br />
          legal framing
        </h1>
        <p class="hero-subtitle">
          Paste a short narrative about a potential harmful or coercive situation
          (domestic, workplace, institutional or online). This demo highlights
          structural legal signals, estimates a conservative coercion score, and
          surfaces a possible legal framing. Everything runs locally in your
          browser, with no AI model.
        </p>
        <div class="hero-badges">
          <div class="chip">
            <span class="chip-dot"></span>BASED ON MODELS
          </div>
          <div class="chip">
            <span class="chip-dot"></span>NO AI, DETERMINISTIC
          </div>
          <div class="chip">
            <span class="chip-dot"></span>LEGAL SIGNAL FOCUS
          </div>
          <div class="chip">
            <span class="chip-dot"></span>RPO-COMPATIBLE NARRATIVE LAYER
          </div>
        </div>
        <p class="hero-note">
          <strong>This is not a legal opinion.</strong> It does not decide who is
          right or wrong. It simply surfaces narrative structures that
          <em>could</em> be compatible with specific legal frames, to support
          professional assessment.
        </p>
      </div>

      <aside class="hero-panel">
        <div class="hero-panel-title">What this demo illustrates</div>
        <ul>
          <li>
            Detection of structural legal mechanisms (deprivation of liberty,
            threats, coercion, economic pressure, harassment).
          </li>
          <li>
            Aggregation into a mini-matrix of legal control axes.
          </li>
          <li>
            Approximate coercion score and narrative legal risk level for the
            story.
          </li>
          <li>
            Highlighting of legally sensitive passages and a resulting
            narrative/legal profile.
          </li>
        </ul>
        <p class="hero-panel-footer">
          In the scientific CNRS × TruthX pilot, this layer is powered by
          advanced psycho-forensic and legal modules able to ingest message
          streams, reports and transcripts. Here you see a simplified and
          transparent decoder that already reveals structural legal patterns on
          top of the RPO “civil code”.
        </p>
      </aside>
    </section>

    <!-- DEMO -->
    <section>
      <p class="section-label">PLAY WITH A NARRATIVE</p>
      <div class="demo-grid">
        <!-- LEFT: INPUT -->
        <div class="panel">
          <h2>1. Narrative input</h2>
          <p>
            Write a short narrative (1 to 3 paragraphs). Names can be anonymised.
            The goal is to reveal structural legal signals, not to judge the case.
          </p>

          <label class="field-label" for="contextSelect">Context</label>
          <select id="contextSelect">
            <option value="unspecified">Unspecified / generic</option>
            <option value="intimate">Intimate / domestic</option>
            <option value="work">Workplace / management</option>
            <option value="institutional">Institutional / administrative</option>
            <option value="online">Online / digital</option>
          </select>

          <label class="field-label" for="narrativeInput">Story (free text)</label>
          <textarea id="narrativeInput" placeholder="Describe what happened, in your own words. Who did what, when, where, and how did it affect you or others?"></textarea>
          <p class="helper-text">
            Tip: include at least one concrete action, time marker and all threats,
            justifications or constraints you remember.
          </p>

          <div class="button-row">
            <button id="analyzeBtn" class="btn-primary">
              <span class="btn-icon">▶</span> Analyse story
            </button>
            <button id="resetBtn" class="btn-secondary">Reset</button>
            <button id="exampleBtn" class="btn-ghost">Load example</button>
          </div>
        </div>

        <!-- RIGHT: LEGAL OVERLAY -->
        <div class="panel">
          <h2>2. Legal overlay (demo layer)</h2>
          <p>
            The demo analyses the text on the left and surfaces structural legal
            signals using a conservative rule-based model. Scores are
            <strong>approximate</strong> and only indicate converging signals
            within this story.
          </p>

          <div class="score-grid">
            <div class="score-card">
              <div class="score-label">Coercion score (approx.)</div>
              <div class="score-value-row">
                <div id="coercionScore" class="score-number">0</div>
                <div class="score-max">/100</div>
              </div>
              <div id="coercionComment" class="score-comment coercion">
                No significant legal control structure detected yet.
              </div>
            </div>
            <div class="score-card">
              <div class="score-label">Immediate risk (narrative)</div>
              <div class="score-value-row">
                <div id="riskScore" class="score-number">0</div>
                <div class="score-max">/100</div>
              </div>
              <div id="riskComment" class="score-comment risk-low">
                No explicit threat or acute risk signal appears in the text yet.
              </div>
            </div>
          </div>

          <div class="section-subtitle">Detected mechanisms (demo)</div>
          <p id="mechanismsSummary">
            No legal mechanism detected yet. Paste a story and click
            “Analyse”.
          </p>

          <div class="section-subtitle">Potential legal framing (non-binding)</div>
          <ul id="legalFramesList" class="legal-list">
            <li>No potential legal frame detected yet.</li>
          </ul>

          <div class="section-subtitle">Legal control matrix</div>
          <div class="matrix" aria-label="Legal control matrix">
            <div class="matrix-row matrix-row-header">
              <div>Legal control axis</div>
              <div style="text-align:right;">Demo level</div>
            </div>
            <div class="matrix-row">
              <div class="matrix-axis">
                Deprivation of liberty / confinement
              </div>
              <div id="axisLiberty" class="matrix-level matrix-level-none">
                None so far
              </div>
            </div>
            <div class="matrix-row">
              <div class="matrix-axis">Threats &amp; coercion</div>
              <div id="axisThreats" class="matrix-level matrix-level-none">
                None so far
              </div>
            </div>
            <div class="matrix-row">
              <div class="matrix-axis">Control of communications</div>
              <div id="axisComms" class="matrix-level matrix-level-none">
                None so far
              </div>
            </div>
            <div class="matrix-row">
              <div class="matrix-axis">Economic / resource control</div>
              <div id="axisEconomic" class="matrix-level matrix-level-none">
                None so far
              </div>
            </div>
            <div class="matrix-row">
              <div class="matrix-axis">Harassment / humiliation</div>
              <div id="axisHarassment" class="matrix-level matrix-level-none">
                None so far
              </div>
            </div>
            <div class="matrix-row">
              <div class="matrix-axis">Privacy / surveillance</div>
              <div id="axisPrivacy" class="matrix-level matrix-level-none">
                None so far
              </div>
            </div>
          </div>

          <div class="section-subtitle">Signals to monitor</div>
          <ul id="signalsList" class="signals-list">
            <li>No weak axis to monitor yet.</li>
          </ul>

          <div class="section-subtitle">Narrative / legal profile</div>
          <p id="phenotypeText">
            The narrative profile will appear here after analysis.
          </p>

          <div class="section-subtitle">Story with legally sensitive passages highlighted</div>
          <div id="highlightBox" class="highlight-box">
            Paste a narrative and run the analysis. Legally sensitive passages will
            be highlighted here.
          </div>

          <p class="helper-text" style="margin-top:10px;">
            This heuristic logic is intentionally conservative and demonstrative.
            It simply makes possible legal control patterns visible from the
            provided text. It does <strong>not</strong> replace legal advice,
            investigation or protective assessment.
          </p>
        </div>
      </div>
    </section>

    <!-- FOOTER -->
    <footer>
      <div class="footer-row">
        <div>
          OpenProof — RPO Specification v0.1<br />
          © 2026 Consortium OpenProof. Research collaboration: CNRS – GREYC –
          Université de Caen Normandie — Specification editor: Gersende Ryard de
          Parcey.
        </div>
        <div class="footer-links">
          <a href="index.html">Technical site</a>
          <a href="governance.html">Governance</a>
          <a href="contact.html">Contact</a>
        </div>
      </div>
    </footer>
  </main>

  <script>
    // --- Heuristic legal model (demo only, no AI) ---------------------------

    const LEGAL_AXES = {
      liberty: {
        id: "axisLiberty",
        label: "Deprivation of liberty / confinement",
        cues: [
          "locked me in",
          "locked the door",
          "blocked the door",
          "would not let me leave",
          "kept me in",
          "confined me",
          "took my keys",
          "took the keys",
          "took the car keys"
        ]
      },
      threats: {
        id: "axisThreats",
        label: "Threats & coercion",
        cues: [
          "threatened to",
          "if you don't",
          "if you do not",
          "or else",
          "no one needed to hear from me",
          "i will make you pay",
          "you will regret",
          "stop paying the rent",
          "take the children",
          "take the kids",
          "kick me out",
          "kick you out"
        ]
      },
      comms: {
        id: "axisComms",
        label: "Control of communications",
        cues: [
          "took my phone",
          "took my laptop",
          "checked my messages",
          "checked my phone",
          "read my messages",
          "no one needed to hear from me",
          "didn't leave my phone charging",
          "blocked my contacts",
          "cut me off from",
          "no contact with"
        ]
      },
      economic: {
        id: "axisEconomic",
        label: "Economic / resource control",
        cues: [
          "access to my bank account",
          "all my bank notifications",
          "controlled my spending",
          "controlled every expense",
          "stopped paying the rent",
          "stopped paying rent",
          "took my salary",
          "took my money",
          "took my card",
          "withheld money",
          "kept my documents"
        ]
      },
      harassment: {
        id: "axisHarassment",
        label: "Harassment / humiliation",
        cues: [
          "accusing me of",
          "called me crazy",
          "said that i was overreacting",
          "said i was overreacting",
          "insulted me",
          "humiliated me",
          "yelled at me",
          "shouted at me",
          "called me names",
          "said it was normal for couples"
        ]
      },
      privacy: {
        id: "axisPrivacy",
        label: "Privacy / surveillance",
        cues: [
          "checked my phone",
          "checked my messages",
          "monitored my messages",
          "surveillance",
          "installed a camera",
          "spied on me",
          "tracking app",
          "location tracking"
        ]
      }
    };

    const HIGH_RISK_KEYWORDS = [
      "kill",
      "hurt you",
      "hurt me",
      "beat you",
      "beat me",
      "i will hit",
      "i will kill",
      "i'll kill",
      "no one needed to hear from me",
      "locked me in",
      "take the children",
      "take the kids"
    ];

    const narrativeInputEl = document.getElementById("narrativeInput");
    const contextSelectEl = document.getElementById("contextSelect");

    const coercionScoreEl = document.getElementById("coercionScore");
    const coercionCommentEl = document.getElementById("coercionComment");
    const riskScoreEl = document.getElementById("riskScore");
    const riskCommentEl = document.getElementById("riskComment");

    const mechanismsSummaryEl = document.getElementById("mechanismsSummary");
    const legalFramesListEl = document.getElementById("legalFramesList");
    const signalsListEl = document.getElementById("signalsList");
    const phenotypeTextEl = document.getElementById("phenotypeText");
    const highlightBoxEl = document.getElementById("highlightBox");

    document.getElementById("analyzeBtn").addEventListener("click", analyzeStory);
    document.getElementById("resetBtn").addEventListener("click", resetForm);
    document.getElementById("exampleBtn").addEventListener("click", loadExample);

    function analyzeStory() {
      const text = narrativeInputEl.value.trim();
      if (!text) {
        alert("Please paste or write a short narrative first.");
        return;
      }

      const lower = text.toLowerCase();
      const axisResults = {};
      let totalCues = 0;
      let axesWithSignals = 0;

      for (const [key, axis] of Object.entries(LEGAL_AXES)) {
        const count = countCues(lower, axis.cues);
        axisResults[key] = count;
        totalCues += count;
        if (count > 0) axesWithSignals++;
        updateAxisBadge(axis.id, count);
      }

      // Coercion score: function of total cues + number of axes
      let coercionScore = Math.min(100, axesWithSignals * 12 + totalCues * 8);
      if (coercionScore < 5) coercionScore = 0;

      // Immediate risk: look for strong keywords + threats axis weight
      const highRiskHits = countCues(lower, HIGH_RISK_KEYWORDS);
      let riskScore = 0;
      if (highRiskHits > 0) {
        riskScore = 80;
      } else if (axisResults.threats >= 2 || axisResults.liberty >= 2) {
        riskScore = 60;
      } else if (axisResults.threats === 1 || axisResults.liberty === 1) {
        riskScore = 40;
      }

      // Update score visuals
      coercionScoreEl.textContent = coercionScore;
      riskScoreEl.textContent = riskScore;

      if (coercionScore === 0) {
        coercionCommentEl.textContent =
          "No significant legal control structure detected so far.";
      } else if (coercionScore <= 40) {
        coercionCommentEl.textContent =
          "Several legal signals appear, but the structure still looks limited or emerging.";
      } else if (coercionScore <= 70) {
        coercionCommentEl.textContent =
          "Multiple legal control axes co-exist. This pattern suggests a possible coercive environment.";
      } else {
        coercionCommentEl.textContent =
          "Strong convergence of legal control axes. This narrative may correspond to a dense coercive environment.";
      }

      if (riskScore === 0) {
        riskCommentEl.textContent =
          "No explicit threat or acute risk signal appears in the text yet.";
        riskCommentEl.className = "score-comment risk-low";
      } else if (riskScore <= 50) {
        riskCommentEl.textContent =
          "Risk signals appear in the story (threats, pressure, escalation). This calls for careful attention.";
        riskCommentEl.className = "score-comment risk-medium";
      } else {
        riskCommentEl.textContent =
          "Acute risk signals appear in this story (threats, confinement, sanctions). This calls for immediate vigilance.";
        riskCommentEl.className = "score-comment risk-high";
      }

      // Mechanisms summary
      const presentAxes = Object.entries(axisResults)
        .filter(([, count]) => count > 0)
        .map(([key, count]) => {
          const axis = LEGAL_AXES[key];
          const word = count === 1 ? "cue" : "cues";
          return `${axis.label} · ${count} lexical ${word}`;
        });

      if (presentAxes.length === 0) {
        mechanismsSummaryEl.textContent =
          "No legal mechanism detected so far at this level of conservatism.";
      } else {
        mechanismsSummaryEl.textContent =
          "Mechanisms detected: " + presentAxes.join("; ") + ".";
      }

      // Potential legal frames (very high-level, non-binding)
      updateLegalFrames(axisResults, coercionScore, riskScore);

      // Signals to monitor: axes with exactly one cue
      const monitorAxes = Object.entries(axisResults)
        .filter(([, count]) => count === 1)
        .map(([key]) => LEGAL_AXES[key].label);

      updateSignalsToMonitor(monitorAxes);

      // Narrative phenotype / profile
      updatePhenotype(axisResults, coercionScore, riskScore);

      // Highlight story
      const allCues = Array.from(
        new Set(
          Object.values(LEGAL_AXES)
            .map((axis) => axis.cues)
            .flat()
        )
      );
      const highlighted = highlightCues(text, allCues);
      highlightBoxEl.innerHTML = highlighted;
    }

    function resetForm() {
      narrativeInputEl.value = "";
      contextSelectEl.value = "unspecified";
      coercionScoreEl.textContent = "0";
      riskScoreEl.textContent = "0";
      coercionCommentEl.textContent =
        "No significant legal control structure detected yet.";
      riskCommentEl.textContent =
        "No explicit threat or acute risk signal appears in the text yet.";
      mechanismsSummaryEl.textContent =
        "No legal mechanism detected yet. Paste a story and click “Analyse”.";
      legalFramesListEl.innerHTML =
        "<li>No potential legal frame detected yet.</li>";
      signalsListEl.innerHTML = "<li>No weak axis to monitor yet.</li>";
      phenotypeTextEl.textContent =
        "The narrative profile will appear here after analysis.";
      highlightBoxEl.textContent =
        "Paste a narrative and run the analysis. Legally sensitive passages will be highlighted here.";

      for (const axis of Object.values(LEGAL_AXES)) {
        updateAxisBadge(axis.id, 0);
      }
    }

    function loadExample() {
      const example =
        "On Saturday 12 February, around 9 pm, he locked me in the living room for almost two hours after I refused to cancel a dinner with my sister. He stood in front of the door, took my phone and said that \"no one needed to hear from me tonight\". Two days later, on Monday, he woke me up at 5:30 am accusing me of hiding conversations from him because I didn't leave my phone charging in the kitchen as he demanded. Last week, he also threatened to take the car keys if I didn't give him all my bank notifications, saying it was \"normal for couples\" to share everything and that I was overreacting.";
      narrativeInputEl.value = example;
      contextSelectEl.value = "intimate";
      analyzeStory();
    }

    function countCues(lowerText, cues) {
      let count = 0;
      for (const cue of cues) {
        const pattern = escapeRegExp(cue.toLowerCase());
        const regex = new RegExp(pattern, "g");
        const matches = lowerText.match(regex);
        if (matches) count += matches.length;
      }
      return count;
    }

    function updateAxisBadge(elementId, count) {
      const el = document.getElementById(elementId);
      if (!el) return;

      let label = "None so far";
      let cls = "matrix-level matrix-level-none";

      if (count === 1) {
        label = "Present, 1 cue";
        cls = "matrix-level matrix-level-present";
      } else if (count > 1) {
        label = `Strong, ${count} cues`;
        cls = "matrix-level matrix-level-strong";
      }

      el.textContent = label;
      el.className = cls;
    }

    function updateLegalFrames(axisResults, coercionScore, riskScore) {
      const frames = [];

      if (axisResults.liberty > 0 && axisResults.threats > 0) {
        frames.push(
          "Possible pattern of coercive control combining deprivation of liberty and threats."
        );
      }
      if (axisResults.harassment > 0 && axisResults.threats > 0) {
        frames.push(
          "Signals compatible with harassment and repeated intimidation."
        );
      }
      if (axisResults.economic > 0 && axisResults.liberty + axisResults.threats > 0) {
        frames.push(
          "Combined economic/resource control with freedom-restricting behaviours."
        );
      }
      if (axisResults.privacy > 0 && axisResults.comms > 0) {
        frames.push(
          "Interference with privacy and communications that may require legal attention."
        );
      }

      if (coercionScore >= 70 && frames.length === 0) {
        frames.push(
          "Dense concentration of legal control signals. This story may justify a full legal qualification check."
        );
      }

      if (frames.length === 0) {
        frames.push(
          "At this level of conservatism, the demo does not suggest a specific legal frame. A professional can still review the narrative in context."
        );
      }

      legalFramesListEl.innerHTML = "";
      for (const f of frames) {
        const li = document.createElement("li");
        li.textContent = f;
        legalFramesListEl.appendChild(li);
      }
    }

    function updateSignalsToMonitor(monitorAxes) {
      if (!monitorAxes.length) {
        signalsListEl.innerHTML = "<li>No weak axis to monitor yet.</li>";
        return;
      }
      signalsListEl.innerHTML = "";
      monitorAxes.forEach((label) => {
        const li = document.createElement("li");
        li.textContent = label;
        signalsListEl.appendChild(li);
      });
    }

    function updatePhenotype(axisResults, coercionScore, riskScore) {
      const strongAxes = Object.entries(axisResults)
        .filter(([, count]) => count > 1)
        .map(([key]) => LEGAL_AXES[key].label);

      const context = contextSelectEl.value;
      const contextLabel =
        context === "intimate"
          ? "intimate partner setting"
          : context === "work"
          ? "workplace context"
          : context === "institutional"
          ? "institutional / administrative context"
          : context === "online"
          ? "online or digital environment"
          : "unspecified context";

      if (coercionScore === 0 && strongAxes.length === 0) {
        phenotypeTextEl.textContent =
          "At this heuristic level, the narrative does not display a clear pattern of legal control. A professional could still explore the situation in its full factual context.";
        return;
      }

      let sentence =
        "The narrative currently reads like a structured pattern of legal control";

      if (strongAxes.length) {
        sentence +=
          " where the following axes appear strongly: " +
          strongAxes.join(", ") +
          ".";
      } else {
        sentence +=
          ", with several axes showing early signals but limited repetition so far.";
      }

      sentence +=
        " In this " +
        contextLabel +
        ", a full legal evaluation could justify cross-checking these signals with other evidence and applicable law.";

      if (riskScore >= 60) {
        sentence +=
          " The presence of acute risk indicators suggests that the situation should be reviewed with priority.";
      }

      phenotypeTextEl.textContent = sentence;
    }

    function escapeRegExp(str) {
      return str.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
    }

    function escapeHtml(str) {
      return str
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#39;");
    }

    function highlightCues(originalText, cues) {
      let html = escapeHtml(originalText);
      cues.forEach((cue) => {
        const pattern = escapeRegExp(cue);
        const regex = new RegExp(pattern, "gi");
        html = html.replace(
          regex,
          (match) => `<span class="legal-highlight">${match}</span>`
        );
      });
      return html;
    }
  </script>
</body>
</html>
