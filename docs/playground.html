<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>OpenProof – RPO Playground | Du récit au lot RPO</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- SEO -->
  <meta
    name="description"
    content="RPO Playground : essayez la version ouverte du RPO (Rapport Probatoire Ouvert). Collez un récit, générez un lot JSON RPO préliminaire, des scores heuristiques et un hachage public."
  />
  <link rel="canonical" href="https://rpo.openproof.net/playground.html" />

  <!-- Open Graph -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="OpenProof – RPO Playground" />
  <meta
    property="og:description"
    content="Terrain d’essai expérimental pour la norme RPO : du récit libre au lot JSON signé, avec scores heuristiques et hachage public."
  />
  <meta property="og:url" content="https://rpo.openproof.net/playground.html" />
  <meta
    property="og:image"
    content="https://uploads.strikinglycdn.com/files/5b108f2f-0feb-4789-a4dd-d1d21cd5eec6/Capture%20d%E2%80%99e%CC%81cran%202025-11-01%20a%CC%80%2016.30.35.png"
  />

  <!-- Favicon OpenProof -->
  <link
    rel="icon"
    type="image/png"
    href="https://uploads.strikinglycdn.com/files/5b108f2f-0feb-4789-a4dd-d1d21cd5eec6/Capture%20d%E2%80%99e%CC%81cran%202025-11-01%20a%CC%80%2016.30.35.png"
  />

  <!-- Fonts: Orbitron + Inter -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Orbitron:wght@500;600&display=swap"
    rel="stylesheet"
  />

  <!-- Dark / ivory / gold theme -->
  <style>
    :root {
      --bg: #04040e;
      --bg-elevated: #0b0f14;
      --panel: #f7f3e8;
      --panel-soft: #fbf8f1;
      --text-main: #f5f5f7;
      --text-muted: #b2b7c5;
      --ink: #7a6432;
      --gold: #d4af37;
      --gold-soft: #f1e6a3;
      --border-soft: rgba(241, 230, 163, 0.2);
      --shadow-soft: 0 18px 45px rgba(0, 0, 0, 0.45);
      --radius-lg: 18px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: "Inter", -apple-system, BlinkMacSystemFont, system-ui,
        "SF Pro Text", "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #111625 0, var(--bg) 45%);
      color: var(--text-main);
      -webkit-font-smoothing: antialiased;
    }

    a {
      color: var(--gold-soft);
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }

    /* NAVBAR */
    .nav {
      position: sticky;
      top: 0;
      z-index: 20;
      backdrop-filter: blur(16px);
      background: linear-gradient(
        90deg,
        rgba(4, 4, 14, 0.96),
        rgba(4, 4, 14, 0.92)
      );
      border-bottom: 1px solid var(--border-soft);
    }

    .nav-inner {
      max-width: 1120px;
      margin: 0 auto;
      padding: 0.65rem 1.5rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
    }

    .nav-left {
      display: flex;
      align-items: center;
    }

    .nav-logo-link {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      text-decoration: none;
      color: var(--text-main);
    }

    .nav-logo {
      width: 40px;
      height: 40px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #f3e8b2, #b88c2a);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.4),
        0 10px 25px rgba(0, 0, 0, 0.6);
    }

    .nav-logo img {
      width: 28px;
      height: 28px;
      border-radius: 999px;
      display: block;
    }

    .nav-title {
      font-family: "Orbitron", system-ui, sans-serif;
      font-size: 0.95rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--gold-soft);
    }

    .nav-subtitle {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .nav-links {
      display: flex;
      align-items: center;
      gap: 1.25rem;
      font-size: 0.9rem;
    }

    .nav-link {
      color: var(--text-muted);
      text-decoration: none;
    }

    .nav-link:hover {
      color: var(--gold-soft);
    }

    .nav-link.active {
      color: var(--gold-soft);
      font-weight: 600;
    }

    .btn-ghost {
      border-radius: 999px;
      padding: 0.4rem 0.95rem;
      border: 1px solid var(--border-soft);
      font-size: 0.85rem;
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      text-decoration: none;
      color: var(--gold-soft);
      background: rgba(10, 14, 24, 0.9);
    }

    .btn-ghost:hover {
      border-color: var(--gold-soft);
      text-decoration: none;
      background: rgba(13, 18, 30, 0.95);
    }

    @media (max-width: 780px) {
      .nav-inner {
        flex-direction: column;
        align-items: flex-start;
      }
      .nav-links {
        width: 100%;
        justify-content: space-between;
        flex-wrap: wrap;
        row-gap: 0.4rem;
      }
    }

    /* HERO */
    .hero {
      padding: 3.2rem 1.5rem 2.4rem;
    }

    .hero-inner {
      max-width: 1120px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: minmax(0, 1.7fr) minmax(0, 1.3fr);
      gap: 2.6rem;
      align-items: stretch;
    }

    .hero-kicker {
      font-size: 0.8rem;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: var(--gold-soft);
      margin-bottom: 0.75rem;
    }

    .hero-title {
      font-family: "Orbitron", system-ui, sans-serif;
      font-size: clamp(2rem, 2.8vw, 2.5rem);
      line-height: 1.2;
      margin: 0 0 0.75rem;
    }

    .hero-title span {
      color: var(--gold-soft);
    }

    .hero-subtitle {
      font-size: 0.98rem;
      color: var(--text-muted);
      max-width: 32rem;
      margin-bottom: 1.4rem;
      text-align: justify;
    }

    .hero-badges {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 1.4rem;
    }

    .badge {
      font-size: 0.8rem;
      padding: 0.18rem 0.6rem;
      border-radius: 999px;
      border: 1px solid rgba(241, 230, 163, 0.3);
      color: var(--gold-soft);
      background: rgba(11, 15, 20, 0.9);
    }

    .hero-meta {
      font-size: 0.78rem;
      color: var(--text-muted);
      text-align: justify;
    }

    .hero-card {
      background: radial-gradient(circle at top left, #1b2236, #050711);
      border-radius: var(--radius-lg);
      padding: 1.6rem 1.7rem;
      border: 1px solid var(--border-soft);
      box-shadow: var(--shadow-soft);
      border-top: 3px solid var(--gold);
      display: flex;
      flex-direction: column;
      width: 100%;
    }

    .hero-card-title-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.75rem;
      margin-bottom: 0.4rem;
    }

    .hero-card-title {
      font-family: "Orbitron", system-ui, sans-serif;
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: var(--gold-soft);
      margin: 0;
    }

    .hero-card-pill {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      padding: 0.18rem 0.5rem;
      border-radius: 999px;
      border: 1px solid rgba(212, 175, 55, 0.5);
      color: var(--gold-soft);
      background: rgba(5, 7, 17, 0.9);
      white-space: nowrap;
    }

    .hero-card-subtitle {
      font-size: 0.85rem;
      color: var(--text-main);
      margin: 0 0 0.8rem;
      text-align: justify;
    }

    .hero-list {
      list-style: disc;
      padding-left: 1.1rem;
      margin: 0 0 0.6rem;
      font-size: 0.86rem;
      color: var(--text-main);
    }

    .hero-list li + li {
      margin-top: 0.25rem;
    }

    .hero-card-note {
      font-size: 0.78rem;
      color: var(--text-muted);
      line-height: 1.5;
      margin-top: 0.7rem;
      text-align: justify;
    }

    /* LAYOUT PANELS */
    .main {
      padding: 0 1.5rem 3.5rem;
    }

    .grid {
      max-width: 1120px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: minmax(0, 1.4fr) minmax(0, 1.6fr);
      gap: 2rem;
    }

    @media (max-width: 900px) {
      .hero-inner {
        grid-template-columns: minmax(0, 1fr);
      }
      .grid {
        grid-template-columns: minmax(0, 1fr);
      }
      .hero-card {
        margin-top: 1.4rem;
      }
    }

    .panel {
      background: linear-gradient(145deg, var(--panel), var(--panel-soft));
      border-radius: var(--radius-lg);
      padding: 1.6rem 1.7rem 1.7rem;
      box-shadow: var(--shadow-soft);
      color: var(--ink);
      border-top: 3px solid var(--gold);
    }

    .panel h2 {
      margin-top: 0;
      font-family: "Orbitron", system-ui, sans-serif;
      font-size: 1.05rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: #5c4721;
      margin-bottom: 0.8rem;
    }

    .panel p {
      font-size: 0.9rem;
      line-height: 1.5;
      margin-top: 0;
      text-align: justify;
    }

    .section-title {
      max-width: 1120px;
      margin: 2.2rem auto 0.9rem;
      padding: 0 0.1rem;
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: var(--text-muted);
    }

    /* FORM & RESULTS */
    .form-group {
      margin-bottom: 0.9rem;
    }

    .form-label {
      display: block;
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      margin-bottom: 0.25rem;
      color: #5c4721;
    }

    .input,
    .textarea {
      width: 100%;
      border-radius: 10px;
      border: 1px solid rgba(122, 100, 50, 0.25);
      padding: 0.5rem 0.6rem;
      font-size: 0.9rem;
      font-family: inherit;
      color: #3a2c12;
      background: #fdfbf7;
      outline: none;
    }

    .input:focus,
    .textarea:focus {
      border-color: var(--gold);
      box-shadow: 0 0 0 1px rgba(212, 175, 55, 0.35);
    }

    .textarea {
      min-height: 160px;
      resize: vertical;
    }

    .helper {
      font-size: 0.78rem;
      color: #7a6432;
      margin-top: 0.1rem;
    }

    .example-row {
      margin-top: 0.6rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      align-items: center;
      font-size: 0.78rem;
      color: #7a6432;
    }

    .btn-example {
      border-radius: 999px;
      padding: 0.25rem 0.7rem;
      border: 1px dashed rgba(122, 100, 50, 0.6);
      font-size: 0.78rem;
      cursor: pointer;
      background: rgba(253, 251, 247, 0.9);
      color: #3a2c12;
    }

    .btn-example:hover {
      background: rgba(241, 230, 163, 0.4);
    }

    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.6rem;
      margin-top: 1rem;
    }

    .btn-primary {
      border-radius: 999px;
      padding: 0.45rem 1.1rem;
      border: none;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      background: linear-gradient(135deg, #d4af37, #f1e6a3);
      color: #2a210e;
      box-shadow: 0 12px 26px rgba(0, 0, 0, 0.25);
    }

    .btn-primary:hover {
      filter: brightness(1.03);
    }

    .btn-secondary {
      border-radius: 999px;
      padding: 0.4rem 0.95rem;
      border: 1px solid rgba(122, 100, 50, 0.4);
      font-size: 0.85rem;
      cursor: pointer;
      background: transparent;
      color: #5c4721;
    }

    .btn-secondary:hover {
      background: rgba(212, 175, 55, 0.08);
    }

    .result-tagline {
      font-size: 0.82rem;
      color: #5c4721;
      margin-bottom: 0.6rem;
      text-align: justify;
    }

    .result-metrics {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 0.5rem;
      margin-bottom: 0.4rem;
      font-size: 0.8rem;
    }

    .metric {
      background: rgba(255, 255, 255, 0.7);
      border-radius: 10px;
      padding: 0.4rem 0.55rem;
      border: 1px solid rgba(212, 175, 55, 0.35);
    }

    .metric-label {
      text-transform: uppercase;
      letter-spacing: 0.12em;
      font-size: 0.7rem;
      color: #8a6c33;
      margin-bottom: 0.15rem;
    }

    .metric-value {
      font-weight: 600;
      color: #3a2c12;
      font-size: 0.9rem;
    }

    .score-interpretation {
      font-size: 0.78rem;
      color: #7a6432;
      margin-bottom: 0.8rem;
      text-align: justify;
    }

    .anchors-block {
      margin-bottom: 0.8rem;
      background: rgba(255, 255, 255, 0.75);
      border-radius: 10px;
      padding: 0.55rem 0.6rem 0.65rem;
      border: 1px solid rgba(212, 175, 55, 0.45);
      font-size: 0.8rem;
    }

    .anchors-title {
      text-transform: uppercase;
      letter-spacing: 0.12em;
      font-size: 0.7rem;
      color: #8a6c33;
      margin-bottom: 0.25rem;
    }

    .anchors-columns {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 0.6rem;
    }

    @media (max-width: 600px) {
      .anchors-columns {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .anchors-label {
      font-size: 0.78rem;
      font-weight: 600;
      margin-bottom: 0.1rem;
      color: #4a3716;
    }

    .anchors-list {
      margin: 0;
      padding-left: 1.1rem;
      font-size: 0.78rem;
    }

    .anchors-list li + li {
      margin-top: 0.1rem;
    }

    .anchors-empty {
      font-size: 0.78rem;
      color: #7a6432;
    }

    .hash-block {
      font-size: 0.78rem;
      word-break: break-all;
      background: rgba(255, 255, 255, 0.7);
      border-radius: 10px;
      padding: 0.5rem 0.6rem;
      border: 1px dashed rgba(122, 100, 50, 0.5);
      margin-bottom: 0.8rem;
    }

    .json-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 0.6rem;
    }

    .btn-json {
      border-radius: 999px;
      padding: 0.35rem 0.9rem;
      border: 1px solid rgba(122, 100, 50, 0.5);
      font-size: 0.8rem;
      cursor: pointer;
      background: rgba(253, 251, 247, 0.9);
      color: #3a2c12;
    }

    .btn-json:hover {
      background: rgba(241, 230, 163, 0.5);
    }

    pre {
      background: #111827;
      color: #e5e7eb;
      padding: 0.8rem 0.9rem;
      border-radius: 10px;
      font-size: 0.78rem;
      overflow-x: auto;
      border: 1px solid rgba(15, 23, 42, 0.8);
      margin: 0;
    }

    /* INFO PANEL */
    .info-section {
      max-width: 1120px;
      margin: 2.4rem auto 0;
    }

    .info-panel {
      background: linear-gradient(145deg, var(--panel), var(--panel-soft));
      border-radius: var(--radius-lg);
      padding: 1.6rem 1.7rem 1.8rem;
      box-shadow: var(--shadow-soft);
      color: var(--ink);
      border-top: 3px solid var(--gold);
    }

    .info-panel h2 {
      margin-top: 0;
      font-family: "Orbitron", system-ui, sans-serif;
      font-size: 1rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: #5c4721;
      margin-bottom: 0.9rem;
    }

    .info-grid {
      display: grid;
      grid-template-columns: minmax(0, 1.4fr) minmax(0, 1.6fr);
      gap: 1.6rem;
    }

    @media (max-width: 900px) {
      .info-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .info-panel p {
      font-size: 0.9rem;
      line-height: 1.6;
      margin: 0 0 0.8rem;
      text-align: justify;
    }

    .info-list {
      margin: 0.1rem 0 0.9rem;
      padding-left: 1.1rem;
      font-size: 0.9rem;
    }

    .info-list li + li {
      margin-top: 0.25rem;
    }

    .info-note {
      font-size: 0.82rem;
      color: #7a6432;
      text-align: justify;
    }

    /* CTA PANEL */
    .cta-panel {
      max-width: 1120px;
      margin: 2.4rem auto 0;
      padding: 1.3rem 1.5rem;
      border-radius: var(--radius-lg);
      border: 1px solid rgba(212, 175, 55, 0.4);
      background: radial-gradient(circle at top left, #1b2236, #050711);
      box-shadow: var(--shadow-soft);
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 0.8rem;
      font-size: 0.9rem;
    }

    .cta-panel strong {
      color: var(--gold-soft);
    }

    .cta-btn {
      border-radius: 999px;
      padding: 0.45rem 1.2rem;
      border: none;
      font-size: 0.88rem;
      font-weight: 500;
      background: linear-gradient(135deg, #d4af37, #f1e6a3);
      color: #2a210e;
      text-decoration: none;
      box-shadow: 0 12px 26px rgba(0, 0, 0, 0.25);
      white-space: nowrap;
    }

    .cta-btn:hover {
      filter: brightness(1.03);
      text-decoration: none;
    }

    /* CNRS PILOT MINI-BLOCK */
    .cnrs-cta {
      margin-top: 1.2rem;
      padding-top: 0.9rem;
      border-top: 1px dashed rgba(212, 175, 55, 0.35);
      font-size: 0.8rem;
    }

    .cnrs-cta-title {
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--gold-soft);
      margin-bottom: 0.3rem;
    }

    .cnrs-cta p {
      margin: 0 0 0.45rem;
      color: var(--text-muted);
      text-align: justify;
    }

    .cnrs-cta a {
      font-size: 0.8rem;
    }

    /* FOOTER */
    .footer {
      border-top: 1px solid var(--border-soft);
      background: radial-gradient(circle at top, #101525, #020308);
      padding: 1.6rem 1.5rem 2.1rem;
      color: var(--text-muted);
      font-size: 0.82rem;
    }

    .footer-inner {
      max-width: 1120px;
      margin: 0 auto;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 0.8rem;
    }

    .footer-links {
      display: flex;
      flex-wrap: wrap;
      gap: 0.9rem;
    }

    .footer-links a {
      color: var(--text-muted);
      text-decoration: none;
    }

    .footer-links a:hover {
      color: var(--gold-soft);
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <!-- NAVBAR -->
  <header class="nav">
    <div class="nav-inner">
      <div class="nav-left">
        <a href="overview.html" class="nav-logo-link">
          <div class="nav-logo">
            <img
              src="https://uploads.strikinglycdn.com/files/5b108f2f-0feb-4789-a4dd-d1d21cd5eec6/Capture%20d%E2%80%99e%CC%81cran%202025-11-01%20a%CC%80%2016.30.35.png"
              alt="Emblème OpenProof"
            />
          </div>
          <div>
            <div class="nav-title">OPENPROOF – RPO V0.1</div>
            <div class="nav-subtitle">
              JSON signé • PDF lisible par l’homme • Hachage public
            </div>
          </div>
        </a>
      </div>

      <div class="nav-links">
        <a href="overview.html" class="nav-link">Aperçu</a>
        <a href="index.html" class="nav-link">Spécification</a>
        <a href="examples.html" class="nav-link">Exemples</a>
        <a href="tests.html" class="nav-link">Tests</a>
        <a href="playground.html" class="nav-link active">Aire de jeux</a>
        <a
          class="btn-ghost"
          href="https://github.com/openproof-net/rpo-spec-v0.1"
          target="_blank"
          rel="noopener noreferrer"
        >
          <span>Voir sur GitHub</span>
        </a>
      </div>
    </div>
  </header>

  <!-- HERO -->
  <section class="hero">
    <div class="hero-inner">
      <div>
        <div class="hero-kicker">RPO Playground • Version ouverte</div>
        <h1 class="hero-title">
          Essayez le <span>RPO Playground</span> — du récit à l’épreuve du brouillon
        </h1>
        <p class="hero-subtitle">
          Collez un court récit, ajoutez quelques identifiants et générez un
          <strong>lot JSON RPO préliminaire</strong> avec des scores heuristiques et un
          hachage public. Cette page montre comment la norme RPO peut structurer
          un récit pour le rendre vérifiable.
        </p>
        <div class="hero-badges">
          <div class="badge">Expérimental</div>
          <div class="badge">Déterministe</div>
          <div class="badge">Compatible logiciels libres</div>
        </div>
        <div class="hero-meta">
          Il s’agit d’un <strong>terrain de jeu ouvert</strong> : sans modèle d’IA, sans
          registre, sans valeur juridique. Son but est de montrer à quoi pourrait
          ressembler un lot RPO simple et comment il se comporte, avant d’y
          brancher des moteurs avancés ou des modules CNRS.
        </div>
      </div>

      <aside class="hero-card">
        <div class="hero-card-title-row">
          <div class="hero-card-title">Que fait cette page&nbsp;?</div>
          <div class="hero-card-pill">Local uniquement</div>
        </div>
        <div class="hero-card-subtitle">
          Elle prend votre récit et le transforme en un brouillon de lot RPO :
        </div>
        <ul class="hero-list">
          <li>Calcule les métriques de base (longueur, structure, densité de preuves).</li>
          <li>Construit un objet <code>rpo.json</code> minimal conforme au standard.</li>
          <li>Derive un <code>public_hash</code> du contenu complet.</li>
        </ul>
        <p class="hero-card-note">
          Considérez cela comme un <strong>bac à sable RPO</strong> : le “code civil”
          existe, cette page montre comment un moteur simple pourrait l’appliquer
          à des récits réels.
        </p>
        <div class="cnrs-cta">
          <div class="cnrs-cta-title">
            Test du projet pilote scientifique (CNRS × TruthX)
          </div>
          <p>
            Pour une analyse psycho-médico-légale avancée (cohérence interprétative,
            structure narrative, marqueurs de contrôle coercitif), vous pouvez
            demander l’accès au projet pilote de recherche <strong>CNRS × TruthX</strong>.
          </p>
          <a
            href="https://www.truthx.co/truthx-pilote-form"
            target="_blank"
            rel="noopener noreferrer"
          >
            Demander l’accès au projet pilote du CNRS
          </a>
        </div>
      </aside>
    </div>
  </section>

  <!-- MAIN -->
  <main class="main">
    <div class="section-title">Jouez avec un récit</div>
    <div class="grid">
      <!-- INPUT PANEL -->
      <section class="panel">
        <h2>1. Entrée</h2>
        <p>
          Commencez par un court récit (1 à 3 paragraphes). Vous pouvez anonymiser
          les noms et les dates. L’objectif est d’observer la structure, non de porter
          un jugement sur le fond.
        </p>
        <div class="form-group">
          <label class="form-label" for="case-title">Titre de l’affaire</label>
          <input
            id="case-title"
            class="input"
            placeholder="Exemple : Incident dans les bureaux de Paris – mars 2024"
          />
        </div>
        <div class="form-group">
          <label class="form-label" for="issuer">Émetteur (qui dépose le rapport)</label>
          <input
            id="issuer"
            class="input"
            placeholder="Exemple : Équipe d’audit interne, Société X"
          />
        </div>
        <div class="form-group">
          <label class="form-label" for="subject">Sujet (qui / quoi est concerné)</label>
          <input
            id="subject"
            class="input"
            placeholder="Exemple : Salarié, service, contrat, etc."
          />
        </div>
        <div class="form-group">
          <label class="form-label" for="narrative">Récit (texte libre)</label>
          <textarea
            id="narrative"
            class="textarea"
            placeholder="Décrivez la situation avec vos mots. Que s’est-il passé, quand, où, qui était impliqué ?"
          ></textarea>
          <div class="helper">
            Astuce : incluez au moins un repère temporel, un lieu, et 2–3 actions concrètes.
          </div>
          <div class="example-row">
            <span>Ou charger un exemple&nbsp;:</span>
            <button type="button" class="btn-example" id="example-incident">
              Incident en entreprise
            </button>
            <button type="button" class="btn-example" id="example-contrat">
              Litige contractuel
            </button>
          </div>
        </div>

        <div class="btn-row">
          <button class="btn-primary" id="generate-btn">
            Générer le lot RPO
          </button>
          <button class="btn-secondary" id="reset-btn" type="button">
            Réinitialiser
          </button>
        </div>
      </section>

      <!-- OUTPUT PANEL -->
      <section class="panel">
        <h2>2. Projet de lot RPO</h2>
        <p class="result-tagline" id="result-tagline">
          Remplissez le formulaire à gauche et cliquez sur « Générer » pour voir le
          lot.
        </p>

        <div class="result-metrics" id="metrics" style="display: none">
          <div class="metric">
            <div class="metric-label">Phrases</div>
            <div class="metric-value" id="metric-sentences">0</div>
          </div>
          <div class="metric">
            <div class="metric-label">Marqueurs de preuve</div>
            <div class="metric-value" id="metric-markers">0</div>
          </div>
          <div class="metric">
            <div class="metric-label">Score de cohérence</div>
            <div class="metric-value" id="metric-score">0%</div>
          </div>
        </div>

        <div
          class="score-interpretation"
          id="score-interpretation"
          style="display: none"
        ></div>

        <div
          class="anchors-block"
          id="anchors-block"
          style="display: none"
        >
          <div class="anchors-title">
            Ancres heuristiques (version ouverte)
          </div>
          <div class="anchors-columns">
            <div>
              <div class="anchors-label">Dates et années</div>
              <ul class="anchors-list" id="anchors-dates"></ul>
            </div>
            <div>
              <div class="anchors-label">Lieux (expérimental)</div>
              <ul class="anchors-list" id="anchors-places"></ul>
            </div>
          </div>
        </div>

        <div
          class="hash-block"
          id="hash-block"
          style="display: none"
        >
          <strong>public_hash</strong><br />
          <span id="hash-value"></span>
        </div>

        <div class="json-actions" id="json-actions" style="display: none">
          <button class="btn-json" id="copy-json-btn" type="button">
            Copier le JSON
          </button>
          <button class="btn-json" id="download-json-btn" type="button">
            Télécharger rpo.json
          </button>
        </div>

        <pre id="rpo-json" aria-label="Lot RPO JSON préliminaire"></pre>
      </section>
    </div>

    <!-- INFO PANEL -->
    <section class="info-section">
      <div class="info-panel">
        <h2>Comment fonctionne cette page</h2>
        <div class="info-grid">
          <div>
            <p>
              Cette aire de jeux ouverte montre comment un récit libre peut devenir
              un <strong>lot RPO minimal</strong>. Tout se fait localement dans votre
              navigateur : pas de backend, pas de registre, pas de modèle d’IA.
            </p>
            <ul class="info-list">
              <li>Vous écrivez un récit et quelques libellés (émetteur, sujet, titre).</li>
              <li>La page calcule trois signaux heuristiques : nombre de phrases, marqueurs de preuve, score de cohérence.</li>
              <li>Un objet <code>rpo.json</code> est généré, avec un <code>public_hash</code> en SHA-256.</li>
            </ul>
            <p class="info-note">
              L’objectif est de rendre la <strong>structure de la preuve visible</strong> :
              ce qui n’était “qu’une histoire” devient un lot qui peut, demain, être
              ancré, versionné et interprété par des moteurs plus avancés.
            </p>
          </div>
          <div>
            <p>
              Dans le <strong>projet pilote scientifique CNRS × TruthX</strong>, ce
              squelette sera enrichi par des heuristiques psycho-forensiques :
              cohérence interprétative, patterns de contrôle coercitif, récits inversés,
              scores de cohérence probatoire.
            </p>
            <p>
              Cette version ouverte reste volontairement simple et transparente, pour
              que chacun puisse inspecter le JSON, recalculer le hachage et réutiliser
              le lot dans ses propres tests ou outils.
            </p>
            <p class="info-note">
              Version ouverte = pas d’IA, pas de registre central, pas de valeur
              juridique. Version scientifique = moteurs psycho-légaux avancés,
              environnement contrôlé et gouvernance stricte.
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- CTA PANEL -->
    <section class="cta-panel">
      <div>
        <strong>Ce que vous voyez ici : la version ouverte du RPO Playground.</strong
        ><br />
        Si vous souhaitez tester la <strong>version scientifique CNRS</strong> avec des
        modules psycho-forensiques avancés et des cas réels, vous pouvez candidater
        au programme pilote.
      </div>
      <a
        class="cta-btn"
        href="https://www.truthx.co/truthx-pilote-form"
        target="_blank"
        rel="noopener noreferrer"
      >
        Candidater au pilote CNRS
      </a>
    </section>
  </main>

  <!-- FOOTER -->
  <footer class="footer">
    <div class="footer-inner">
      <div class="footer-left">
        <div class="footer-title">OpenProof – RPO Spécification v0.1</div>
        <div class="footer-text">
          © 2026 OpenProof Consortium. Collaboration de recherche : CNRS – GREYC – Université de Caen Normandie.
        </div>
      </div>
      <div class="footer-right footer-links">
        <a
          href="https://www.openproof.net"
          target="_blank"
          rel="noopener noreferrer"
          >Site technique</a
        >
        <span>•</span>
        <a
          href="https://www.truthx-openproof.org"
          target="_blank"
          rel="noopener noreferrer"
          >Gouvernance</a
        >
        <span>•</span>
        <a href="mailto:openproof@truthx.co">Contact</a>
      </div>
    </div>
  </footer>

  <!-- SIMPLE JS ENGINE – heuristics + anchors -->
  <script>
    const generateBtn = document.getElementById("generate-btn");
    const resetBtn = document.getElementById("reset-btn");

    const titleInput = document.getElementById("case-title");
    const issuerInput = document.getElementById("issuer");
    const subjectInput = document.getElementById("subject");
    const narrativeInput = document.getElementById("narrative");

    const exampleIncidentBtn = document.getElementById("example-incident");
    const exampleContratBtn = document.getElementById("example-contrat");

    const taglineEl = document.getElementById("result-tagline");
    const metricsEl = document.getElementById("metrics");
    const sentencesEl = document.getElementById("metric-sentences");
    const markersEl = document.getElementById("metric-markers");
    const scoreEl = document.getElementById("metric-score");

    const scoreInterpretationEl = document.getElementById("score-interpretation");

    const hashBlockEl = document.getElementById("hash-block");
    const hashValueEl = document.getElementById("hash-value");
    const jsonEl = document.getElementById("rpo-json");

    const anchorsBlockEl = document.getElementById("anchors-block");
    const anchorsDatesEl = document.getElementById("anchors-dates");
    const anchorsPlacesEl = document.getElementById("anchors-places");

    const jsonActionsEl = document.getElementById("json-actions");
    const copyJsonBtn = document.getElementById("copy-json-btn");
    const downloadJsonBtn = document.getElementById("download-json-btn");

    const examples = {
      incident: {
        title: "Incident dans les bureaux de Paris – mars 2024",
        issuer: "Équipe d’audit interne, Société X",
        subject: "Salarié – Département commercial",
        narrative: `Le 12 mars 2024, dans l’après-midi, plusieurs collègues ont signalé un comportement inhabituel d’un salarié du service commercial au siège de Paris.

Selon trois témoins, le salarié a élevé la voix sur un collègue junior dans l’open space, à propos de l’attribution d’un compte client stratégique. L’échange, d’une durée d’environ cinq minutes, était audible sur une grande partie du plateau.

Le même jour, ce salarié aurait accédé à un dossier CRM restreint, en dehors de son périmètre habituel. L’accès a eu lieu à 19h42, après les horaires normaux de travail. Les journaux informatiques confirment une connexion depuis son ordinateur professionnel, avec ses identifiants personnels.`
      },
      contrat: {
        title: "Litige sur le renouvellement d’un contrat de services – Client Z",
        issuer: "Direction juridique, Société Y",
        subject: "Contrat-cadre de maintenance IT – Client Z (France)",
        narrative: `Depuis septembre 2023, la Société Y fournit des services de maintenance informatique au Client Z, dans le cadre d’un contrat-cadre d’un an signé le 15 septembre 2023 à Lyon.

Le 20 août 2024, le Client Z a informé notre chargé de compte, par courriel, qu’il considérait le contrat comme renouvelé automatiquement pour une année supplémentaire, aux mêmes conditions tarifaires, en se fondant sur une clause de reconduction tacite. Notre équipe juridique ne partage pas cette interprétation.

Entre le 25 août et le 5 septembre 2024, plusieurs échanges téléphoniques et écrits ont eu lieu entre les parties. Le Client Z a continué à demander des interventions sur son infrastructure, tout en refusant toute mise à jour de prix. Nos équipes considèrent que, sans avenant signé, les interventions réalisées après le 15 septembre 2024 pourraient être contestées ou impayées.`
      }
    };

    function countSentences(text) {
      const cleaned = text.replace(/\s+/g, " ").trim();
      if (!cleaned) return 0;
      const parts = cleaned.split(/[.!?]+/).map((s) => s.trim()).filter(Boolean);
      return parts.length;
    }

    function countEvidenceMarkers(text) {
      const digits = (text.match(/\d{2,}/g) || []).length;
      const markers =
        text.match(
          /\b(on|at|since|because|when|where|le|en|depuis|lorsque|où|au|aux|vers)\b/gi
        ) || [];
      return digits + markers.length;
    }

    function computeCoherenceScore(sentences, markers) {
      const base = Math.min(40, sentences * 6);
      const detail = Math.min(40, markers * 4);
      const floor = 20;
      return Math.max(0, Math.min(100, floor + base + detail));
    }

    function interpretScore(score) {
      if (score <= 0) {
        return "";
      } else if (score < 40) {
        return "Cohérence structurelle faible : récit court ou peu structuré, avec peu d’ancres explicites. Comme lot probatoire, cela resterait fragile.";
      } else if (score < 70) {
        return "Cohérence intermédiaire : le récit contient une structure et quelques marqueurs, mais des ancres clés (dates, lieux, acteurs) peuvent encore manquer ou rester floues.";
      } else {
        return "Structure narrative forte : plusieurs phrases et ancres permettent d’organiser le récit en squelette potentiellement probatoire. Il doit néanmoins être relu sur le plan factuel et juridique.";
      }
    }

    function extractAnchors(text) {
      const datesSet = new Set();
      const yearsSet = new Set();
      const placesSet = new Set();

      // années 19xx / 20xx
      const yearMatches = text.match(/\b(19|20)\d{2}\b/g) || [];
      yearMatches.forEach((y) => yearsSet.add(y));

      // dates 12/03/2024 ou 12-03-2024
      const datePattern = /\b(\d{1,2}[\/\-]\d{1,2}[\/\-]\d{2,4})\b/g;
      let m;
      while ((m = datePattern.exec(text)) !== null) {
        datesSet.add(m[1]);
      }

      // dates avec mois (FR + EN)
      const monthNames = [
        "january",
        "february",
        "march",
        "april",
        "may",
        "june",
        "july",
        "august",
        "september",
        "october",
        "november",
        "december",
        "janvier",
        "février",
        "fevrier",
        "mars",
        "avril",
        "mai",
        "juin",
        "juillet",
        "août",
        "aout",
        "septembre",
        "octobre",
        "novembre",
        "décembre",
        "decembre"
      ];
      const monthRegex = new RegExp(
        "\\b(\\d{1,2})\\s+(" + monthNames.join("|") + ")\\b",
        "gi"
      );
      while ((m = monthRegex.exec(text)) !== null) {
        datesSet.add(m[0]);
      }

      // lieux simples après in/at/en/à + Mot capitalisé
      const placePattern =
        /\b(?:in|at|en|à|au|aux)\s+([A-Z][A-Za-zÀ-ÖØ-öø-ÿ\-]*(?:\s+[A-Z][A-Za-zÀ-ÖØ-öø-ÿ\-]*)?)/g;
      while ((m = placePattern.exec(text)) !== null) {
        placesSet.add(m[1].trim());
      }

      return {
        dates: Array.from(datesSet),
        years: Array.from(yearsSet),
        places: Array.from(placesSet)
      };
    }

    async function sha256(text) {
      const encoder = new TextEncoder();
      const data = encoder.encode(text);
      const hashBuffer = await crypto.subtle.digest("SHA-256", data);
      const hashArray = Array.from(new Uint8Array(hashBuffer));
      return hashArray.map((b) => b.toString(16).padStart(2, "0")).join("");
    }

    function randomBundleId() {
      const ts = Date.now().toString(36);
      const rand = Math.floor(Math.random() * 1e8).toString(36);
      return "rpo-" + ts + "-" + rand;
    }

    function setScoreInterpretation(score) {
      const text = interpretScore(score);
      if (text) {
        scoreInterpretationEl.style.display = "block";
        scoreInterpretationEl.textContent = text;
      } else {
        scoreInterpretationEl.style.display = "none";
        scoreInterpretationEl.textContent = "";
      }
    }

    function renderAnchors(anchors) {
      anchorsDatesEl.innerHTML = "";
      anchorsPlacesEl.innerHTML = "";

      const combinedDates = [...anchors.dates, ...anchors.years];

      if (!combinedDates.length && !anchors.places.length) {
        anchorsBlockEl.style.display = "none";
        return;
      }

      anchorsBlockEl.style.display = "block";

      if (combinedDates.length) {
        combinedDates.forEach((v) => {
          const li = document.createElement("li");
          li.textContent = v;
          anchorsDatesEl.appendChild(li);
        });
      } else {
        const li = document.createElement("li");
        li.className = "anchors-empty";
        li.textContent = "Aucune date ou année explicite détectée.";
        anchorsDatesEl.appendChild(li);
      }

      if (anchors.places.length) {
        anchors.places.forEach((v) => {
          const li = document.createElement("li");
          li.textContent = v;
          anchorsPlacesEl.appendChild(li);
        });
      } else {
        const li = document.createElement("li");
        li.className = "anchors-empty";
        li.textContent = "Aucun marqueur de lieu net détecté.";
        anchorsPlacesEl.appendChild(li);
      }
    }

    function enableJsonActions(enable) {
      jsonActionsEl.style.display = enable ? "flex" : "none";
    }

    function resetOutputs() {
      taglineEl.textContent =
        "Remplissez le formulaire à gauche et cliquez sur « Générer » pour voir le lot.";
      metricsEl.style.display = "none";
      sentencesEl.textContent = "0";
      markersEl.textContent = "0";
      scoreEl.textContent = "0%";

      hashBlockEl.style.display = "none";
      hashValueEl.textContent = "";

      jsonEl.textContent = "";

      scoreInterpretationEl.style.display = "none";
      scoreInterpretationEl.textContent = "";

      anchorsBlockEl.style.display = "none";
      anchorsDatesEl.innerHTML = "";
      anchorsPlacesEl.innerHTML = "";

      enableJsonActions(false);
    }

    function loadExample(example) {
      titleInput.value = example.title;
      issuerInput.value = example.issuer;
      subjectInput.value = example.subject;
      narrativeInput.value = example.narrative;
      resetOutputs();
    }

    generateBtn.addEventListener("click", async (event) => {
      event.preventDefault();

      const title = titleInput.value.trim() || "Affaire sans titre";
      const issuer = issuerInput.value.trim() || "Émetteur non renseigné";
      const subject = subjectInput.value.trim() || "Sujet non précisé";
      const narrative = narrativeInput.value.trim();

      if (!narrative) {
        alert("Veuillez saisir un récit avant de générer le lot RPO.");
        return;
      }

      const sentences = countSentences(narrative);
      const markers = countEvidenceMarkers(narrative);
      const score = computeCoherenceScore(sentences, markers);
      const anchors = extractAnchors(narrative);

      const bundleId = randomBundleId();
      const createdAt = new Date().toISOString();

      const fullForHash = [
        "rpo_version=0.1",
        "bundle_id=" + bundleId,
        "created_at=" + createdAt,
        "issuer=" + issuer,
        "subject=" + subject,
        "title=" + title,
        "narrative=" + narrative
      ].join("|");

      let publicHash = "";
      try {
        publicHash = await sha256(fullForHash);
      } catch (e) {
        publicHash = "sha256-not-available-in-this-browser";
      }

      const rpo = {
        rpo_version: "0.1",
        bundle_id: bundleId,
        created_at: createdAt,
        issuer: {
          label: issuer
        },
        subject: {
          label: subject
        },
        narrative: {
          title: title,
          text: narrative,
          pdf_hash: "pdf-placeholder-hash"
        },
        evidence: [
          {
            id: "E1",
            type: "narrative_block",
            source: "user_input",
            description:
              "Récit brut saisi dans le playground RPO ouvert",
            text_ref: "narrative.text"
          }
        ],
        registry: {
          public_hash: publicHash,
          registry_hint:
            "Aire de jeux ouverte — aucun ancrage officiel dans un registre."
        },
        meta: {
          playground: true,
          heuristic_scores: {
            coherence_score: score,
            evidence_markers: markers,
            sentence_count: sentences
          },
          heuristic_anchors: anchors,
          psycho_forensic: {
            available: false,
            note:
              "Dans le pilote CNRS × TruthX, ce bloc sera rempli par des modèles psycho-forensiques (cohérence interprétative, contrôle coercitif, récits inversés)."
          }
        }
      };

      sentencesEl.textContent = sentences.toString();
      markersEl.textContent = markers.toString();
      scoreEl.textContent = score.toString() + "%";
      metricsEl.style.display = "grid";

      setScoreInterpretation(score);
      renderAnchors(anchors);

      if (publicHash) {
        hashBlockEl.style.display = "block";
        hashValueEl.textContent = publicHash;
      } else {
        hashBlockEl.style.display = "none";
        hashValueEl.textContent = "";
      }

      taglineEl.textContent =
        "Ce lot RPO est généré localement dans votre navigateur. Il est déterministe, non opposable et destiné à l’expérimentation.";
      jsonEl.textContent = JSON.stringify(rpo, null, 2);

      enableJsonActions(true);
    });

    resetBtn.addEventListener("click", () => {
      titleInput.value = "";
      issuerInput.value = "";
      subjectInput.value = "";
      narrativeInput.value = "";
      resetOutputs();
    });

    exampleIncidentBtn.addEventListener("click", () => {
      loadExample(examples.incident);
    });

    exampleContratBtn.addEventListener("click", () => {
      loadExample(examples.contrat);
    });

    copyJsonBtn.addEventListener("click", () => {
      const text = jsonEl.textContent.trim();
      if (!text) return;
      try {
        navigator.clipboard.writeText(text);
        copyJsonBtn.textContent = "Copié";
        setTimeout(() => {
          copyJsonBtn.textContent = "Copier le JSON";
        }, 1500);
      } catch (e) {
        alert(
          "Impossible de copier automatiquement. Vous pouvez toujours sélectionner le texte et le copier manuellement."
        );
      }
    });

    downloadJsonBtn.addEventListener("click", () => {
      const text = jsonEl.textContent.trim();
      if (!text) return;

      const blob = new Blob([text], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "rpo.json";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    });
  </script>
</body>
</html>





