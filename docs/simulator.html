<!DOCTYPE html>
<html lang="en" data-page="simulator">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Simulator — Decision Defensibility | OpenProof RPO v0.1</title>
  <meta name="description" content="Choose a decision context (Governance, Legal Proceedings, Institutional Crisis) and generate a deterministic, auditable proof bundle: sealed JSON + print view + public hash." />

  <!-- Your shared assets (keep as-is if you already use them) -->
  <link rel="stylesheet" href="./assets/site.css" />
  <script defer src="./assets/site.js"></script>

  <style>
    /* Minimal additions; keeps your dark+gold vibe without fighting your CSS */
    .context-bar{
      display:flex; gap:12px; align-items:center; flex-wrap:wrap;
      margin: 14px 0 10px;
    }
    .context-select{
      display:flex; align-items:center; gap:10px;
      padding:10px 12px; border-radius:14px;
      border:1px solid rgba(212,175,55,.35);
      background: rgba(10,14,22,.55);
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
    }
    .context-select label{opacity:.85; font-size:12px; letter-spacing:.08em; text-transform:uppercase;}
    .context-select select{
      appearance:none;
      background: rgba(0,0,0,.25);
      border:1px solid rgba(212,175,55,.25);
      color: #f7f3e8;
      padding:8px 10px;
      border-radius:12px;
      font-size:14px;
      outline:none;
      cursor:pointer;
    }
    .context-hint{opacity:.75; font-size:13px; max-width: 680px;}
    .cta-truthx{
      margin-top: 22px;
      display:flex; align-items:center; justify-content:space-between;
      gap: 14px; flex-wrap:wrap;
      padding: 14px 14px;
      border-radius: 16px;
      border: 1px solid rgba(212,175,55,.22);
      background: rgba(10,14,22,.45);
    }
    .cta-truthx p{margin:0; opacity:.86; max-width: 760px;}
    .cta-truthx a{
      display:inline-flex; align-items:center; justify-content:center;
      padding: 10px 14px;
      border-radius: 999px;
      border: 1px solid rgba(212,175,55,.35);
      background: linear-gradient(90deg, rgba(241,230,163,.95), rgba(212,175,55,.92));
      color:#0b0f14;
      font-weight:700;
      text-decoration:none;
      white-space:nowrap;
    }
    .mini-link{font-size:12px; opacity:.8;}
    .mini-link a{color: inherit;}
  </style>
</head>

<body>
  <header class="top-header">
    <a class="brand" href="./index.html" target="_blank" rel="noopener noreferrer" aria-label="OpenProof RPO v0.1">
      <span class="brand-dot" aria-hidden="true"></span>
      <span class="brand-text">OPENPROOF.NET — RPO v0.1</span>
    </a>

    <!-- NAV UPDATED -->
    <nav class="top-nav" aria-label="Primary">
      <a href="./index.html" target="_blank" rel="noopener noreferrer">Home</a>
      <a href="./simulator.html" aria-current="page" target="_blank" rel="noopener noreferrer">Simulator</a>
      <a href="./profiles.html" target="_blank" rel="noopener noreferrer">Profiles</a>
      <a href="./how-it-works.html" target="_blank" rel="noopener noreferrer">How it works</a>
      <a href="./spec.html" target="_blank" rel="noopener noreferrer">Spec</a>
      <a href="./tests.html" target="_blank" rel="noopener noreferrer">Tests</a>
      <a href="./examples.html" target="_blank" rel="noopener noreferrer">Examples</a>
    </nav>

    <!-- Cockpit CTA = TruthX pilot form (exact link you gave) -->
    <a href="https://www.truthx.co/truthx-pilote-form" class="top-cta" target="_blank" rel="noopener noreferrer">
      Cockpit (Pilot)
    </a>
  </header>

  <main class="wrap" role="main">

    <section class="hero" aria-labelledby="hero-title">
      <div>
        <div class="eyebrow">Decision defensibility <span>simulator (live)</span></div>

        <h1 class="h1" id="hero-title">
          Freeze the perimeter.
          <span class="gold">Make decisions reconstructible.</span>
        </h1>

        <p class="lead">
          One deterministic simulator, three contexts.
          No AI. No interpretation. Same input → same sealed core.
        </p>

        <!-- Context selector -->
        <div class="context-bar" role="group" aria-label="Context selector">
          <div class="context-select">
            <label for="contextSelect">Context</label>
            <select id="contextSelect">
              <option value="governance">Governance</option>
              <option value="legal">Legal Proceedings</option>
              <option value="crisis">Institutional Crisis</option>
            </select>
          </div>

          <div class="context-hint" id="contextHint">
            Governance: stable operating model, auditable HR decisions, multi-entity consistency.
          </div>
        </div>

        <div class="chips" aria-label="Key properties" id="contextChips">
          <span class="chip">Moment T</span>
          <span class="chip">Declared systems</span>
          <span class="chip">Lineage</span>
          <span class="chip">Quality checks</span>
          <span class="chip">Audit exposure</span>
          <span class="chip">Public hash</span>
        </div>

        <div class="hero-actions">
          <button class="btn-primary" id="btnGenerate">Generate bundle</button>
          <button class="btn-ghost" id="btnLoadExample">Load example</button>
        </div>

        <p class="mini-link">
          Spec naming: <code>profiles</code>. UI naming: <strong>contexts</strong>.
          (We keep the repository structure clean.)
        </p>
      </div>

      <aside class="panel hero-panel" aria-label="Simulator cockpit preview">
        <div class="panel-title">PROOF BUNDLE PREVIEW (30 SECONDS)</div>
        <div class="panel-sub">
          <span class="pill">INTEGRITY</span>
          <span class="pill">READABILITY</span>
          <span class="pill">VERIFIABILITY</span>
        </div>

        <div class="kv">
          <div class="kv-row"><span>Scope</span><strong id="kvScope">Defense Group — Europe scope (multi-sites, multi-entities)</strong></div>
          <div class="kv-row"><span>Moment T</span><strong id="kvMoment">2026-02-10</strong></div>
          <div class="kv-row"><span>Coverage</span><strong id="kvCoverage">83%</strong></div>
          <div class="kv-row"><span>Defensibility</span><strong id="kvDef">MEDIUM (61)</strong></div>
          <div class="kv-row"><span>Audit exposure</span><strong id="kvAudit">MEDIUM</strong></div>
        </div>

        <div class="hashline">
          <span class="dot" aria-hidden="true"></span>
          <span>READY</span>
          <span class="spacer"></span>
          <span>VERIFY</span>
        </div>

        <div class="hash" id="kvHash">hash: —</div>
      </aside>
    </section>

    <section class="grid-2" aria-label="Simulator">
      <!-- INPUT -->
      <section class="panel">
        <div class="panel-title">INPUT — DECISION PERIMETER</div>

        <div class="form">
          <div class="field">
            <label for="decisionType">Decision type</label>
            <select id="decisionType">
              <option>Nomination / sensitive role</option>
              <option>Promotion / grade change</option>
              <option>Performance remediation</option>
              <option>Disciplinary decision</option>
              <option>Termination</option>
              <option>Emergency re-org</option>
            </select>
          </div>

          <div class="field">
            <label for="decisionDate">Decision date (Moment T)</label>
            <input id="decisionDate" type="date" value="2026-02-10" />
          </div>

          <div class="field">
            <label for="orgScope">Organization / scope</label>
            <input id="orgScope" type="text" value="Defense Group — Europe scope (multi-sites, multi-entities)" />
          </div>

          <div class="field">
            <label for="decisionOwner">Decision owner</label>
            <input id="decisionOwner" type="text" value="Global CHRO / Executive committee" />
          </div>

          <div class="field field-full">
            <label for="contextNarrative">Decision context (1–3 paragraphs)</label>
            <textarea id="contextNarrative" rows="4">Sensitive decision in a regulated environment. Traceability across HR systems and stability of definitions are required. Decision may be challenged and must remain reconstructible over time (audit window).</textarea>
          </div>

          <div class="divider"></div>

          <div class="panel-title">DECLARED SOURCES (WHAT WAS ACTUALLY AVAILABLE)</div>

          <div class="checks">
            <label class="check"><input type="checkbox" id="srcLms" checked /> LMS / training files</label>
            <label class="check"><input type="checkbox" id="srcHris" checked /> HRIS / career history</label>
            <label class="check"><input type="checkbox" id="srcPerf" checked /> Performance reviews</label>
            <label class="check"><input type="checkbox" id="srcOps" checked /> Operational results</label>
            <label class="check"><input type="checkbox" id="src360" /> 360 feedback (attributable)</label>
            <label class="check"><input type="checkbox" id="srcLegal" checked /> Legal / compliance constraints</label>
          </div>
        </div>
      </section>

      <!-- OUTPUT -->
      <section class="panel">
        <div class="panel-title">OUTPUT — DECISION DEFENSIBILITY REPORT</div>

        <div class="summary-grid">
          <div class="metric"><span>Coverage</span><strong id="outCoverage">83%</strong></div>
          <div class="metric"><span>Missing</span><strong id="outMissing">1</strong></div>
          <div class="metric"><span>Defensibility</span><strong id="outDef">MEDIUM (61/100)</strong></div>
          <div class="metric"><span>Audit exposure</span><strong id="outAudit">MEDIUM</strong></div>
        </div>

        <div class="tabs">
          <button class="tab is-active" data-tab="summary">Summary</button>
          <button class="tab" data-tab="json">JSON</button>
          <button class="tab" data-tab="print">PDF (print)</button>
        </div>

        <div class="tabpanels">
          <div class="tabpanel is-active" id="tab-summary">
            <pre class="mono" id="outSummary">—</pre>
          </div>
          <div class="tabpanel" id="tab-json">
            <pre class="mono" id="outJson">{}</pre>
          </div>
          <div class="tabpanel" id="tab-print">
            <div class="print-card" id="outPrint">
              <h3>Printable view</h3>
              <p>Use the sealed JSON + public hash to prove integrity over time. This does not prove “truth”; it proves unchanged content.</p>
            </div>
          </div>
        </div>

        <div class="btn-row">
          <button class="btn-ghost" id="btnCopyHash">Copy hash</button>
          <button class="btn-ghost" id="btnCopyJson">Copy JSON</button>
          <button class="btn-primary" id="btnDownloadJson">Download JSON</button>
        </div>

        <!-- Cockpit CTA (TruthX pilot form exact link) -->
        <div class="cta-truthx" role="note" aria-label="Cockpit pilot call-to-action">
          <p>
            Ready for the <em>real</em> cockpit experience (explainable AI, uncertainty logging, sealed deliverables)?
            Join the pilot and run a live case with human guidance.
          </p>
          <a href="https://www.truthx.co/truthx-pilote-form" target="_blank" rel="noopener noreferrer">Cockpit (Pilot)</a>
        </div>
      </section>
    </section>
  </main>

  <script>
    const CONTEXTS = {
      governance: {
        label: "Governance",
        hint: "Governance: stable operating model, auditable HR decisions, multi-entity consistency.",
        chips: ["Moment T","Declared systems","Lineage","Quality checks","Audit exposure","Public hash"],
        defaults: {
          decisionType: "Nomination / sensitive role",
          scope: "Defense Group — Europe scope (multi-sites, multi-entities)",
          owner: "Global CHRO / Executive committee",
          narrative: "Sensitive decision in a regulated environment. Traceability across HR systems and stability of definitions are required. Decision may be challenged and must remain reconstructible over time (audit window).",
          sources: { lms:true, hris:true, perf:true, ops:true, s360:false, legal:true }
        }
      },
      legal: {
        label: "Legal Proceedings",
        hint: "Legal proceedings: contestable evidence, formal challenge, explicit uncertainty trace, chain-of-custody focus.",
        chips: ["Challenge-ready","Chain-of-custody","Explicit uncertainty","Contradictions","Public hash","Reversible transforms"],
        defaults: {
          decisionType: "Disciplinary decision",
          scope: "Contested decision — formal procedure (internal or external)",
          owner: "Legal / HR + delegated authority",
          narrative: "Decision is likely to be contested. The bundle must highlight traceability, contradictions, and what is unknown. The goal is procedural clarity and integrity, not interpretation.",
          sources: { lms:true, hris:true, perf:true, ops:false, s360:false, legal:true }
        }
      },
      crisis: {
        label: "Institutional Crisis",
        hint: "Institutional crisis: degraded systems, broken governance, urgency. Emphasize scope freezing and minimum viable traceability.",
        chips: ["Emergency mode","Degraded data","Scope freeze","Rapid defensibility","Audit triage","Public hash"],
        defaults: {
          decisionType: "Emergency re-org",
          scope: "Institutional breakdown — emergency governance perimeter",
          owner: "Crisis committee / interim executive",
          narrative: "Systems are partially degraded and governance is unstable. Prioritize freezing scope and preserving a minimal but auditable trace. Make risk visible: missing evidence, drift, and timeline gaps.",
          sources: { lms:false, hris:true, perf:false, ops:true, s360:false, legal:true }
        }
      }
    };

    const $ = (id) => document.getElementById(id);

    const contextSelect = $("contextSelect");
    const contextHint = $("contextHint");
    const contextChips = $("contextChips");

    const decisionType = $("decisionType");
    const decisionDate = $("decisionDate");
    const orgScope = $("orgScope");
    const decisionOwner = $("decisionOwner");
    const contextNarrative = $("contextNarrative");

    const srcLms = $("srcLms");
    const srcHris = $("srcHris");
    const srcPerf = $("srcPerf");
    const srcOps = $("srcOps");
    const src360 = $("src360");
    const srcLegal = $("srcLegal");

    const kvScope = $("kvScope");
    const kvMoment = $("kvMoment");
    const kvCoverage = $("kvCoverage");
    const kvDef = $("kvDef");
    const kvAudit = $("kvAudit");
    const kvHash = $("kvHash");

    const outCoverage = $("outCoverage");
    const outMissing = $("outMissing");
    const outDef = $("outDef");
    const outAudit = $("outAudit");
    const outSummary = $("outSummary");
    const outJson = $("outJson");

    document.querySelectorAll(".tab").forEach(btn => {
      btn.addEventListener("click", () => {
        document.querySelectorAll(".tab").forEach(b => b.classList.remove("is-active"));
        document.querySelectorAll(".tabpanel").forEach(p => p.classList.remove("is-active"));
        btn.classList.add("is-active");
        const key = btn.getAttribute("data-tab");
        $("tab-" + key).classList.add("is-active");
      });
    });

    function setChips(list){
      contextChips.innerHTML = "";
      list.forEach(t => {
        const s = document.createElement("span");
        s.className = "chip";
        s.textContent = t;
        contextChips.appendChild(s);
      });
    }

    function applyContext(key){
      const ctx = CONTEXTS[key] || CONTEXTS.governance;
      contextHint.textContent = ctx.hint;
      setChips(ctx.chips);

      const d = ctx.defaults;
      [...decisionType.options].forEach(opt => {
        if (opt.textContent.trim() === d.decisionType) decisionType.value = opt.value;
      });
      orgScope.value = d.scope;
      decisionOwner.value = d.owner;
      contextNarrative.value = d.narrative;

      srcLms.checked = !!d.sources.lms;
      srcHris.checked = !!d.sources.hris;
      srcPerf.checked = !!d.sources.perf;
      srcOps.checked = !!d.sources.ops;
      src360.checked = !!d.sources.s360;
      srcLegal.checked = !!d.sources.legal;

      kvScope.textContent = orgScope.value;
      kvMoment.textContent = decisionDate.value;

      generate();
    }

    async function sha256(str){
      const enc = new TextEncoder().encode(str);
      const buf = await crypto.subtle.digest("SHA-256", enc);
      return Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2,"0")).join("");
    }

    function computeScores(){
      const sources = [srcLms, srcHris, srcPerf, srcOps, src360, srcLegal].map(x => x.checked);
      const available = sources.filter(Boolean).length;
      const missing = Math.max(0, 6 - available);

      let coverage = Math.round((available / 6) * 100);
      coverage = Math.max(55, Math.min(98, coverage));

      let def = Math.round(40 + (available * 10));
      def = Math.max(45, Math.min(92, def));

      const audit = def >= 75 ? "LOW" : def >= 60 ? "MEDIUM" : "HIGH";
      return { coverage, missing, def, audit };
    }

    async function generate(){
      const ctxKey = contextSelect.value;
      const ctx = CONTEXTS[ctxKey] || CONTEXTS.governance;
      const scores = computeScores();

      const bundle = {
        rpo_version: "v0.1",
        context_profile: ctxKey, // maps to docs/profiles/
        generated_at_utc: new Date().toISOString(),
        decision: {
          type: decisionType.value,
          moment_t: decisionDate.value,
          scope: orgScope.value,
          owner: decisionOwner.value,
          narrative: contextNarrative.value
        },
        declared_sources: {
          lms: srcLms.checked,
          hris: srcHris.checked,
          performance: srcPerf.checked,
          operations: srcOps.checked,
          feedback_360: src360.checked,
          legal_compliance: srcLegal.checked
        },
        scores: {
          coverage_pct: scores.coverage,
          missing_count: scores.missing,
          defensibility_score: scores.def,
          audit_exposure: scores.audit
        },
        note: "Demo simulator. Integrity & reconstruction focus. Not a truth engine."
      };

      const stableString = JSON.stringify(bundle);
      const hash = await sha256(stableString);

      kvScope.textContent = orgScope.value;
      kvMoment.textContent = decisionDate.value;

      kvCoverage.textContent = scores.coverage + "%";
      kvDef.textContent = (scores.def >= 75 ? "LOW RISK" : scores.def >= 60 ? "MEDIUM" : "HIGH") + " (" + scores.def + ")";
      kvAudit.textContent = scores.audit;
      kvHash.textContent = "hash: " + hash;

      outCoverage.textContent = scores.coverage + "%";
      outMissing.textContent = String(scores.missing);
      outDef.textContent = (scores.def >= 75 ? "HIGH" : scores.def >= 60 ? "MEDIUM" : "LOW") + " (" + scores.def + "/100)";
      outAudit.textContent = scores.audit;

      outJson.textContent = JSON.stringify({ ...bundle, public_hash_sha256: hash }, null, 2);

      outSummary.textContent =
`Context: ${ctx.label}
Decision: ${bundle.decision.type}
Scope: ${bundle.decision.scope}
Owner: ${bundle.decision.owner}
Moment T: ${bundle.decision.moment_t}
Declared sources: ${Object.entries(bundle.declared_sources).filter(([,v])=>v).map(([k])=>k).join(", ") || "none"}
Coverage: ${scores.coverage}% | Missing: ${scores.missing}
Defensibility: ${outDef.textContent}
Audit exposure: ${scores.audit}
Integrity proof: SHA-256 public hash (sealed core)`;

      window.__openproof_bundle__ = { ...bundle, public_hash_sha256: hash };
    }

    $("btnGenerate").addEventListener("click", generate);

    $("btnLoadExample").addEventListener("click", () => {
      contextSelect.value = "governance";
      applyContext("governance");
      src360.checked = true;
      generate();
    });

    $("btnCopyHash").addEventListener("click", async () => {
      const b = window.__openproof_bundle__;
      if (!b) return;
      await navigator.clipboard.writeText(b.public_hash_sha256);
    });

    $("btnCopyJson").addEventListener("click", async () => {
      const b = window.__openproof_bundle__;
      if (!b) return;
      await navigator.clipboard.writeText(JSON.stringify(b, null, 2));
    });

    $("btnDownloadJson").addEventListener("click", () => {
      const b = window.__openproof_bundle__;
      if (!b) return;
      const blob = new Blob([JSON.stringify(b, null, 2)], { type: "application/json" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = `openproof_rpo_${b.context_profile}_${b.decision.moment_t}.json`;
      a.click();
      URL.revokeObjectURL(a.href);
    });

    [decisionType, decisionDate, orgScope, decisionOwner, contextNarrative, srcLms, srcHris, srcPerf, srcOps, src360, srcLegal].forEach(el => {
      el.addEventListener("input", generate);
      el.addEventListener("change", generate);
    });

    contextSelect.addEventListener("change", () => applyContext(contextSelect.value));

    (function init(){
      const params = new URLSearchParams(location.search);
      const key = (params.get("context") || "governance").toLowerCase();
      const normalized = (key === "legal-proceedings" || key === "legal") ? "legal"
                        : (key === "institutional-crisis" || key === "crisis") ? "crisis"
                        : "governance";
      contextSelect.value = normalized;
      applyContext(normalized);
    })();
  </script>
</body>
</html>

